<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ê¹€ë…•í˜ì´ (ì§„ë‹¨ëª¨ë“œ)</title>
<style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #f7fbfc; }
    iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; display: block; }
</style>
<script>
    // [1] ì£¼ì†Œì°½ ë°©ì–´
    if (window.location.hostname.includes('googleusercontent.com')) {
        window.location.replace('https://gnpay.my');
    }
    
    // [2] GAS ë°°í¬ URL
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    
    // [3] ë©”ì‹œì§€ ìˆ˜ì‹  (ì•Œë¦¼ ì¶”ê°€ë¨)
    window.addEventListener('message', function(e) {
        if (!e.data || !e.data.type) return;

        if (e.data.type === 'SAVE_USER' && e.data.data) {
            // â˜… ì—¬ê¸°ê°€ í•µì‹¬ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ì„ í•˜ë©´ ì´ ì•Œë¦¼ì´ ë– ì•¼ í•©ë‹ˆë‹¤.
            alert("âœ… [ì„±ê³µ] ë¶€ëª¨ì—ê²Œ ë¡œê·¸ì¸ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì´ì œ ì•±ì„ ê»ë‹¤ ì¼œë³´ì„¸ìš”.");
            localStorage.setItem('k_user', JSON.stringify(e.data.data));
        } 
        else if (e.data.type === 'LOGOUT' || e.data.type === 'LOGOUT_FORCE') {
            alert("ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            localStorage.removeItem('k_user');
            window.location.href = 'https://gnpay.my';
        }
    });

    // [4] Iframe ìƒì„±
    function createIframe() {
        let src = baseUrl;
        const saved = localStorage.getItem('k_user');
        
        if (saved) {
            // ì €ì¥ëœ ê²Œ ìˆìœ¼ë©´ ì•Œë¦¼ì„ ë„ì›ë‹ˆë‹¤.
            try {
                const data = JSON.parse(saved);
                if (data.email) {
                    // alert("âš¡ ìë™ ë¡œê·¸ì¸ ì‹œë„: " + data.email); // ë„ˆë¬´ ì‹œë„ëŸ¬ìš°ë©´ ì´ ì¤„ ì‚­ì œ
                    src += "?u=" + encodeURIComponent(data.email) + "&v=" + Date.now();
                }
            } catch(e){}
        } else {
            // ì €ì¥ëœ ê²Œ ì—†ìœ¼ë©´ ì´ ì•Œë¦¼ì´ ëœ¹ë‹ˆë‹¤.
            // alert("âš  ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (ìµœì´ˆ 1íšŒ ë¡œê·¸ì¸ í•„ìš”)"); 
        }
        
        const iframe = document.createElement('iframe');
        iframe.id = "appFrame";
        iframe.src = src;
        
        iframe.allow = "camera; microphone; storage-access; clipboard-write";
        iframe.setAttribute("sandbox", "allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation allow-modals allow-top-navigation");
        iframe.setAttribute("allowfullscreen", "");
        
        document.body.appendChild(iframe);
    }

    window.addEventListener('load', createIframe);
</script>
</head>
<body>
</body>
</html>
