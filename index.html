<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta property="og:type" content="website">
<meta property="og:title" content="ê¹€ë…•í˜ì´ (GIMNYEONG PAY)">
<meta property="og:description" content="íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ ë° í”Œë¡œê¹… í™œë™ìœ¼ë¡œ ë‚˜ë§Œì˜ ì—ì½” í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”. ğŸŒ±">
<meta property="og:image" content="/og-image.png">

<title>ê¹€ë…•í˜ì´</title>
<style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #f7fbfc; }
    iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; display: block; }
</style>
<script>
    // [1] ì£¼ì†Œì°½ ë°©ì–´ ë¡œì§
    if (window.location.hostname.includes('googleusercontent.com')) {
        window.location.replace('https://gnpay.my');
    }
    
    // [2] GAS ë°°í¬ URL
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    
    // [3] ë©”ì‹œì§€ ìˆ˜ì‹  (ë¡œê·¸ì•„ì›ƒ ë° ì„¸ì…˜)
    window.addEventListener('message', function(e) {
        if (!e.data || !e.data.type) return;

        // ì„¸ì…˜ ìš”ì²­ ì‘ë‹µ
        if (e.data.type === 'GET_SESSION') {
            const saved = localStorage.getItem('k_user');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    const iframe = document.getElementById('appFrame');
                    if (iframe && iframe.contentWindow) {
                        iframe.contentWindow.postMessage({ type: 'SEND_SESSION', data: data }, '*');
                    }
                } catch(err) {}
            }
        } 
        // ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
        else if (e.data.type === 'SAVE_USER' && e.data.data) {
            localStorage.setItem('k_user', JSON.stringify(e.data.data));
        } 
        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ (ê°•ë ¥ ìƒˆë¡œê³ ì¹¨)
        else if (e.data.type === 'LOGOUT' || e.data.type === 'LOGOUT_FORCE') {
            console.log("ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰");
            localStorage.removeItem('k_user');
            window.location.href = 'https://gnpay.my';
        }
    });

    // [4] Iframe ìƒì„±
    function createIframe() {
        let src = baseUrl;
        const saved = localStorage.getItem('k_user');
        
        // ì¢€ë¹„ ë¡œê·¸ì¸ ë°©ì§€ íŒŒë¼ë¯¸í„° ì¶”ê°€
        if (saved) {
            try {
                const data = JSON.parse(saved);
                if (data.email) src += "?u=" + encodeURIComponent(data.email) + "&v=" + Date.now();
            } catch(e){}
        }
        
        const iframe = document.createElement('iframe');
        iframe.id = "appFrame";
        iframe.src = src;
        
        // ê¶Œí•œ í—ˆìš©
        iframe.allow = "camera; microphone; storage-access; clipboard-write";
        
        // ìƒŒë“œë°•ìŠ¤ ì„¤ì • (ì¤„ë°”ê¿ˆ ì—†ì´ í•œ ì¤„ë¡œ ì‘ì„±í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€)
        iframe.setAttribute("sandbox", "allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation allow-modals allow-top-navigation");
        
        iframe.setAttribute("allowfullscreen", "");
        document.body.appendChild(iframe);
    }

    // ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('load', createIframe);
</script>
</head>
<body>
</body>
</html>
