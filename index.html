<!DOCTYPE html>
<html lang="ko">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#e6f7f6"> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ê¹€ë…•í˜ì´ 2.0</title>
    <link rel="icon" href="https://gnpay.my/log.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.1/dist/browser-image-compression.js"></script>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="apple-touch-icon" href="https://gnpay.my/log.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <meta name="theme-color" content="#e6f7f6"> 
<link rel="shortcut icon" href="https://gnpay.my/log.png">
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    :root { --primary: #01b2ad; --primary-grad: linear-gradient(135deg, #01b2ad 0%, #00d2ff 100%); --bg-grad: linear-gradient(180deg, #e6f7f6 0%, #f8fcfc 40%, #ffffff 100%); }
    
    body { 
    font-family: 'Pretendard', sans-serif; 
    /* 1. ë°°ê²½ìƒ‰ì„ ì—°ë¯¼íŠ¸ìƒ‰ìœ¼ë¡œ ê³ ì •í•´ì„œ ë…¸ì¹˜ ì˜ì—­ê¹Œì§€ ìƒ‰ì„ ì…í™ë‹ˆë‹¤ */
    background-color: #e6f7f6; 
    background-image: var(--bg-grad); 
    margin: 0; 
    /* 2. ë…¸ì¹˜ ë°‘ìœ¼ë¡œ ë¡œê³ ê°€ ë‚´ë ¤ì˜¤ë„ë¡ ê¸°ë³¸ ì—¬ë°± ë„‰ë„‰íˆ ë¶€ì—¬ */
    padding-top: env(safe-area-inset-top, 45px); 
    padding-bottom: 120px;
    min-height: 100vh; 
    color: #1a1a1a; 
    overflow-x: hidden; 
    -webkit-overflow-scrolling: touch; /* ì•„ì´í°ì—ì„œ ì«€ë“í•œ íƒ„ë ¥ ìŠ¤í¬ë¡¤ í™œì„±í™” */
}
    
    .top-nav { 
    display: flex; 
    justify-content: space-between; 
    align-items: flex-start; 
    padding: 20px 20px 5px 26px; 
    /* 3. sticky ì‚­ì œ! ì´ì œ ê¸€ìë“¤ê³¼ í•¨ê»˜ ìì—°ìŠ¤ëŸ½ê²Œ ìŠ¤í¬ë¡¤ ë©ë‹ˆë‹¤ */
    position: relative; 
    z-index: 10;
}
    .auth-links { display: flex; gap: 5px; align-items: center; }
    .auth-link { font-size: 0.8rem; font-weight: 700; color: #888; text-decoration: none; cursor: pointer; padding: 5px; line-height: 1; }
    
    /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìˆ¨ì‰¬ê¸° */
    .dashboard-card { 
        background: white; margin: 0 20px 15px; padding: 20px; border-radius: 24px; 
        display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        position: relative; animation: breathe 2s infinite ease-in-out; transition: transform 0.2s ease;
        border: 1px solid rgba(1, 178, 173, 0.1);
    }
    
    @keyframes breathe {
        0% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.15); }
        50% { transform: scale(1.04); box-shadow: 0 0 35px rgba(1, 178, 173, 0.5), 0 10px 40px rgba(0, 210, 255, 0.3); }
        100% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.15); }
    }

    .amount-text { font-size: 1.8rem; font-weight: 900; background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    /* [ìˆ˜ì •] ë§ˆì´í˜ì´ì§€ í”„ë¦¬ë¯¸ì—„ ì¹´ë“œ ë° ì¼ì²´í˜• QR ë””ìì¸ */
    .premium-card {
        background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
        border-radius: 35px; padding: 50px 20px 35px; margin: 20px; color: white;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        border: 1px solid rgba(255,255,255,0.05);
    }

    /* ë¡œê³ ì™€ QRì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ ìˆ¨ì‰¬ê²Œ í•˜ëŠ” ì»¨í…Œì´ë„ˆ */
    .qr-integration-box {
        position: relative; display: inline-block; margin-bottom: 25px;
        animation: qr-breathe 2s infinite ease-in-out; /* í†µí•© ìˆ¨ì‰¬ê¸° */
    }

    .qr-frame {
        background: white; padding: 15px; border-radius: 24px; display: inline-block;
        box-shadow: 0 0 20px rgba(1, 178, 173, 0.4);
    }

    /* ë¡œê³  ìƒë‹¨ ì¤‘ì•™ ì¹¨ë²” ë°°ì¹˜ */
    .qr-top-logo {
        position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
        width: 55px; height: 55px; background: var(--primary-grad);
        border-radius: 18px; border: 3px solid #1a1a1a; /* ì¹´ë“œ ë°°ê²½ê³¼ ë§ì¶˜ í…Œë‘ë¦¬ë¡œ ì¹¨ë²” ê°•ì¡° */
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 10;
        padding: 5px;
    }

    @keyframes qr-breathe {
        0% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.3)); }
        50% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(1, 178, 173, 0.7)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.3)); }
    }

    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 20px; margin-bottom: 15px; }
    .menu-item { background: white; padding: 15px 10px; text-align: center; border-radius: 20px; border: 1px solid #eee; cursor: pointer; }
    .menu-item i { font-size: 1.5rem; margin-bottom: 3px; display: inline-block; background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .menu-item .menu-title { font-size: 0.85rem; font-weight: 800; color: #333; }

  
    .history-img { width: 100%; max-height: 180px; object-fit: cover; border-radius: 12px; margin-top: 8px; border: 1px solid #eee; display: block; }
    .history-content { font-size: 0.8rem; color: #555; background: #f8f9fa; padding: 10px; border-radius: 10px; margin-top: 8px; }

  .page { 
    display: none; 
    width: 100%; 
    min-height: 100vh; 
    position: absolute; 
    top: 0; 
    left: 0; 
    background: var(--bg-grad); 
    z-index: 1;
    /* [í•µì‹¬] í•˜ë‹¨ë°” ë†’ì´(60px) + ì—¬ìœ ê³µê°„(40px)ì„ ë”í•´ì„œ ë°”ë‹¥ ì—¬ë°±ì„ ë„‰ë„‰íˆ ì¤ë‹ˆë‹¤ */
    padding-bottom: 120px !important; 
}

.page.active { 
    display: block !important; 
    z-index: 100; 
}

/* íƒ­ë°”ê°€ ê°€ë¦¬ëŠ” í˜„ìƒ ë°©ì§€ìš© ë°”ë‹¥ ì—¬ë°± */
#page-main, #page-mypage, #page-history, #page-activities, #page-guide, #page-partners {
    padding-bottom: 150px !important; 
}
    .active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .badge-status { padding: 5px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
    .badge-pending { background: #fff3cd; color: #856404; }
    .badge-approved { background: #d4edda; color: #155724; }
    .badge-rejected { background: #f8d7da; color: #721c24; }
    
    .custom-input { border: none; border-radius: 16px; background: white; padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); margin-bottom: 15px; width: 100%; }
.btn-scan {
    background: var(--primary-grad);
    color: white;
    border: none;
    border-radius: 18px;
    padding: 16px;
    font-weight: 800;
    font-size: 1.1rem;
    box-shadow: 0 10px 20px rgba(1, 178, 173, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-scan:active, .btn-scan-popup:active {
    transform: scale(0.92) !important;
    filter: brightness(1.1);
    transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
    .form-label { font-size: 0.8rem; font-weight: 700; color: #666; margin-left: 5px; margin-bottom: 5px; }
.activity-badge {
    position: absolute;
    top: -5px;      /* ìœ„ìª½ì—ì„œ -5px ë§Œí¼ */
    right: -5px;     /* ì˜¤ë¥¸ìª½ì—ì„œ -5px ë§Œí¼ */
    background-color: #FF3B30; /* ì•„ì´í° ë ˆë“œ */
    color: white;
    font-size: 0.75rem;
    font-weight: 900;
    min-width: 20px;
    height: 20px;
    border-radius: 10px;
    display: flex; /* ìˆ«ì ì¤‘ì•™ ì •ë ¬ */
    align-items: center;
    justify-content: center;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 100;
    padding: 0 5px;
}
/* íŒì—… ë°°ê²½ - ì•„ì´í° ìŠ¤íƒ€ì¼ ìœ ë¦¬ì°½ íš¨ê³¼ */
.qr-glass-effect {
    background: rgba(255, 255, 255, 0.4) !important; 
    backdrop-filter: blur(15px) saturate(180%) !important; /* ë’·ë°°ê²½ íë¦¼ íš¨ê³¼ */
    -webkit-backdrop-filter: blur(15px) saturate(180%) !important;
    transition: all 0.3s ease;
}

/* íŒì—… ì¹´ë“œ - ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŠ¤ë¥´ë¥µ */
.qr-slide-up {
    animation: luxurySlideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes qrSlideUp {
    from { transform: translateY(100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
@keyframes luxurySlideUp {
    from { transform: translateY(100px) scale(0.9); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}
/* ìˆ«ì ë°‘ì— ì€ì€í•œ ê·¸ë¦¼ì */
#focus-points {
    text-shadow: 0 10px 20px rgba(1, 178, 173, 0.2);
}
@keyframes aurora {
    from { box-shadow: 0 0 15px rgba(1, 178, 173, 0.1); }
    to { box-shadow: 0 0 40px rgba(1, 178, 173, 0.4); }
}
/* 1. íƒ­ë°” ë³¸ì²´: ë” ì–‡ê³ , ë” íˆ¬ëª…í•˜ê²Œ (ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜) */
.floating-tab-bar {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: 88%; /* ì•½ê°„ ë” ìŠ¬ë¦¼í•˜ê²Œ */
    max-width: 400px;
    background: rgba(255, 255, 255, 0.75); /* íˆ¬ëª…ë„ ë†’ì„ */
    backdrop-filter: blur(20px) saturate(180%); /* ìœ ë¦¬ ì§ˆê° ê·¹ëŒ€í™” */
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    height: 60px; /* ë†’ì´ë¥¼ ì‚´ì§ ì¤„ì—¬ ë¯¸ë‹ˆë©€í•˜ê²Œ */
    border-radius: 25px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); /* ê·¸ë¦¼ìëŠ” ì•„ì£¼ ì€ì€í•˜ê²Œ */
    z-index: 9999 !important;
    border: 1px solid rgba(255, 255, 255, 0.4);
    padding: 0 10px;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* ì´ ì¤„ì„ ì¶”ê°€! */
}

/* 2. ì•„ì´ì½˜ ìŠ¤íƒ€ì¼: í…ìŠ¤íŠ¸ëŠ” ë¹¼ê³  ì•„ì´ì½˜ë§Œ ê°•ì¡° (ë¯¸ë‹ˆë©€ë¦¬ì¦˜) */
.tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* ìˆ˜ì§ ì¤‘ì•™ */
    color: #b0b0b0; 
    transition: all 0.3s ease;
    cursor: pointer;
    flex: 1;
    height: 100%;
    position: relative; /* ìì‹ ìš”ì†Œë“¤ì˜ ê¸°ì¤€ì  */
    text-align: center;
}

.tab-item i { 
    font-size: 1.3rem; 
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: block;
    width: 100%; /* ë¶€ëª¨ ë„ˆë¹„ë¥¼ ë‹¤ ì“°ê²Œ í•´ì„œ ì¤‘ì•™ ì •ë ¬ ê°•ì œ */
}

.tab-item span { 
    font-size: 0.6rem; 
    font-weight: 800;
    margin-top: 2px;
    opacity: 0.7;
    transition: all 0.2s ease;
}

/* 2. ğŸŒŸ í™œì„±í™” ì‹œ: ê¸€ì ì¦ë°œ + ì•„ì´ì½˜ ì«€ë“ ë²Œí¬ì—… */
.tab-item.active { 
    color: #01b2ad; 
}

.tab-item.active i { 
    font-size: 1.8rem; 
    color: #01b2ad;
    animation: jellyPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.4));
    
    /* ğŸŒŸ í•µì‹¬: ê¸€ìê°€ ìˆê±´ ì—†ê±´ 'ì¤‘ì•™'ì— ê³ ì •ì‹œí‚¤ëŠ” ë§ˆë²• */
    transform: translateY(8px); 
    margin-top: 0;
}

.tab-item.active span {
    display: none !important;
}

/* ì«€ë“í•œ ì ¤ë¦¬íŒ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
@keyframes jellyPop {
    0% { transform: scale(1) translateY(8px); }
    30% { transform: scale(1.4) translateY(8px); }
    50% { transform: scale(0.9) translateY(8px); }
    100% { transform: scale(1) translateY(8px); }
}

/* 3. ì¤‘ì•™ ìŠ¤ìº” ë²„íŠ¼ë„ ëˆ„ë¥¼ ë•Œ ì«€ë“í•˜ê²Œ ë°˜ì‘ */
.tab-scan-btn:active {
    transform: scale(0.8) rotate(-8deg); /* ê¾¹ ëˆŒë¦¬ëŠ” ëŠë‚Œ */
    filter: brightness(1.2);
}

/* 3. ì¤‘ì•™ ìŠ¤ìº” ë²„íŠ¼: 'ê¹€ë…• ë¯¼íŠ¸' ì •ì²´ì„± í­ë°œ */
.tab-scan-btn {
    width: 50px;
    height: 50px;
    background: var(--primary-grad); /* ì‚¬ì¥ë‹˜ì´ ì“°ì‹œëŠ” ê·¸ ê·¸ë¼ë°ì´ì…˜ */
    border-radius: 18px; /* ë¡œê³ ì™€ í†µì¼ê° ìˆëŠ” ë‘¥ê·¼ ì‚¬ê° */
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5rem;
    margin-top: -30px; /* ì‚´ì§ë§Œ ì†Ÿì•„ì˜¤ë¥´ê²Œ */
    box-shadow: 0 8px 20px rgba(1, 178, 173, 0.4);
    border: 4px solid #ffffff; /* í°ìƒ‰ í…Œë‘ë¦¬ë¡œ ë¶„ë¦¬ê° */
    transition: all 0.3s ease;
}

.tab-scan-btn:active {
    transform: scale(0.9) rotate(5deg);
}
@keyframes login-glow {
    0% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.1); border: 1px solid rgba(1, 178, 173, 0.1); }
    50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(1, 178, 173, 0.3); border: 1px solid rgba(1, 178, 173, 0.5); }
    100% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.1); border: 1px solid rgba(1, 178, 173, 0.1); }
}
.active-tab {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 12px rgba(1, 178, 173, 0.3);
}
.inactive-tab {
    background: #f0f5f5;
    color: #888;
}
.bottom-nav {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* ìŠ¥ ë‚´ë ¤ê°€ëŠ” íš¨ê³¼ */
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤... */
}
/* 1. ëª¨ë“  ë²„íŠ¼ ë° í´ë¦­ ìš”ì†Œì— ì«€ë“í•¨ ë¶€ì—¬ */
button, .btn, .menu-item, .dashboard-card, .tab-item, .auth-link {
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.2s ease !important;
}

/* 2. ëˆ„ë¥´ëŠ” ìˆœê°„(active) ë°˜ì‘ ì •ì˜ */
button:active, .btn:active, .menu-item:active, .dashboard-card:active, .tab-item:active, .auth-link:active {
    transform: scale(0.94) !important; /* 6% ì •ë„ ìŠ¥ ëˆŒë¦¬ëŠ” ë§› */
    filter: brightness(1.1) !important; /* ì‚´ì§ ë°˜ì§í•˜ëŠ” íš¨ê³¼ */
}

/* 3. ì·¨ì†Œ ë²„íŠ¼ ê°™ì€ íšŒìƒ‰ ë²„íŠ¼ ì „ìš© (ì¡°ê¸ˆ ë” ê¹Šê²Œ ëˆŒë¦¬ëŠ” ëŠë‚Œ) */
button[style*="background: #f8f9fa"]:active {
    transform: scale(0.92) !important;
    background-color: #e9ecef !important;
}
/* ëª¨ë“  í˜ì´ì§€ ê¸°ë³¸ ìƒíƒœ: ì‚´ì§ ì•„ë˜ì— ìˆê³  íˆ¬ëª…í•¨ */
.page {
    display: none;
    opacity: 0;
    transform: translateY(15px); /* ì‚´ì§ ì•„ë˜ì—ì„œ ëŒ€ê¸° */
    transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* í™œì„±í™”ëœ í˜ì´ì§€: ì œìë¦¬ë¡œ ì˜¤ë©´ì„œ ì„ ëª…í•´ì§ */
.page.active {
    display: block !important;
    opacity: 1;
    transform: translateY(0);
    animation: pageIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes pageIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
/* ì•ˆë‚´ í˜ì´ì§€ ì¹´ë“œ ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
/* ì»¨í…Œì´ë„ˆ: ë°°ì§€ê°€ íŠ€ì–´ë‚˜ì˜¬ ê³µê°„ì„ ìœ„í•´ padding-topì„ ì¶©ë¶„íˆ(40px) ì¤ë‹ˆë‹¤ */
.guide-slider-container {
    width: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    padding: 40px 0 60px; /* ìœ„ì•„ë˜ ì—¬ë°±ì„ ì¤˜ì„œ ë°°ì§€ ì•ˆ ì˜ë¦¬ê²Œ í•¨ */
    scrollbar-width: none;
    display: flex;
}
.guide-slider-container::-webkit-scrollbar { display: none; }

.guide-slider {
    display: flex;
    padding: 0 45px;
    gap: 20px;
}
.guide-slider::after {
    content: '';
    flex: 0 0 45px; /* ì¢Œì¸¡ íŒ¨ë”©ê³¼ ë™ì¼í•œ ë„ˆë¹„ ë¶€ì—¬ */
}
/* ì‚´ì•„ìˆëŠ” ì¹´ë“œ ë³¸ì²´ */
.guide-card {
    flex: 0 0 calc(100vw - 100px);
    scroll-snap-align: center;
    background: white;
    border-radius: 40px;
    padding: 50px 25px 35px;
    /* ì¹´ë“œê°€ ì‚´ì•„ìˆëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•˜ëŠ” ê¹Šì€ ê·¸ë¦¼ì */
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    border: 1px solid rgba(1, 178, 173, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
    /* ì«€ë“í•œ ì›€ì§ì„ ì„¤ì • */
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform: scale(0.9); /* í‰ì†Œì—ëŠ” ì‚´ì§ ì‘ê²Œ */
    opacity: 0.5; /* í‰ì†Œì—ëŠ” íë¦¿í•˜ê²Œ */
}

/* ì¤‘ì•™ì— ì™”ì„ ë•Œ ì‚´ì•„ë‚˜ëŠ” íš¨ê³¼ */
.guide-card.active-focus {
    transform: scale(1.05); /* ì¤‘ì•™ì—ì„œ ì«€ë“í•˜ê²Œ ì»¤ì§ */
    opacity: 1;
    box-shadow: 0 20px 40px rgba(1, 178, 173, 0.15);
    border: 1px solid rgba(1, 178, 173, 0.3);
}

/* ìŠ¤í… ë°°ì§€: ì¹´ë“œ ê²½ê³„ì„ ì— ë°˜ì¯¤ ê±¸ì¹˜ê²Œ (ì ˆëŒ€ ì•ˆ ì˜ë¦¼) */
.guide-step-badge {
    position: absolute;
    top: -18px; /* ì¹´ë“œ ë°–ìœ¼ë¡œ 18px íŠ€ì–´ë‚˜ê° */
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a1a;
    color: #fff;
    font-size: 0.75rem;
    font-weight: 900;
    padding: 7px 20px;
    border-radius: 50px;
    z-index: 10;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    letter-spacing: 1px;
}
.nav-close-btn {
    cursor: pointer;
    padding: 10px;
    color: #adb5bd;
    transition: all 0.2s;
}
.nav-close-btn:active {
    transform: scale(0.9);
    opacity: 0.6;
}
</style>
</head>
<body>
<body>

    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); z-index: 10000; display: none; justify-content: center; align-items: center; flex-direction: column;">
        <div class="spinner-border text-info" role="status"></div>
        <div class="mt-3 fw-bold" style="color:var(--primary)">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <div id="qr-focus-layer" onclick="this.style.display='none'" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center;">
        <div class="bg-white p-4 rounded-5 text-center shadow-lg qr-slide-up" style="width:85%; max-width:350px; border: 1px solid rgba(255,255,255,0.3); position: relative;" onclick="event.stopPropagation()">
            <div class="qr-wrapper" style="position: relative; width: 100%; display: flex; justify-content: center; align-items: center; background: #f8fcfc; padding: 22px 10px; border-radius: 30px; box-shadow: 0 0 30px rgba(1, 178, 173, 0.15); animation: aurora 3s infinite alternate; margin-top: 25px;">
                <div style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); width: 48px; height: 48px; background: #01b2ad; border-radius: 14px; border: 3px solid #ffffff; box-shadow: 0 5px 12px rgba(1, 178, 173, 0.2); display: flex; align-items: center; justify-content: center; z-index: 10; overflow: hidden;">
                    <img src="https://gnpay.my/log2.png" style="width: 100%; height: 100%; object-fit: cover; background: #01b2ad; padding: 6px;">
                </div>
                <img id="qr-img-large" src="" style="width: 100%; max-width: 250px; border-radius: 12px; display: block;">
            </div>
            <div class="mt-4">
                <div class="amount-text user-points-display" id="focus-points" style="font-size: 2.7rem; font-weight: 900; color: var(--primary);">0</div>
                <div class="small text-muted fw-bold" style="opacity: 0.6; letter-spacing: 1px;">ë‚˜ì˜ ì—ì½” í¬ì¸íŠ¸</div>
            </div>
            <button class="btn mt-4 w-100 rounded-pill fw-bold" style="background: #f1f3f5; color: #666; padding: 12px;" onclick="closeQR()">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="page-main" class="page active">
        <div class="top-nav">
            <div onclick="showPage('page-main')" style="cursor: pointer;">
    <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
    <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
</div>
            <div class="auth-links" id="auth-area"></div>
        </div>
        <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
            <h1 class="fw-bolder mt-2" id="welcome-message">í•¨ê»˜ ë§Œë“œëŠ”<br><strong>í‘¸ë¥¸ ê¹€ë…• Wave</strong></h1>
        </div>
        <div class="dashboard-card" id="qr-trigger">
            <div><div class="small fw-bold text-muted">MY POINTS</div><div class="amount-text user-points-display" id="main-u-points">0</div></div>
            <div style="background: var(--primary-grad); color:white; width:50px; height:50px; border-radius:18px; display:flex; align-items:center; justify-content:center; font-size:1.5rem;"><i class="bi bi-qr-code"></i></div>
        </div>
        <div class="menu-grid">
            <div class="menu-item" onclick="openSubmit('ìš°ë¦¬ ë§ˆì„ í”Œë¡œê¹… (ììœ )', 2000, 'ê¹€ë…•ë§ˆì„ í™˜ê²½ ì •í™”ì— ë™ì°¸í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>í™œë™ ì‚¬ì§„ì„ ììœ ë¡­ê²Œ ì˜¬ë ¤ì£¼ì„¸ìš”.')">
                <i class="bi bi-patch-check-fill"></i>
                <div class="menu-title">ì •í™” í™œë™</div>
            </div>
            <div class="menu-item" onclick="showPage('page-partners')">
                <i class="bi bi-bag-heart-fill"></i>
                <div class="menu-title">ê°€ë§¹ì </div>
            </div>
            <div class="menu-item" onclick="showPage('page-activities')" style="position: relative;">
                <i class="bi bi-calendar-check-fill"></i>
                <div class="menu-title">ì§„í–‰ì¤‘ í™œë™</div>
                <div id="activity-badge-count" class="activity-badge" style="display: flex;">0</div> 
            </div>
            <div class="menu-item" onclick="showPage('page-guide')">
                <i class="bi bi-info-circle-fill"></i>
                <div class="menu-title">ì•±ì‚¬ìš© ì•ˆë‚´</div>
            </div>
        </div>
    </div> 
    
    <div id="page-guide" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-left: 10px;">ì•± ì´ìš© ì•ˆë‚´</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: 1.8rem; line-height: 1.2; letter-spacing: -1.5px;">ê¹€ë…•í˜ì´<br><strong>ì‚¬ìš© ê°€ì´ë“œ</strong></h1>
    </div>

    <div class="guide-slider-container" id="guide-slider-scroll">
        <div class="guide-slider">
            <div class="guide-card active-focus">
                <div class="guide-step-badge">STEP 01</div>
                <div class="guide-icon-circle" style="width:75px; height:75px; border-radius:22px; background:#e6f7f6; color:var(--primary); display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:20px;">
                    <i class="bi bi-tree-fill"></i>
                </div>
                <h4 style="font-weight:900; letter-spacing:-1px; margin-bottom:12px;">ì—ì½” í¬ì¸íŠ¸ ì ë¦½</h4>
                <div class="step-desc" style="color:#666; font-size:0.95rem; line-height:1.7;">
                    ê¹€ë…• ì„±ì„¸ê¸° í•´ë³€ ì •í™” í›„<br>
                    <strong>í™œë™ ì‚¬ì§„</strong>ì„ ì¸ì¦í•˜ë©´<br>
                    ì—ì½” í¬ì¸íŠ¸ê°€ ì¦‰ì‹œ ì§€ê¸‰ë©ë‹ˆë‹¤.
                </div>
            </div>

            <div class="guide-card">
                <div class="guide-step-badge">STEP 02</div>
                <div class="guide-icon-circle" style="width:75px; height:75px; border-radius:22px; background:#fff9e6; color:#d4a017; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:20px;">
                    <i class="bi bi-bag-heart-fill"></i>
                </div>
                <h4 style="font-weight:900; letter-spacing:-1px; margin-bottom:12px;">ë§ˆì„ ê°€ë§¹ì  ì‚¬ìš©</h4>
                <div class="step-desc" style="color:#666; font-size:0.95rem; line-height:1.7;">
                    ì ë¦½ëœ í¬ì¸íŠ¸ëŠ” ê¹€ë…• ë§ˆì„ì˜<br>
                    <strong>ì¹´í˜, ì‹ë‹¹, ì²´í—˜ì²˜</strong>ì—ì„œ<br>
                    í˜„ê¸ˆì²˜ëŸ¼ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.
                </div>
            </div>

            <div class="guide-card">
                <div class="guide-step-badge">STEP 03</div>
                <div class="guide-icon-circle" style="width:75px; height:75px; border-radius:22px; background:#eefbff; color:#0099cc; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:20px;">
                    <i class="bi bi-qr-code-scan"></i>
                </div>
                <h4 style="font-weight:900; letter-spacing:-1px; margin-bottom:12px;">ìŠ¤ë§ˆíŠ¸ ì²´í¬ì¸</h4>
                <div class="step-desc" style="color:#666; font-size:0.95rem; line-height:1.7;">
                    ë§ˆì´í˜ì´ì§€ <strong>ë‚˜ì˜ QR</strong>ë¡œ<br>
                    ê°€ë§¹ì  ì…ì¥ê³¼ ë³¸ì¸ í™•ì¸ì„<br>
                    ëˆ„êµ¬ë³´ë‹¤ ë¹ ë¥´ê²Œ í•´ê²°í•˜ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-2">
        <div class="badge rounded-pill bg-light text-dark px-3 py-2" style="font-size: 0.75rem; opacity: 0.7; border: 1px solid #eee;">
            <i class="bi bi-arrow-left-right me-1"></i> ì˜†ìœ¼ë¡œ ë°€ì–´ì„œ ê°€ì´ë“œ í™•ì¸
        </div>
    </div>
</div>
<div id="page-mypage" class="page"> 
    <div class="top-nav" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 20px 20px 5px 26px;">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px;">
        </div>
        
        <div class="auth-links">
            <span class="auth-link" onclick="openEditInfo()" style="color:var(--primary); font-weight:800; font-size: 0.8rem; padding: 5px; line-height: 1;">ì •ë³´ìˆ˜ì •</span>
            <span style="color:#eee; font-size:0.7rem; line-height: 1;">|</span>
            <span class="auth-link" onclick="logout()" style="font-size: 0.8rem; font-weight: 700; color: #888; padding: 5px; line-height: 1;">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
    </div>
    
    <div class="mt-1" style="padding-left: 20px; padding-right: 20px;">
        <div class="premium-card text-center" style="margin: 0; background: white; border: 1px solid rgba(1, 178, 173, 0.15); box-shadow: 0 15px 35px rgba(0,0,0,0.08); border-radius: 35px; padding: 35px 20px;">
            
            <div style="margin-bottom: 25px;">
                <div style="color: var(--primary); font-size: 0.7rem; font-weight: 800; letter-spacing: 3px; margin-bottom: 5px; opacity: 0.8;">GIMNYEONG PASS</div>
                <div style="color: #1a1a1a; font-size: 1.6rem; font-weight: 900; letter-spacing: -1px;">
                <span id="mypage-user-name" style="color:var(--primary)"></span>ë‹˜, ë°˜ê°€ì›Œìš”!
                </div>
            </div>

            <div class="qr-integration-box" style="margin-bottom: 30px; display: inline-block;">
                <div class="qr-top-logo" style="border: 3px solid #fff; width: 40px; height: 40px; background: #01b2ad !important; overflow: hidden; display: flex; align-items: center; justify-content: center; 
     border-radius: 12px !important;"> <img src="https://gnpay.my/log2.png" style="width: 100%; height: 100%; object-fit: contain;">
</div>
                <div class="qr-frame" style="background: #f8fcfc; padding: 12px; border-radius: 25px; display: inline-block; border: 1px solid #edf7f6; box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);">
                    <img id="my-qr-img" src="" style="width: 170px; height: 170px; border-radius: 15px;">
                </div>
            </div>

            <div style="background: #f8fcfc; padding: 22px 15px; border-radius: 28px; border: 1px solid rgba(1, 178, 173, 0.1);">
                <div style="color: #888; font-size: 0.75rem; font-weight: 700; letter-spacing: 1px; margin-bottom: 5px;">CURRENT BALANCE</div>
                <div style="display: flex; align-items: baseline; justify-content: center; gap: 4px;">
                    <div class="user-points-display" id="my-u-points" style="font-size: 3rem; font-weight: 900; color: var(--primary); line-height: 1;">0</div>
                    <div style="font-size: 1.3rem; font-weight: 800; color: #333;">P</div>
                </div>
                <div style="font-size: 0.85rem; color: #777; font-weight: 700; margin-top: 15px; border-top: 1px dashed rgba(1, 178, 173, 0.2); padding-top: 12px;">
                    í•¨ê»˜ ë§Œë“œëŠ” í‘¸ë¥¸ ê¹€ë…• Wave ğŸŒ±
                </div>
            </div>
        </div>

   
    </div>
</div>


        
  <div id="page-login" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')"><i class="bi bi-x"></i></div>
    </div>

    <div class="mt-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mb-4" style="line-height: 1.2;">ë°˜ê°€ì›Œìš”!<br><strong>ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</strong></h1>
        
        <div class="mt-5"> 
            <input type="email" id="login-email" class="form-control custom-input" placeholder="ì´ë©”ì¼">
            <input type="password" id="login-pw" class="form-control custom-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
            
            <div class="d-flex justify-content-between align-items-center px-1 mb-4" style="margin-top: -5px;">
                <div class="form-check d-flex align-items-center gap-2">
                    <input class="form-check-input" type="checkbox" id="remember-me" style="width: 17px; height: 17px; cursor: pointer;">
                    <label class="form-check-label small text-muted" for="remember-me" style="cursor: pointer; padding-top: 2px;">ì•„ì´ë”” ê¸°ì–µ</label>
                </div>
                <div class="small text-muted" onclick="handleForgotPassword()" style="cursor: pointer;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</div>
            </div>

            <button class="btn-scan w-100" onclick="submitLogin()">ë¡œê·¸ì¸í•˜ê¸°</button>

            <div class="text-center mt-4">
                <span class="text-muted small">ì•„ì§ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”?</span>
                <span class="fw-bold small ms-2" style="color:var(--primary); cursor:pointer;" onclick="showPage('page-signup')">íšŒì›ê°€ì…</span>
            </div>
        </div>
    </div>
</div>
<div id="pw-reset-layer" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001; display: none; flex-direction: column; align-items: center; justify-content: center;">
    <div class="bg-white p-4 rounded-5 shadow-lg qr-slide-up" style="width:85%; max-width:350px; position: relative; border: 1px solid rgba(255,255,255,0.3);">
        
        <div style="position: absolute; top: -20px; left: 20px; width: 55px; height: 55px; 
            background: #01b2ad; /* ê¹€ë…•í˜ì´ ë©”ì¸ ë¡œê³ ìƒ‰ */
            border-radius: 18px; 
            border: 4px solid #fff; 
            box-shadow: 0 8px 15px rgba(1, 178, 173, 0.3); 
            display: flex; align-items: center; justify-content: center; z-index: 10;">
    
    <img src="https://gnpay.my/log2.png" style="width: 80%; height: 80%; object-fit: contain;">
</div>

        <div class="text-center mt-3 mb-4">
            <h5 class="fw-bold" style="color: #333; letter-spacing: -1px;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h5>
            <p class="small text-muted" style="font-size: 0.75rem;">ë“±ë¡ëœ ì´ë©”ì¼ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        </div>
        
        <div class="px-1">
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ê°€ì… ì´ë©”ì¼</div>
            <input type="email" id="reset-email" class="form-control custom-input" placeholder="example@email.com" style="margin-bottom: 12px; font-size: 0.9rem;">
            
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ì „í™”ë²ˆí˜¸</div>
            <input type="tel" id="reset-phone" class="form-control custom-input" placeholder="ìˆ«ìë§Œ ì…ë ¥" style="margin-bottom: 20px; font-size: 0.9rem;">
        </div>
        
        <div class="d-flex gap-2">
            <button class="btn w-50 rounded-pill fw-bold" style="background: #f8f9fa; color: #999; padding: 14px; border: none; font-size: 0.9rem;" onclick="document.getElementById('pw-reset-layer').style.display='none'">ì·¨ì†Œ</button>
            <button class="btn-scan w-50" style="padding: 14px; font-size: 1rem; background: #01b2ad; border: none; color: #fff; border-radius: 50px;" onclick="processPwReset()">í™•ì¸</button>
        </div>
    </div>
</div>


    <div id="page-signup" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')"><i class="bi bi-x"></i></div>
    </div>
    
    <div class="mt-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mb-4" style="line-height: 1.2;">ìƒˆë¡œìš´ ì‹œì‘!<br><strong>ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</strong></h1>
        
        <div class="mt-4">
            <div class="d-flex gap-2 mb-3">
                <div style="position: relative; flex: 2;">
                    <i class="bi bi-person" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                    <input type="text" id="reg-name" class="form-control custom-input" placeholder="ì´ë¦„" style="padding-left: 45px; margin-bottom:0;">
                </div>
                <div style="flex: 1;">
                    <select id="reg-gender" class="form-control custom-input" style="padding-left: 15px; margin-bottom:0; font-weight: 600; color: #666;">
                        <option value="">ì„±ë³„</option>
                        <option value="ë‚¨">ë‚¨ì„±</option>
                        <option value="ì—¬">ì—¬ì„±</option>
                    </select>
                </div>
            </div>

            <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-envelope" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="email" id="reg-email" class="form-control custom-input" placeholder="ì´ë©”ì¼" style="padding-left: 45px;">
            </div>
            <div style="position: relative; margin-bottom: 5px;">
            <i class="bi bi-lock" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
            <input type="password" id="reg-pw" class="form-control custom-input" 
             placeholder="ë¹„ë°€ë²ˆí˜¸ (ì˜ë¬¸+ìˆ«ì í˜¼í•©)" 
             style="padding-left: 45px;">
            </div>
               <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-phone" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="tel" id="reg-phone" class="form-control custom-input" placeholder="ì „í™”ë²ˆí˜¸ (ìˆ«ìë§Œ ì—°ì†í•´ì„œ ì…ë ¥)" style="padding-left: 45px;">
            </div>

            <div style="position: relative; margin-bottom: 20px;">
                <i class="bi bi-geo-alt" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <select id="reg-region" class="form-control custom-input" style="padding-left: 45px; font-weight: 600; color: #666;">
                    <option value="">ê±°ì£¼ ì§€ì—­ ì„ íƒ</option>
                    <option value="ì œì£¼">ì œì£¼</option>
                    <option value="ì„œìš¸">ì„œìš¸</option>
                    <option value="ê²½ê¸°">ê²½ê¸°</option>
                    <option value="ì¸ì²œ">ì¸ì²œ</option>
                    <option value="ê°•ì›">ê°•ì›</option>
                    <option value="ëŒ€ì „">ëŒ€ì „</option>
                    <option value="ì „ë¶">ì „ë¶</option>
                    <option value="ì „ë‚¨">ì „ë‚¨</option>
                    <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                    <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                    <option value="ì¶©ë¶">ì¶©ë¶</option>
                    <option value="ê²½ë¶">ê²½ë¶</option>
                    <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                    <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                    <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <div class="p-3 mb-4" style="background: rgba(1, 178, 173, 0.05); border-radius: 18px; border: 1px dashed rgba(1, 178, 173, 0.3);">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <input type="checkbox" id="reg-agree" style="width: 20px; height: 20px; accent-color: var(--primary);">
                        <label for="reg-agree" class="ms-2 small fw-bold text-dark" style="cursor:pointer;">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜)</label>
                    </div>
                    <span class="small text-muted" style="text-decoration: underline; cursor:pointer;" onclick="alert('ê¹€ë…•í˜ì´ ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•œ ìµœì†Œí•œì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.')">ë³´ê¸°</span>
                </div>
            </div>
            
            <button class="btn-scan w-100 mt-2" onclick="checkAndSignup()">ê°€ì…í•˜ê¸°</button>
        </div>

        <div class="text-center mt-4 pb-5">
            <span class="text-muted small">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?</span>
            <span class="fw-bold ms-2" style="color:var(--primary); cursor:pointer;" onclick="showPage('page-login')">ë¡œê·¸ì¸</span>
        </div>
    </div>
</div>
<div id="profile-edit-layer" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001; display: none; flex-direction: column; align-items: center; justify-content: center;">
    <div class="bg-white p-4 rounded-5 shadow-lg qr-slide-up" style="width:85%; max-width:350px; position: relative; border: 1px solid rgba(255,255,255,0.3);">
        
        <div style="position: absolute; top: -20px; left: 20px; width: 55px; height: 55px; background: #01b2ad; border-radius: 18px; border: 4px solid #fff; box-shadow: 0 8px 15px rgba(1, 178, 173, 0.3); display: flex; align-items: center; justify-content: center; z-index: 10;">
            <img src="https://gnpay.my/log2.png" style="width: 80%; height: 80%; object-fit: contain;">
        </div>

        <div class="text-center mt-3 mb-4">
            <h5 class="fw-bold" style="color: #333; letter-spacing: -1px;">
                <span id="edit-user-name" style="color: #01b2ad;">ì‚¬ìš©ì</span>ë‹˜ ì •ë³´ ìˆ˜ì •
            </h5>
            <p class="small text-muted" style="font-size: 0.75rem;">ë³€ê²½í•  ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
        </div>
        
        <div class="px-1">
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ê±°ì£¼ ì§€ì—­</div>
            <select id="popup-edit-region" class="form-control custom-input" style="margin-bottom: 12px; font-size: 0.9rem; font-weight: 600;">
                <option value="ì œì£¼">ì œì£¼</option><option value="ì„œìš¸">ì„œìš¸</option><option value="ê²½ê¸°">ê²½ê¸°</option>
                <option value="ì¸ì²œ">ì¸ì²œ</option><option value="ê°•ì›">ê°•ì›</option><option value="ëŒ€ì „">ëŒ€ì „</option>
                <option value="ì „ë¶">ì „ë¶</option><option value="ì „ë‚¨">ì „ë‚¨</option><option value="ê´‘ì£¼">ê´‘ì£¼</option>
                <option value="ì¶©ë‚¨">ì¶©ë‚¨</option><option value="ì¶©ë¶">ì¶©ë¶</option><option value="ê²½ë¶">ê²½ë¶</option>
                <option value="ê²½ë‚¨">ê²½ë‚¨</option><option value="ë¶€ì‚°">ë¶€ì‚°</option><option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>

            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ì „í™”ë²ˆí˜¸</div>
            <input type="tel" id="popup-edit-phone" class="form-control custom-input" placeholder="ìˆ«ìë§Œ ì…ë ¥" style="margin-bottom: 12px; font-size: 0.9rem;">
            
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ì„ íƒ)</div>
            <input type="password" id="popup-edit-pw" class="form-control custom-input" placeholder="ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥" style="margin-bottom: 20px; font-size: 0.9rem;">
        </div>
        
        <div class="d-flex gap-2">
            <button class="btn w-50 rounded-pill fw-bold" style="background: #f8f9fa; color: #999; padding: 14px; border: none; font-size: 0.9rem;" onclick="document.getElementById('profile-edit-layer').style.display='none'">ì·¨ì†Œ</button>
            <button class="btn-scan w-50" style="padding: 14px; font-size: 1rem; background: #01b2ad; border: none; color: #fff; border-radius: 50px;" onclick="submitPopupEdit()">ìˆ˜ì •ì™„ë£Œ</button>
        </div>
    </div>
</div>

    <div id="page-history" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ë‚˜ì˜ í™œë™ ê¸°ë¡</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="d-flex px-4 mt-2 mb-4" style="gap: 10px;">
        <div id="tab-point" class="flex-fill text-center py-2 active-tab" onclick="switchHistoryTab('point')" style="cursor:pointer; font-weight:800; border-radius:15px; font-size:0.9rem;">í¬ì¸íŠ¸ ë‚´ì—­</div>
        <div id="tab-activity" class="flex-fill text-center py-2 inactive-tab" onclick="switchHistoryTab('activity')" style="cursor:pointer; font-weight:800; border-radius:15px; font-size:0.9rem;">ì •í™”í™œë™ í˜„í™©</div>
    </div>

    <div style="padding-left: 20px; padding-right: 20px;">
        <div id="history-point-section">
            <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8;">í¬ì¸íŠ¸ ì ë¦½ ë° ì‚¬ìš© ê¸°ë¡ì…ë‹ˆë‹¤.</div>
            <div id="point-history-list">
                <div class="text-center text-muted mt-5 small">í¬ì¸íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div id="history-activity-section" style="display:none;">
            <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8;">ì‹ ì²­í•˜ì‹  í™˜ê²½ ì •í™” í™œë™ì˜ ìŠ¹ì¸ í˜„í™©ì…ë‹ˆë‹¤.</div>
            <div id="activity-history-list">
                <div class="text-center text-muted mt-5 small">í™œë™ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>
</div>

    <div id="page-activities" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ì§„í–‰ì¤‘ í™œë™</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: calc(1.375rem + 1.5vw); line-height: 1.2;">ì§€ê¸ˆ ì°¸ì—¬í•˜ê³ <br><strong>í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”</strong></h1>
    </div>

    <div id="activity-list-container" style="padding-left: 20px; padding-right: 20px;">
        <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8; font-size: 0.85rem;">
            í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ê¹€ë…• ë§ˆì„ ì •í™” í™œë™ì…ë‹ˆë‹¤.
        </div>
        
        <div class="dashboard-card mb-3" onclick="openSubmit('ê¹€ë…• ì„±ì„¸ê¸°í•´ë³€ í”Œë¡œê¹…', 2000, 'ê¹€ë…•ì˜ í‘¸ë¥¸ ë°”ë‹¤ë¥¼ ìœ„í•´ í”Œë¡œê¹… í™œë™ì„ ì¸ì¦í•´ì£¼ì„¸ìš”.')" style="padding: 22px; align-items: center; animation: none; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;">
            <div style="flex: 1;">
                <div class="fw-bold" style="font-size: 1.1rem;">ê¹€ë…• ì„±ì„¸ê¸°í•´ë³€ í”Œë¡œê¹…</div>
                <div class="text-success small fw-bold" style="margin-top: 4px;">+2,000 í¬ì¸íŠ¸ ì ë¦½</div>
            </div>
            <i class="bi bi-chevron-right fs-4" style="color: #ccc;"></i>
        </div>

        </div>
</div>

    <div id="page-submit-act" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div id="act-title-display" style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">í™˜ê²½ ì •í™” ì¸ì¦</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: calc(1.375rem + 1.5vw); line-height: 1.2;">ê¹¨ë—í•œ ê¹€ë…•ì„ ìœ„í•´<br><strong>í™œë™ì„ ì¸ì¦í•´ì£¼ì„¸ìš”</strong></h1>
    </div>

    <div style="padding-left: 20px; padding-right: 20px;">
        <div id="act-desc-display" class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8; font-size: 0.85rem;">
            í™œë™ ì‚¬ì§„ê³¼ ê°„ë‹¨í•œ ì†Œê°ì„ ë‚¨ê²¨ì£¼ì‹œë©´ í™•ì¸ í›„ í¬ì¸íŠ¸ë¥¼ ë“œë¦½ë‹ˆë‹¤.
        </div>
        
        <div class="p-1">
            <textarea id="act-content" class="form-control custom-input" rows="4" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ì •í™” í™œë™ì„ í•˜ì…¨ë‚˜ìš”?" style="border-radius: 20px; border: 1px solid #eee; margin-bottom: 15px;"></textarea>
            
            <div class="mb-2 small fw-bold text-muted" style="margin-left: 10px;">ì‚¬ì§„ ì²¨ë¶€ (ìµœëŒ€ 3ì¥)</div>
            <input type="file" id="act-files" class="form-control custom-input" accept="image/*" multiple onchange="previewImages()" style="border-radius: 20px; border: 1px solid #eee; margin-bottom: 15px;">
            
            <div id="image-preview" class="d-flex gap-2 mb-4 overflow-auto pb-2" style="padding-left: 5px;"></div>
            
            <button class="btn-scan w-100" onclick="submitActivity()" style="height: 60px; font-size: 1.2rem;">ì¸ì¦ ì‹ ì²­í•˜ê¸°</button>
        </div>
    </div>
</div>

  <div id="page-partners" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">í¬ì¸íŠ¸ ê°€ë§¹ì </div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: calc(1.375rem + 1.5vw); line-height: 1.2;">ì–´ë””ì„œë‚˜ ììœ ë¡­ê²Œ<br><strong>í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”</strong></h1>
    </div>

    <div style="padding-left: 20px; padding-right: 20px;">
        <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8; font-size: 0.85rem;">
            ê¹€ë…•í˜ì´ í¬ì¸íŠ¸ë¥¼ í˜„ê¸ˆì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ë§¹ì ì…ë‹ˆë‹¤.
        </div>
        
        <div class="dashboard-card mb-3" style="padding: 22px; flex-direction: column; align-items: flex-start; animation: none; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;">
            <div class="fw-bold" style="font-size: 1.1rem;">ê¹€ë…•ìˆ˜ì‚°ë¬¸í™”ë³µí•©ì„¼í„°</div>
            <div class="small text-muted mt-1">ğŸ“ ê°ì¢… ì²´í—˜ í™œë™ Â· 2ì¸µ í•´ë…€ì‚¼ì¶˜ì»¤í”¼</div>
        </div>
        
        <div class="dashboard-card mb-3" style="padding: 22px; flex-direction: column; align-items: flex-start; animation: none; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;">
            <div class="fw-bold" style="font-size: 1.1rem;">ê¹€ë…•ì–´ìš¸ë¦¼ì„¼í„°</div>
            <div class="small text-muted mt-1">ğŸ“ ê°ì¢… ì²´í—˜ í™œë™ Â· 1ì¸µ ì‚¼ì¶˜ì¹´í˜ ë“±</div>
        </div>
    </div>
</div>

    <div class="floating-tab-bar">
        <div class="tab-item active" onclick="showPage('page-main'); updateTab(this)">
            <i class="bi bi-house-door-fill"></i>
            <span>í™ˆ</span>
        </div>
        <div class="tab-item" onclick="loadActivityHistory(); updateTab(this)">
            <i class="bi bi-journal-text"></i>
            <span>ë‚´ì—­</span>
        </div>
        <div class="tab-scan-btn" onclick="handleScan()">
            <i class="bi bi-qr-code-scan"></i>
        </div>
        <div class="tab-item" onclick="showPage('page-guide'); updateTab(this)">
            <i class="bi bi-info-circle-fill"></i>
            <span>ì•ˆë‚´</span>
        </div>
        <div class="tab-item" onclick="showPage('page-mypage'); updateTab(this)">
            <i class="bi bi-person-fill"></i>
            <span>ë‚´ì •ë³´</span>
        </div>
    </div>

    <div id="scanner-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:20000;">
        <div id="reader" style="width:100%; height:80vh;"></div>
        <button class="btn btn-light" style="position:absolute; bottom:50px; left:50%; transform:translateX(-50%);" onclick="closeScanner()">ë‹«ê¸°</button>
    </div>

</body>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyqYJZwFATpO4fM47j2CZZZsAijbAQXB3XMP10_fEJmTRkXgLX3gEPdceixcbTmv5YQoA/exec";
function updateTab(element) {
    document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
    element.classList.add('active');

    const tabName = element.querySelector('span')?.innerText;
    
    if (tabName === 'ë‚´ì •ë³´') {
        refreshUserData(); // ë°ì´í„° ìµœì‹ í™”
        
        if (userData && userData.isLoggedIn) {
            showPage('page-mypage'); // í˜ì´ì§€ ì „í™˜ ë¨¼ì €

            // [ìˆ˜ì •] 0.1ì´ˆ ë’¤ì— ë°ì´í„° ì£¼ì… (DOMì´ í™•ì‹¤íˆ ê·¸ë ¤ì§„ í›„)
            setTimeout(() => {
                // 1. ì´ë¦„ ê°•ì œ ì£¼ì…
                const nameDisplay = document.getElementById('mypage-user-name');
                if (nameDisplay) nameDisplay.innerText = userData.name || "ì‚¬ìš©ì";

                // 2. í¬ì¸íŠ¸ ì´¤ë¥´ë¥´ ë³µêµ¬
                const myPointEl = document.getElementById('my-u-points');
                if (myPointEl) {
                    const targetPoints = Number(userData.points || 0);
                    animateValue('my-u-points', 0, targetPoints, 1000);
                }

                // 3. QR ì½”ë“œ ìƒì„±
                const qrImg = document.getElementById('my-qr-img');
                if (qrImg && userData.uid) {
                    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
                }
            }, 100);
        } else {
            showPage('page-login');
        }
    }
}
        let userData = JSON.parse(localStorage.getItem('gnpay_user')) || { isLoggedIn: false, points: 0 };
        let selectedImages = [];
        let currentAct = { title: "", amount: 0 };
        const loading = document.getElementById('loading-overlay');
        let html5QrCode;

function showPage(pageId) {
    const saved = localStorage.getItem('gnpay_user');
    if (saved) userData = JSON.parse(saved);

    if (!userData.isLoggedIn && 
        pageId !== 'page-main' && 
        pageId !== 'page-partners' && 
        pageId !== 'page-guide' && 
        pageId !== 'page-login' && 
        pageId !== 'page-signup'
    ) {
        pageId = 'page-login'; 
    }

    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const target = document.getElementById(pageId);
    if(target) target.classList.add('active');
    window.scrollTo(0, 0);

    // [ì´¤ë¥´ë¥´ ë³µêµ¬ í•µì‹¬] í˜ì´ì§€ ì§„ì… ì‹œ ìˆ«ì ì´ˆê¸°í™” í›„ ì• ë‹ˆë©”ì´ì…˜ ì¬ê°€ë™
    if (userData.isLoggedIn) {
        if (pageId === 'page-main') {
            const mainPointEl = document.getElementById('main-u-points');
            if (mainPointEl) {
                mainPointEl.innerText = "0"; // ì´ˆê¸°í™”
                setTimeout(() => {
                    animateValue('main-u-points', 0, Number(userData.points || 0), 1000);
                }, 100);
            }
        }
        if (pageId === 'page-mypage') {
            const myPointEl = document.getElementById('my-u-points');
            if (myPointEl) {
                myPointEl.innerText = "0"; // ì´ˆê¸°í™”
                setTimeout(() => {
                    const nameEl = document.getElementById('mypage-user-name');
                    if (nameEl) nameEl.innerText = userData.name;
                    animateValue('my-u-points', 0, Number(userData.points || 0), 1000);
                }, 100);
            }
        }
    }

    if (typeof syncTabBar === 'function') syncTabBar(pageId);

    const tabBar = document.querySelector('.floating-tab-bar');
    if (tabBar) {
        tabBar.style.display = (pageId === 'page-login' || pageId === 'page-signup') ? 'none' : 'flex';
    }
}
function updateUI() {
    const authArea = document.getElementById('auth-area');
    const welcome = document.getElementById('welcome-message');
    const pointDisplay = document.getElementById('main-u-points');
    const qrTrigger = document.getElementById('qr-trigger');

    if (userData.isLoggedIn) {
        authArea.innerHTML = `<span class="auth-link" style="color:var(--primary); font-weight:800;" onclick="showPage('page-mypage')">${userData.name}ë‹˜</span><span style="color:#eee; font-size:0.7rem;">|</span><span class="auth-link" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</span>`;
        welcome.innerHTML = `${userData.name}ë‹˜, ì˜¤ëŠ˜ë„<br><strong>í‘¸ë¥¸ ê¹€ë…•ì„ ì§€ì¼œìš”!</strong>`;
        
        // [ì´¤ë¥´ë¥´ ì—”ì§„ ê°€ë™] ê·¸ëƒ¥ ìˆ«ìë¥¼ ë„£ì§€ ì•Šê³  ì• ë‹ˆë©”ì´ì…˜ì„ ëŒë¦½ë‹ˆë‹¤.
        const targetPoints = Number(userData.points || 0);
        animateValue('main-u-points', 0, targetPoints, 1000); // 1ì´ˆ ë™ì•ˆ ì´¤ë¥´ë¥´

        qrTrigger.onclick = (e) => {
            const tabBar = document.querySelector('.floating-tab-bar');
            if (tabBar) tabBar.style.display = 'none';
            document.getElementById('qr-focus-layer').style.display = 'flex';
            animateValue('focus-points', 0, targetPoints, 1000);
            document.getElementById('qr-img-large').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
        };
        
        qrTrigger.style.animation = "breathe 2s infinite ease-in-out";
        updateActivityBadge();

        if (!window.pointSyncInterval) {
            window.pointSyncInterval = setInterval(syncPointsRealtime, 5000);
        }
    } else {
        // ë¹„ë¡œê·¸ì¸ ìƒíƒœ ë¡œì§ (í˜„í–‰ ìœ ì§€)
        authArea.innerHTML = `<span class="auth-link" onclick="showPage('page-signup')">íšŒì›ê°€ì…</span><span style="color:#eee; font-size:0.7rem;">|</span><span class="auth-link text-dark" onclick="showPage('page-login')">ë¡œê·¸ì¸</span>`;
        welcome.innerHTML = `í•¨ê»˜ ë§Œë“œëŠ”<br><strong>í‘¸ë¥¸ ê¹€ë…• Wave</strong>`;
        pointDisplay.innerHTML = `<span style="font-size: 0.95rem; font-weight: 800; color: var(--primary);">ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš” <i class="bi bi-chevron-right"></i></span>`;
        qrTrigger.onclick = () => showPage('page-login');
        qrTrigger.style.animation = "login-glow 2s infinite ease-in-out";
    }
}
// [ì¶”ê°€] ë°°ì§€ ìˆ«ìë¥¼ ì‹¤ì œë¡œ ê³„ì‚°í•˜ê³  ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
function updateActivityBadge() {
    // 1. ìˆ«ìë¥¼ í‘œì‹œí•  ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const badge = document.getElementById('activity-badge-count');
    // 2. ì‚¬ì¥ë‹˜ì´ ë§Œë“œì‹  í™œë™ ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const container = document.getElementById('activity-list-container');
    
    if (badge && container) {
        // ì»¨í…Œì´ë„ˆ ì•ˆì— ìˆëŠ” 'dashboard-card' ê°œìˆ˜ë¥¼ ì„¸ì–´ë´…ë‹ˆë‹¤.
        const count = container.querySelectorAll('.dashboard-card').length;
        
        if (count > 0) {
            badge.innerText = count;  // ê°œìˆ˜ë¥¼ ë°°ì§€ì— ì…ë ¥
            badge.style.display = 'flex'; // ë°°ì§€ ë³´ì´ê¸°
        } else {
            badge.style.display = 'none'; // ê°œìˆ˜ê°€ 0ì´ë©´ ìˆ¨ê¸°ê¸°
        }
    }
}

        async function syncPointsRealtime() {
            if (!userData.isLoggedIn) return;
            try {
                const res = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ type: 'login', email: userData.email, password: userData.password })
                }).then(r => r.json());

                if (res.result === 'success') {
                    userData.points = res.user.points;
                    localStorage.setItem('gnpay_user', JSON.stringify(userData));
                    document.querySelectorAll('.user-points-display').forEach(el => {
                        el.innerText = Number(res.user.points).toLocaleString();
                    });
                }
            } catch (e) { console.log("sync..."); }
        }

function goToMyPage() {
    // 1. ë§ˆì´í˜ì´ì§€ë¡œ í™”ë©´ ì „í™˜
    showPage('page-mypage');
    
    // 2. [í•µì‹¬] ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ ì‹¤ì œ ì´ë¦„ì„ í™”ë©´ì— ë°•ì•„ë„£ê¸°
    const nameDisplay = document.getElementById('mypage-user-name');
    if (nameDisplay && userData.name) {
        nameDisplay.innerText = userData.name;
    }

    // 3. í¬ì¸íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
    const pointDisplay = document.getElementById('my-u-points');
    if (pointDisplay) {
        pointDisplay.innerText = Number(userData.points || 0).toLocaleString();
    }

    // 4. QR ì½”ë“œ ìƒì„± (ì‚¬ìš©ì UID ê¸°ë°˜)
    const qrImg = document.getElementById('my-qr-img');
    if (qrImg && userData.uid) {
        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
    }
}

    // 4. QR ì½”ë“œ ìƒì„±
    document.getElementById('my-qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;


       async function submitLogin() {
    // [ì¹¼ê° ìœ ì§€] í˜•ë‹˜ì´ ì“°ì‹œëŠ” ID ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤
    const email = document.getElementById('login-email').value;
    const pw = document.getElementById('login-pw').value;
    
    if(!email || !pw) return alert("ì…ë ¥í•´ì£¼ì„¸ìš”.");
    loading.style.display='flex';
    
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ type: 'login', email, password: pw }) 
        }).then(r => r.json());

        if (res.result === 'success') {
            // [ì§€í›ˆì´ì˜ ì—”ì§„ ì¶”ê°€] ì•„ì´ë”” ê¸°ì–µí•˜ê¸° ì²´í¬ ì—¬ë¶€ í™•ì¸
            const rememberMe = document.getElementById('remember-me').checked;
            if (rememberMe) {
                localStorage.setItem('gnpay_remember_email', email);
            } else {
                localStorage.removeItem('gnpay_remember_email');
            }

            userData = { isLoggedIn: true, ...res.user, password: pw };
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            updateUI();
            showPage('page-main');
        } else { 
            alert(res.message); 
        }
    } catch (e) { 
        alert("ë¡œê·¸ì¸ ì˜¤ë¥˜"); 
    }
    loading.style.display='none';
}
        async function submitSignup() {
            const data = { type: 'signup', name: document.getElementById('reg-name').value, email: document.getElementById('reg-email').value, password: document.getElementById('reg-pw').value, phone: document.getElementById('reg-phone').value };
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(data) }).then(r => r.json());
                if (res.result === 'success') { alert("ê°€ì… ì„±ê³µ!"); showPage('page-login'); } else { alert(res.message); }
            } catch (e) { alert("íšŒì›ê°€ì… ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

        function openSubmit(title, amount, desc) {
            if (!userData.isLoggedIn) return showPage('page-login');
            currentAct = { title, amount };
            document.getElementById('act-title-display').innerText = title;
            document.getElementById('act-desc-display').innerHTML = desc || "í™œë™ ë‚´ìš©ì„ ì¸ì¦í•˜ì„¸ìš”.";
            showPage('page-submit-act');
        }

        // [ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜] ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥ë°›ì•„ ì„œë²„(GAS)ì— ì„ì‹œë¹„ë²ˆ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
// 1. íŒì—… ì—´ê¸° (ê¸°ì¡´ì˜ prompt ëŒ€ì‹  ì´ê±¸ ì‹¤í–‰)
function handleForgotPassword() {
    document.getElementById('pw-reset-layer').style.display = 'flex';
    document.getElementById('reset-email').value = '';
    document.getElementById('reset-phone').value = '';
}

// 2. ì‹¤ì œ ì„œë²„ ì „ì†¡ (ì«€ë“í•œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰)
async function processPwReset() {
    const email = document.getElementById('reset-email').value;
    const phone = document.getElementById('reset-phone').value;

    if (!email || !phone) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");

    loading.style.display = 'flex';
    try {
        const res = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ 
                type: 'requestPwReset', 
                email: email, 
                phone: phone.replace(/[^0-9]/g, "") 
            })
        }).then(r => r.json());

        if (res.result === 'success') {
            alert("ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!\në©”ì¼ë¡œ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤.");
            document.getElementById('pw-reset-layer').style.display = 'none';
        } else {
            alert(res.message);
        }
    } catch (e) {
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    }
    loading.style.display = 'none';
}
async function previewImages() {
    const fileInput = document.getElementById('act-files');
    const previewContainer = document.getElementById('image-preview');
    const files = fileInput.files;
    
    if (files.length === 0) return;

    previewContainer.innerHTML = ''; // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì§€ìš°ê¸°
    selectedImages = []; // ì €ì¥ì†Œ ì´ˆê¸°í™”
    
    loading.style.display = 'flex'; // ì••ì¶• ì‹œì‘í•˜ë‹ˆ ë¡œë”©ë°” ë„ìš°ê¸°

    const options = {
        maxSizeMB: 0.5,          // 0.5MBê¹Œì§€ ì••ì¶•
        maxWidthOrHeight: 1280, // ê°€ë¡œì„¸ë¡œ ìµœëŒ€ 1280px
        useWebWorker: true
    };

    try {
        for (let i = 0; i < files.length; i++) {
            // [í•µì‹¬] ì—¬ê¸°ì„œ ì‚¬ì¥ë‹˜ì´ ê°€ì ¸ì˜¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì••ì¶•ì„ ì§„í–‰í•©ë‹ˆë‹¤
            const compressedFile = await imageCompression(files[i], options);
            
            const reader = new FileReader();
            reader.readAsDataURL(compressedFile);
            
            await new Promise((resolve) => {
                reader.onloadend = () => {
                    const base64data = reader.result;
                    selectedImages.push(base64data);
                    
                    const img = document.createElement('img');
                    img.src = base64data;
                    img.className = 'history-img'; // ì‚¬ì¥ë‹˜ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€
                    img.style.width = '80px';
                    img.style.height = '80px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '12px';
                    previewContainer.appendChild(img);
                    resolve();
                };
            });
        }
    } catch (error) {
        console.error(error);
        alert("ì´ë¯¸ì§€ ì••ì¶• ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    } finally {
        loading.style.display = 'none'; // ì••ì¶• ëë‚¬ìœ¼ë‹ˆ ë¡œë”©ë°” ë„ê¸°
    }
}
        async function submitActivity() {
            const content = document.getElementById('act-content').value;
            if(!content || selectedImages.length === 0) return alert("í™œë™ ë‚´ìš©ê³¼ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.");
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'submitActivity', email: userData.email, title: currentAct.title, content: content, images: selectedImages, pointAmount: currentAct.amount }) }).then(r => r.json());
                if(res.result === 'success') { alert("ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"); showPage('page-main'); }
                else { alert("ì˜¤ë¥˜: " + res.message); }
            } catch(e) { alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

   // [ìµœì¢…] ë‚´ì—­ ì¡°íšŒ í•¨ìˆ˜: ì„œë²„ì—ì„œ ì¥ë¶€ì™€ ì‹ ì²­ë‚´ì—­ì„ ë™ì‹œì— ê°€ì ¸ì˜´
async function loadActivityHistory() {
    showPage('page-history');
    switchHistoryTab('point'); 

    const pointList = document.getElementById('point-history-list');
    const activityList = document.getElementById('activity-history-list');
    
    pointList.innerHTML = '<div class="text-center p-4 small text-muted">ë°ì´í„° ë™ê¸°í™” ì¤‘...</div>';
    activityList.innerHTML = '<div class="text-center p-4 small text-muted">ë°ì´í„° ë™ê¸°í™” ì¤‘...</div>';

    try {
        const response = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ 
                type: 'login', 
                email: userData.email, 
                password: userData.password 
            }) 
        });
        const res = await response.json();

        if (res.result === 'success') {
            const pLogs = res.user.history || [];       // PointLogs ë°ì´í„°
            const aLogs = res.user.applications || [];  // Applications ë°ì´í„°

            let pHtml = '';
            let aHtml = '';

            // 1. í¬ì¸íŠ¸ ë‚´ì—­ ë¹Œë“œ (ì¥ë¶€ ë°ì´í„°)
            if (pLogs.length > 0) {
                pLogs.forEach(log => {
                    const isPlus = Number(log.amount) > 0;
                    pHtml += `
                        <div class="dashboard-card mb-3" style="padding:18px; animation:none; border-left:5px solid ${isPlus ? 'var(--primary)' : '#ff4d4d'}; width:100%; margin:0 0 12px 0;">
                            <div style="flex:1;">
                                <div class="fw-bold" style="font-size:1rem;">${log.title}</div>
                                <div class="small text-muted">${log.date}</div>
                            </div>
                            <div class="fw-bold" style="color:${isPlus ? 'var(--primary)' : '#ff4d4d'}">
                                ${isPlus ? '+' : ''}${Number(log.amount).toLocaleString()} P
                            </div>
                        </div>`;
                });
            }

            // 2. í™œë™ í˜„í™© ë¹Œë“œ (ì‚¬ì§„ í¼ì¹˜ê¸° ê¸°ëŠ¥ íƒ‘ì¬)
if (aLogs.length > 0) {
    aLogs.forEach((app, idx) => {
        const s = app.status || 'ëŒ€ê¸°';
        // ìŠ¹ì¸ì´ë©´ ì´ˆë¡(var(--primary)), ë°˜ë ¤ë©´ ë¹¨ê°•(#ff4d4d), ëŒ€ê¸°ë©´ ë…¸ë‘(#ffcc00)
        const sColor = s === 'ìŠ¹ì¸' ? 'var(--primary)' : (s === 'ë°˜ë ¤' ? '#ff4d4d' : '#ffcc00');
        
        // ì‚¬ì§„ ë°ì´í„° í™•ë³´
        const pic1 = app.img1 || app.ì‚¬ì§„1 || app.photo1;
        const pic2 = app.img2 || app.ì‚¬ì§„2 || app.photo2;
        const pic3 = app.img3 || app.ì‚¬ì§„3 || app.photo3;

        aHtml += `
            <div class="dashboard-card mb-3" style="padding:18px; border-left:5px solid ${sColor}; flex-direction:column; align-items:flex-start; cursor:pointer;" 
                 onclick="const d = document.getElementById('detail-${idx}'); d.style.display = (d.style.display === 'none' ? 'block' : 'none')">
                
                <div class="d-flex justify-content-between w-100 align-items-center">
                    <div style="flex:1;">
                        <div class="fw-bold" style="font-size:1rem; color:#333;">${app.title}</div>
                        <div class="small text-muted">${app.date}</div>
                    </div>
                    <div class="text-end">
                        <div class="badge mb-1" style="background:${sColor}; color:white; border-radius:8px; font-size:0.7rem; padding:4px 10px;">${s}</div>
                        ${s === 'ìŠ¹ì¸' ? `<div class="fw-bold" style="color:var(--primary); font-size:0.9rem;">+${Number(app.points).toLocaleString()} P</div>` : ''}
                    </div>
                </div>

                <div id="detail-${idx}" style="display:none; width:100%; margin-top:15px; border-top:1px dashed #eee; padding-top:15px;">
                    <div class="row g-2 mb-3">
                        ${pic1 ? `<div class="col-4"><img src="${pic1}" class="img-fluid rounded-3 shadow-sm" style="aspect-ratio:1; object-fit:cover;"></div>` : ''}
                        ${pic2 ? `<div class="col-4"><img src="${pic2}" class="img-fluid rounded-3 shadow-sm" style="aspect-ratio:1; object-fit:cover;"></div>` : ''}
                        ${pic3 ? `<div class="col-4"><img src="${pic3}" class="img-fluid rounded-3 shadow-sm" style="aspect-ratio:1; object-fit:cover;"></div>` : ''}
                    </div>

                    ${s === 'ë°˜ë ¤' ? `
                        <div style="background:#fff5f5; padding:12px; border-radius:12px; border:1px solid #ffe3e3;">
                            <div class="d-flex justify-content-between align-items:center;">
                                <span class="small text-muted">í¬ì¸íŠ¸ íšë“ ì‹¤íŒ¨</span>
                                <span class="fw-bold" style="color:#ff4d4d; text-decoration:line-through;">+${Number(app.points).toLocaleString()} P</span>
                            </div>
                            ${app.message ? `<div class="mt-2 small" style="color:#e03131;"><strong>ì‚¬ìœ :</strong> ${app.message}</div>` : ''}
                        </div>
                    ` : `
                        <div class="small text-muted text-center py-2" style="background:#f8f9fa; border-radius:10px;">
                            ${s === 'ìŠ¹ì¸' ? 'ì •ìƒ ìŠ¹ì¸ëœ í™œë™ì…ë‹ˆë‹¤.' : 'ê´€ë¦¬ìê°€ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤.'}
                        </div>
                    `}
                </div>
            </div>`;
    });
}

            pointList.innerHTML = pHtml || '<div class="text-center text-muted mt-5 small">í¬ì¸íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            activityList.innerHTML = aHtml || '<div class="text-center text-muted mt-5 small">í™œë™ ì‹ ì²­ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            
            userData.points = res.user.points;
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            updateUI();
        }
    } catch (e) {
        console.error(e);
        pointList.innerHTML = '<div class="text-center text-muted mt-5 small">ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
    }
}
// ì •ë³´ ìˆ˜ì • ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
function openEditInfo() {
    const layer = document.getElementById('profile-edit-layer');
    if (layer) {
        layer.style.display = 'flex';
        
        if (userData) {
            // ì‚¬ì¥ë‹˜ ìš”ì²­: íŒì—… ì œëª©ì— ì´ë¦„ ë„£ê¸°
            const nameTarget = document.getElementById('edit-user-name');
            if (nameTarget) nameTarget.innerText = userData.name || "ì‚¬ìš©ì";

            // ê¸°ì¡´ ì •ë³´ ì±„ìš°ê¸°
            document.getElementById('popup-edit-region').value = userData.region || "ì œì£¼";
            document.getElementById('popup-edit-phone').value = userData.phone || "";
        }
        document.getElementById('popup-edit-pw').value = "";
    }
}

// íŒì—… ì•ˆì—ì„œ 'ìˆ˜ì •ì™„ë£Œ' ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
async function submitPopupEdit() {
    const newRegion = document.getElementById('popup-edit-region').value;
    const newPhone = document.getElementById('popup-edit-phone').value;
    const newPw = document.getElementById('popup-edit-pw').value;

    if(!newPhone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    loading.style.display = 'flex';
    try {
        const res = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({
                type: 'updateUserInfo',
                email: userData.email,
                newPhone: newPhone,
                newPw: newPw,
                newRegion: newRegion,
                newGender: userData.gender // ê¸°ì¡´ ì •ë³´ ìœ ì§€
            })
        }).then(r => r.json());

        if(res.result === 'success') {
            alert("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ˜Š");
            
            // ë‚´ í°ì˜ ë¡œì»¬ ë°ì´í„°ë„ ì¦‰ì‹œ ê°±ì‹ 
            userData.phone = newPhone;
            userData.region = newRegion;
            if(newPw) userData.password = newPw;
            
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            
            // íŒì—… ë‹«ê¸°
            document.getElementById('profile-edit-layer').style.display = 'none';
        } else {
            alert("ìˆ˜ì • ì‹¤íŒ¨: " + res.message);
        }
    } catch(e) {
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”!");
    }
    loading.style.display = 'none';
}
async function submitEditInfo() {
    // 1. í™”ë©´ì—ì„œ ê°’ ê¸ì–´ì˜¤ê¸°
    const newPhone = document.getElementById('edit-phone').value;
    const newPw = document.getElementById('edit-pw').value;
    const newGender = document.getElementById('edit-gender').value; 
    const newRegion = document.getElementById('edit-region').value;

    if(!newPhone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    loading.style.display = 'flex';
    try {
        // 2. ì„œë²„(GAS)ì— ëª¨ë“  ì •ë³´ë¥¼ ì‹¤ì–´ì„œ ë³´ëƒ„
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ 
                type: 'updateUserInfo', 
                email: userData.email, 
                newPhone: newPhone, 
                newPw: newPw,
                newGender: newGender, 
                newRegion: newRegion  
            }) 
        }).then(r => r.json());

        if(res.result === 'success') {
            alert("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ˜Š");
            
            // 3. ë‚´ í°(ë©”ëª¨ë¦¬) ë°ì´í„°ë„ ì¦‰ì‹œ ê°±ì‹ 
            userData.phone = newPhone;
            userData.gender = newGender;
            userData.region = newRegion;
            if(newPw) userData.password = newPw;

            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            showPage('page-mypage');
        } else { 
            alert("ìˆ˜ì • ì‹¤íŒ¨: " + res.message); 
        }
    } catch(e) { 
        alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!"); 
    }
    loading.style.display = 'none';
}
        async function handleScan() {
            if (!userData.isLoggedIn) return showPage('page-login');
            document.getElementById('scanner-modal').style.display = 'block';
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, async (text) => {
                closeScanner();
                processAddPoints(100, "í˜„ì¥ QR ì¸ì¦");
            });
        }
        function closeScanner() { if(html5QrCode) html5QrCode.stop(); document.getElementById('scanner-modal').style.display='none'; }
        
async function processAddPoints(amount, action) {
    loading.style.display = 'flex';
    try {
        const response = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ 
                type: 'addPoints', 
                email: userData.email, 
                amount: amount, 
                action: action // "í˜„ì¥ QR ì ë¦½" ë“±ì´ Descriptionìœ¼ë¡œ ë“¤ì–´ê°
            }) 
        });
        const res = await response.json();

        if (res.result === 'success') {
            alert(amount + "í¬ì¸íŠ¸ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤!");
            
            // ì•± ë‚´ë¶€ ë°ì´í„° ë™ê¸°í™”
            userData.points = res.newPoints;
            
            // ë‚´ì—­ íƒ­ì„ ëˆŒë €ì„ ë•Œ ë°”ë¡œ ë³´ì´ê²Œ ë¡œì»¬ ë°°ì—´ì—ë„ ì„ì‹œ ì¶”ê°€
            if(!userData.pointLogs) userData.pointLogs = [];
            userData.pointLogs.unshift({
                Date: "ë°©ê¸ˆ ì „",
                Description: action,
                Change: amount
            });

            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            updateUI();
        }
    } catch (e) {
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    }
    loading.style.display = 'none';
}

        function logout() { if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { localStorage.removeItem('gnpay_user'); location.reload(); } }

// [ì „ì²´ êµì²´] ë©”ì¸ ì¹´ë“œ í´ë¦­ ì‹œ
document.getElementById('qr-trigger').onclick = (e) => {
    if (!userData.isLoggedIn) { showPage('page-login'); return; }
    
    // í•˜ë‹¨ë°” ì°¾ì•„ì„œ í™•ì‹¤í•˜ê²Œ ì•„ë˜ë¡œ 200px ë˜ì ¸ë²„ë¦¬ê¸°
    const tabBar = document.querySelector('.floating-tab-bar');
    if (tabBar) {
        tabBar.style.setProperty('transform', 'translateX(-50%) translateY(200px)', 'important');
    }
    
    // QR íŒì—… ë„ìš°ê¸°
    document.getElementById('qr-focus-layer').style.display = 'flex';
    
    const targetVal = Number(userData.points || 0);
    animateValue('focus-points', 0, targetVal, 1000);
    document.getElementById('qr-img-large').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
};

// [ì „ì²´ êµì²´] íŒì—… ë‹«ì„ ë•Œ (ë‹«ê¸° ë²„íŠ¼ì— onclick="closeQR()" ê¼­ ë„£ì–´ì£¼ì„¸ìš”!)
// [í™•ì¸ ì‚¬ì‚´ ë²„ì „] ë”± í•˜ë‚˜ë§Œ ë‚¨ê¸°ì„¸ìš”
function closeQR() {
    // 1. QR íŒì—… ë„ê¸°
    document.getElementById('qr-focus-layer').style.display = 'none';
    
    // 2. í•˜ë‹¨ë°” ë‹¤ì‹œ ë¬´ì¡°ê±´ ì‚´ë¦¬ê¸° (display ë°©ì‹ì„ ì“°ë©´ ì ˆëŒ€ ì‹¤íŒ¨ ì•ˆ í•©ë‹ˆë‹¤)
    const tabBar = document.querySelector('.floating-tab-bar');
    if (tabBar) {
        tabBar.style.setProperty('display', 'flex', 'important');
    }
}
function animateValue(id, start, end, duration) {
    const obj = document.getElementById(id);
    if (!obj) return;
    
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        // ìˆ«ìë¥¼ ì½¤ë§ˆ(,) í¬í•¨í•´ì„œ ì˜ˆì˜ê²Œ ì°ì–´ì¤ë‹ˆë‹¤
        obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    window.requestAnimationFrame(step);
}
      window.onload = function() {
    // 1. ê¸°ì¡´ UI ì—…ë°ì´íŠ¸ ì—”ì§„ ê°€ë™
    updateUI();

    // 2. [ì§€í›ˆì´ì˜ ì—”ì§„ ì¶”ê°€] ì €ì¥ëœ ì•„ì´ë””ê°€ ìˆìœ¼ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedEmail = localStorage.getItem('gnpay_remember_email');
    const emailInput = document.getElementById('login-email');
    const rememberCheckbox = document.getElementById('remember-me');

    if (savedEmail && emailInput) {
        emailInput.value = savedEmail;
        if (rememberCheckbox) rememberCheckbox.checked = true;
    }
};
function forceShowPage(pageId) {
    // 1. ëª¨ë“  í˜ì´ì§€ë¥¼ ì‹¹ ë‹¤ ìˆ¨ê¹ë‹ˆë‹¤.
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // 2. ê°€ë§¹ì  í˜ì´ì§€(page-partners)ë§Œ ë”± ë³´ì—¬ì¤ë‹ˆë‹¤.
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.add('active');
        window.scrollTo(0, 0);
    }
}  
function checkAndSignup() {
    const agree = document.getElementById('reg-agree').checked;
    const gender = document.getElementById('reg-gender').value;
    const region = document.getElementById('reg-region').value;

    if (!gender) return alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!region) return alert("ê±°ì£¼ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!agree) return alert("ê°œì¸ì •ë³´ ì œê³µì— ë™ì˜í•´ì£¼ì„¸ìš”.");
    
    // ëª¨ë“  ì²´í¬ í†µê³¼ ì‹œ ê¸°ì¡´ ê°€ì… í•¨ìˆ˜ ì‹¤í–‰
    submitSignup(); 
}
document.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        const activePage = document.querySelector('.page.active');
        if (activePage) {
            if (activePage.id === 'page-login') submitLogin();
            else if (activePage.id === 'page-signup') submitSignup();
        }
    }
});  
function switchHistoryTab(type) {
    const pointTab = document.getElementById('tab-point');
    const activityTab = document.getElementById('tab-activity');
    const pointSection = document.getElementById('history-point-section');
    const activitySection = document.getElementById('history-activity-section');

    if (type === 'point') {
        pointTab.className = 'flex-fill text-center py-2 active-tab';
        activityTab.className = 'flex-fill text-center py-2 inactive-tab';
        pointSection.style.display = 'block';
        activitySection.style.display = 'none';
    } else {
        pointTab.className = 'flex-fill text-center py-2 inactive-tab';
        activityTab.className = 'flex-fill text-center py-2 active-tab';
        pointSection.style.display = 'none';
        activitySection.style.display = 'block';
    }
}
async function loadUserHistory() {
    // 1. íƒ­ ë©”ë‰´ êµ¬ì„± (í¬ì¸íŠ¸ / í™œë™)
    const historyHtml = `
        <div class="p-3">
            <div class="d-flex gap-2 mb-4 bg-white p-1 rounded-4 shadow-sm">
                <button class="btn w-50 rounded-4 fw-bold active-tab" id="tab-p" onclick="switchTab('p')">í¬ì¸íŠ¸ ë‚´ì—­</button>
                <button class="btn w-50 rounded-4 fw-bold" id="tab-a" onclick="switchTab('a')">í™œë™ ì‹ ì²­</button>
            </div>
            
            <div id="history-content">
                </div>
        </div>
    `;
    document.getElementById('page-history').innerHTML = historyHtml;
    renderPointLogs(); // ê¸°ë³¸ê°’ìœ¼ë¡œ í¬ì¸íŠ¸ ë‚´ì—­ ë¨¼ì € ë³´ì—¬ì¤Œ
}

// [í¬ì¸íŠ¸ ë‚´ì—­ ë Œë”ë§]
function renderPointLogs() {
    const container = document.getElementById('history-content');
    // userData.historyëŠ” ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ PointLogs ë°ì´í„°
    if (!userData.history || userData.history.length === 0) {
        container.innerHTML = '<div class="text-center py-5 text-muted">í¬ì¸íŠ¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    container.innerHTML = userData.history.map(log => `
        <div class="dashboard-card mb-3 p-3 d-flex justify-content-between align-items-center">
            <div>
                <div class="fw-bold">${log.title}</div>
                <div class="small text-muted">${log.date}</div>
            </div>
            <div class="fw-bold ${log.amount > 0 ? 'text-primary' : 'text-danger'}">
                ${log.amount > 0 ? '+' : ''}${log.amount.toLocaleString()} P
            </div>
        </div>
    `).join('');
}

// [í™œë™ ì‹ ì²­ í˜„í™© ë Œë”ë§]
function renderAppLogs() {
    const container = document.getElementById('history-content');
    if (!userData.applications || userData.applications.length === 0) {
        container.innerHTML = '<div class="text-center py-5 text-muted">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    container.innerHTML = userData.applications.map(app => {
        let statusClass = 'bg-warning'; // ëŒ€ê¸°
        if(app.status === 'ìŠ¹ì¸') statusClass = 'bg-success';
        if(app.status === 'ë°˜ë ¤') statusClass = 'bg-danger';

        return `
            <div class="dashboard-card mb-3 p-3">
                <div class="d-flex justify-content-between">
                    <div class="fw-bold">${app.title}</div>
                    <span class="badge ${statusClass}">${app.status}</span>
                </div>
                <div class="d-flex justify-content-between mt-2 align-items-end">
                    <div class="small text-muted">${app.date}</div>
                    <div class="fw-bold text-secondary">+${app.amount.toLocaleString()} P ì˜ˆì •</div>
                </div>
            </div>
        `;
    }).join('');
}
function syncTabBar(pageId) {
    // 1. ì¼ë‹¨ ëª¨ë“  ë²„íŠ¼ì˜ ë¶ˆì„ ì‹¹ ë•ë‹ˆë‹¤ (ì´ˆê¸°í™”)
    document.querySelectorAll('.tab-item').forEach(tab => {
        tab.classList.remove('active');
    });

    // 2. í˜„ì¬ í˜ì´ì§€ IDë¥¼ ë³´ê³  ëª‡ ë²ˆì§¸ ë²„íŠ¼ì„ ì¼¤ì§€ ê²°ì •í•©ë‹ˆë‹¤
    let targetIdx = -1; // ê¸°ë³¸ê°’ì€ -1 (ì•„ë¬´ê²ƒë„ ì•ˆ ì¼¬)
    if (pageId === 'page-main') targetIdx = 0;         // í™ˆ
    else if (pageId === 'page-history') targetIdx = 1;  // ë‚´ì—­
    else if (pageId === 'page-guide') targetIdx = 2;    // ì•ˆë‚´
    else if (pageId === 'page-mypage') targetIdx = 3;   // ë‚´ì •ë³´

    // 3. ë§Œì•½ í•˜ë‹¨ë°”ì— ìˆëŠ” í˜ì´ì§€ë¼ë©´ í•´ë‹¹ ë²ˆí˜¸ ì•„ì´ì½˜ë§Œ ë¶ˆì„ ì¼­ë‹ˆë‹¤
    const tabItems = document.querySelectorAll('.tab-item');
    if (targetIdx !== -1 && tabItems[targetIdx]) {
        tabItems[targetIdx].classList.add('active');
    }
}
function refreshUserData() {
    const saved = localStorage.getItem('gnpay_user');
    if (saved) userData = JSON.parse(saved);
}
function openMypage() {
    document.querySelector('.bottom-nav').style.transform = 'translateY(100%)'; // í•˜ë‹¨ë°” ìˆ¨ê¸°ê¸°
    showPage('page-mypage');
}

// ë§ˆì´í˜ì´ì§€ ë‹«ì„ ë•Œ ë‹¤ì‹œ ë³´ì—¬ì£¼ê¸°
function closeMypage() {
    document.querySelector('.bottom-nav').style.transform = 'translateY(0)'; // í•˜ë‹¨ë°” ë³µêµ¬
    showPage('page-main');
}
// ê°€ì´ë“œ ìŠ¬ë¼ì´ë” ì‹¤ì‹œê°„ ì¹´ë“œ í™œì„±í™” ì—”ì§„
const guideSlider = document.getElementById('guide-slider-scroll');

if (guideSlider) {
    guideSlider.addEventListener('scroll', () => {
        const cards = guideSlider.querySelectorAll('.guide-card');
        const containerRect = guideSlider.getBoundingClientRect();
        const containerCenter = containerRect.left + containerRect.width / 2;

        cards.forEach((card) => {
            const cardRect = card.getBoundingClientRect();
            const cardCenter = cardRect.left + cardRect.width / 2;
            
            // ì¹´ë“œì˜ ì¤‘ì‹¬ì´ ì»¨í…Œì´ë„ˆì˜ ì¤‘ì‹¬ê³¼ ê°€ê¹Œì›Œì§€ë©´(ì˜¤ì°¨ë²”ìœ„ ë‚´) í™œì„±í™”
            const distance = Math.abs(containerCenter - cardCenter);
            
            if (distance < 100) { // ì¤‘ì•™ ê¸°ì¤€ 100px ì´ë‚´ë¡œ ë“¤ì–´ì˜¤ë©´
                card.classList.add('active-focus');
            } else {
                card.classList.remove('active-focus');
            }
        });
    });
}
</script>
</body>
</html>
