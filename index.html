<!DOCTYPE html>
<html lang="ko">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#e6f7f6"> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ê¹€ë…•í˜ì´ 2.0</title>
    <link rel="icon" href="https://gnpay.my/log.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.1/dist/browser-image-compression.js"></script>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
   <link rel="apple-touch-icon" href="https://gnpay.my/log.png">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
   <link rel="shortcut icon" href="https://gnpay.my/log.png">
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    :root { --primary: #01b2ad; --primary-grad: linear-gradient(135deg, #01b2ad 0%, #00d2ff 100%); --bg-grad: linear-gradient(180deg, #e6f7f6 0%, #f8fcfc 40%, #ffffff 100%); }
    
    body { 
    font-family: 'Pretendard', sans-serif; 
    background: var(--bg-grad); 
    margin:0; 
    padding: env(safe-area-inset-top, 20px) 0 100px 0; /* ì•„ì´í° ë…¸ì¹˜ë§Œí¼ ì•Œì•„ì„œ ë„ì›€ */
    min-height: 100vh; 
    color: #1a1a1a; 
    overflow-x: hidden; 
}
    
    .top-nav { 
    display: flex; 
    justify-content: space-between; 
    align-items: flex-start; 
    padding: 15px 20px 5px 26px; 
    position: sticky; /* ìŠ¤í¬ë¡¤ í•´ë„ ê³ ì •ë¨ */
    top: 0; 
    z-index: 1000; /* ëª¨ë“  ìš”ì†Œë³´ë‹¤ ìœ„ì— ìˆê²Œ í•¨ */
    background: rgba(230, 247, 246, 0.8); /* ë°°ê²½ì´ë‘ ë˜‘ê°™ì€ ë¯¼íŠ¸ íˆ¬ëª…ìƒ‰ */
    backdrop-filter: blur(10px); /* ë’¤ì— ê¸€ìê°€ ìŠ¤ì³ ì§€ë‚˜ê°ˆ ë•Œ ì€ì€í•˜ê²Œ ë¹„ì¹¨ (ëŸ­ì…”ë¦¬ í¬ì¸íŠ¸) */
    -webkit-backdrop-filter: blur(10px);
}
    .auth-links { display: flex; gap: 5px; align-items: center; }
    .auth-link { font-size: 0.8rem; font-weight: 700; color: #888; text-decoration: none; cursor: pointer; padding: 5px; line-height: 1; }
    
    /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìˆ¨ì‰¬ê¸° */
    .dashboard-card { 
        background: white; margin: 0 20px 15px; padding: 20px; border-radius: 24px; 
        display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        position: relative; animation: breathe 2s infinite ease-in-out; transition: transform 0.2s ease;
        border: 1px solid rgba(1, 178, 173, 0.1);
    }
    
    @keyframes breathe {
        0% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.15); }
        50% { transform: scale(1.04); box-shadow: 0 0 35px rgba(1, 178, 173, 0.5), 0 10px 40px rgba(0, 210, 255, 0.3); }
        100% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.15); }
    }

    .amount-text { font-size: 1.8rem; font-weight: 900; background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    /* [ìˆ˜ì •] ë§ˆì´í˜ì´ì§€ í”„ë¦¬ë¯¸ì—„ ì¹´ë“œ ë° ì¼ì²´í˜• QR ë””ìì¸ */
    .premium-card {
        background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
        border-radius: 35px; padding: 50px 20px 35px; margin: 20px; color: white;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        border: 1px solid rgba(255,255,255,0.05);
    }

    /* ë¡œê³ ì™€ QRì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ ìˆ¨ì‰¬ê²Œ í•˜ëŠ” ì»¨í…Œì´ë„ˆ */
    .qr-integration-box {
        position: relative; display: inline-block; margin-bottom: 25px;
        animation: qr-breathe 2s infinite ease-in-out; /* í†µí•© ìˆ¨ì‰¬ê¸° */
    }

    .qr-frame {
        background: white; padding: 15px; border-radius: 24px; display: inline-block;
        box-shadow: 0 0 20px rgba(1, 178, 173, 0.4);
    }

    /* ë¡œê³  ìƒë‹¨ ì¤‘ì•™ ì¹¨ë²” ë°°ì¹˜ */
    .qr-top-logo {
        position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
        width: 55px; height: 55px; background: var(--primary-grad);
        border-radius: 18px; border: 3px solid #1a1a1a; /* ì¹´ë“œ ë°°ê²½ê³¼ ë§ì¶˜ í…Œë‘ë¦¬ë¡œ ì¹¨ë²” ê°•ì¡° */
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 10;
        padding: 5px;
    }

    @keyframes qr-breathe {
        0% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.3)); }
        50% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(1, 178, 173, 0.7)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.3)); }
    }

    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 20px; margin-bottom: 15px; }
    .menu-item { background: white; padding: 15px 10px; text-align: center; border-radius: 20px; border: 1px solid #eee; cursor: pointer; }
    .menu-item i { font-size: 1.5rem; margin-bottom: 3px; display: inline-block; background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .menu-item .menu-title { font-size: 0.85rem; font-weight: 800; color: #333; }

  
    .history-img { width: 100%; max-height: 180px; object-fit: cover; border-radius: 12px; margin-top: 8px; border: 1px solid #eee; display: block; }
    .history-content { font-size: 0.8rem; color: #555; background: #f8f9fa; padding: 10px; border-radius: 10px; margin-top: 8px; }

    .page { 
    display: none; 
    width: 100%; 
    min-height: 100vh; 
    position: absolute; /* í˜ì´ì§€ë“¤ì„ ê²¹ì³ë†“ê³  activeë§Œ ìœ„ë¡œ ì˜¬ë¦¼ */
    top: 0; 
    left: 0; 
    background: var(--bg-grad); /* ë°°ê²½ìƒ‰ì„ ì¤˜ì„œ ë’¤ìª½ í˜ì´ì§€ê°€ ì•ˆ ë¹„ì¹˜ê²Œ í•¨ */
    z-index: 1;
}

.page.active { 
    display: block !important; 
    z-index: 100; 
}

/* íƒ­ë°”ê°€ ê°€ë¦¬ëŠ” í˜„ìƒ ë°©ì§€ìš© ë°”ë‹¥ ì—¬ë°± */
#page-main, #page-mypage, #page-history, #page-activities {
    padding-bottom: 120px !important;
}
    .active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .badge-status { padding: 5px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
    .badge-pending { background: #fff3cd; color: #856404; }
    .badge-approved { background: #d4edda; color: #155724; }
    .badge-rejected { background: #f8d7da; color: #721c24; }
    
    .custom-input { border: none; border-radius: 16px; background: white; padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); margin-bottom: 15px; width: 100%; }
.btn-scan {
    background: var(--primary-grad);
    color: white;
    border: none;
    border-radius: 18px;
    padding: 16px;
    font-weight: 800;
    font-size: 1.1rem;
    box-shadow: 0 10px 20px rgba(1, 178, 173, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-scan:active {
    transform: scale(0.95);
    filter: brightness(1.1);
    box-shadow: 0 5px 10px rgba(1, 178, 173, 0.3);
}
    .form-label { font-size: 0.8rem; font-weight: 700; color: #666; margin-left: 5px; margin-bottom: 5px; }
.activity-badge {
    position: absolute;
    top: -5px;      /* ìœ„ìª½ì—ì„œ -5px ë§Œí¼ */
    right: -5px;     /* ì˜¤ë¥¸ìª½ì—ì„œ -5px ë§Œí¼ */
    background-color: #FF3B30; /* ì•„ì´í° ë ˆë“œ */
    color: white;
    font-size: 0.75rem;
    font-weight: 900;
    min-width: 20px;
    height: 20px;
    border-radius: 10px;
    display: flex; /* ìˆ«ì ì¤‘ì•™ ì •ë ¬ */
    align-items: center;
    justify-content: center;
    border: 2px solid white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 100;
    padding: 0 5px;
}
/* íŒì—… ë°°ê²½ - ì•„ì´í° ìŠ¤íƒ€ì¼ ìœ ë¦¬ì°½ íš¨ê³¼ */
.qr-glass-effect {
    background: rgba(255, 255, 255, 0.4) !important; /* íˆ¬ëª…í•œ í°ìƒ‰ */
    backdrop-filter: blur(15px) saturate(180%); /* ë°°ê²½ íë¦¬ê²Œ */
    -webkit-backdrop-filter: blur(15px) saturate(180%);
}

/* íŒì—… ì¹´ë“œ - ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŠ¤ë¥´ë¥µ */
.qr-slide-up {
    animation: qrSlideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes qrSlideUp {
    from { transform: translateY(100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* ìˆ«ì ë°‘ì— ì€ì€í•œ ê·¸ë¦¼ì */
#focus-points {
    text-shadow: 0 10px 20px rgba(1, 178, 173, 0.2);
}
@keyframes aurora {
    from { box-shadow: 0 0 15px rgba(1, 178, 173, 0.1); }
    to { box-shadow: 0 0 40px rgba(1, 178, 173, 0.4); }
}
/* 1. íƒ­ë°” ë³¸ì²´: ë” ì–‡ê³ , ë” íˆ¬ëª…í•˜ê²Œ (ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜) */
.floating-tab-bar {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: 88%; /* ì•½ê°„ ë” ìŠ¬ë¦¼í•˜ê²Œ */
    max-width: 400px;
    background: rgba(255, 255, 255, 0.75); /* íˆ¬ëª…ë„ ë†’ì„ */
    backdrop-filter: blur(20px) saturate(180%); /* ìœ ë¦¬ ì§ˆê° ê·¹ëŒ€í™” */
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    height: 60px; /* ë†’ì´ë¥¼ ì‚´ì§ ì¤„ì—¬ ë¯¸ë‹ˆë©€í•˜ê²Œ */
    border-radius: 25px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); /* ê·¸ë¦¼ìëŠ” ì•„ì£¼ ì€ì€í•˜ê²Œ */
    z-index: 9999 !important;
    border: 1px solid rgba(255, 255, 255, 0.4);
    padding: 0 10px;
}

/* 2. ì•„ì´ì½˜ ìŠ¤íƒ€ì¼: í…ìŠ¤íŠ¸ëŠ” ë¹¼ê³  ì•„ì´ì½˜ë§Œ ê°•ì¡° (ë¯¸ë‹ˆë©€ë¦¬ì¦˜) */
.tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* ìˆ˜ì§ ì¤‘ì•™ */
    color: #b0b0b0; 
    transition: all 0.3s ease;
    cursor: pointer;
    flex: 1;
    height: 100%;
    position: relative; /* ìì‹ ìš”ì†Œë“¤ì˜ ê¸°ì¤€ì  */
    text-align: center;
}

.tab-item i { 
    font-size: 1.3rem; 
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: block;
    width: 100%; /* ë¶€ëª¨ ë„ˆë¹„ë¥¼ ë‹¤ ì“°ê²Œ í•´ì„œ ì¤‘ì•™ ì •ë ¬ ê°•ì œ */
}

.tab-item span { 
    font-size: 0.6rem; 
    font-weight: 800;
    margin-top: 2px;
    opacity: 0.7;
    transition: all 0.2s ease;
}

/* 2. ğŸŒŸ í™œì„±í™” ì‹œ: ê¸€ì ì¦ë°œ + ì•„ì´ì½˜ ì«€ë“ ë²Œí¬ì—… */
.tab-item.active { 
    color: #01b2ad; 
}

.tab-item.active i { 
    font-size: 1.8rem; 
    color: #01b2ad;
    animation: jellyPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.4));
    
    /* ğŸŒŸ í•µì‹¬: ê¸€ìê°€ ìˆê±´ ì—†ê±´ 'ì¤‘ì•™'ì— ê³ ì •ì‹œí‚¤ëŠ” ë§ˆë²• */
    transform: translateY(8px); 
    margin-top: 0;
}

.tab-item.active span {
    display: none !important;
}

/* ì«€ë“í•œ ì ¤ë¦¬íŒ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
@keyframes jellyPop {
    0% { transform: scale(1) translateY(8px); }
    30% { transform: scale(1.4) translateY(8px); }
    50% { transform: scale(0.9) translateY(8px); }
    100% { transform: scale(1) translateY(8px); }
}

/* 3. ì¤‘ì•™ ìŠ¤ìº” ë²„íŠ¼ë„ ëˆ„ë¥¼ ë•Œ ì«€ë“í•˜ê²Œ ë°˜ì‘ */
.tab-scan-btn:active {
    transform: scale(0.8) rotate(-8deg); /* ê¾¹ ëˆŒë¦¬ëŠ” ëŠë‚Œ */
    filter: brightness(1.2);
}

/* 3. ì¤‘ì•™ ìŠ¤ìº” ë²„íŠ¼: 'ê¹€ë…• ë¯¼íŠ¸' ì •ì²´ì„± í­ë°œ */
.tab-scan-btn {
    width: 50px;
    height: 50px;
    background: var(--primary-grad); /* ì‚¬ì¥ë‹˜ì´ ì“°ì‹œëŠ” ê·¸ ê·¸ë¼ë°ì´ì…˜ */
    border-radius: 18px; /* ë¡œê³ ì™€ í†µì¼ê° ìˆëŠ” ë‘¥ê·¼ ì‚¬ê° */
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5rem;
    margin-top: -30px; /* ì‚´ì§ë§Œ ì†Ÿì•„ì˜¤ë¥´ê²Œ */
    box-shadow: 0 8px 20px rgba(1, 178, 173, 0.4);
    border: 4px solid #ffffff; /* í°ìƒ‰ í…Œë‘ë¦¬ë¡œ ë¶„ë¦¬ê° */
    transition: all 0.3s ease;
}

.tab-scan-btn:active {
    transform: scale(0.9) rotate(5deg);
}
</style>
</head>
<body>
<body>

    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); z-index: 10000; display: none; justify-content: center; align-items: center; flex-direction: column;">
        <div class="spinner-border text-info" role="status"></div>
        <div class="mt-3 fw-bold" style="color:var(--primary)">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <div id="qr-focus-layer" onclick="this.style.display='none'" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center;">
        <div class="bg-white p-4 rounded-5 text-center shadow-lg qr-slide-up" style="width:85%; max-width:350px; border: 1px solid rgba(255,255,255,0.3); position: relative;" onclick="event.stopPropagation()">
            <div class="qr-wrapper" style="position: relative; width: 100%; display: flex; justify-content: center; align-items: center; background: #f8fcfc; padding: 22px 10px; border-radius: 30px; box-shadow: 0 0 30px rgba(1, 178, 173, 0.15); animation: aurora 3s infinite alternate; margin-top: 25px;">
                <div style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); width: 48px; height: 48px; background: #01b2ad; border-radius: 14px; border: 3px solid #ffffff; box-shadow: 0 5px 12px rgba(1, 178, 173, 0.2); display: flex; align-items: center; justify-content: center; z-index: 10; overflow: hidden;">
                    <img src="https://gnpay.my/log2.png" style="width: 100%; height: 100%; object-fit: cover; background: #01b2ad; padding: 6px;">
                </div>
                <img id="qr-img-large" src="" style="width: 100%; max-width: 250px; border-radius: 12px; display: block;">
            </div>
            <div class="mt-4">
                <div class="amount-text user-points-display" id="focus-points" style="font-size: 2.7rem; font-weight: 900; color: var(--primary);">0</div>
                <div class="small text-muted fw-bold" style="opacity: 0.6; letter-spacing: 1px;">ë‚˜ì˜ ì—ì½” í¬ì¸íŠ¸</div>
            </div>
            <button class="btn mt-4 w-100 rounded-pill fw-bold" style="background: #f1f3f5; color: #666; padding: 12px;" onclick="document.getElementById('qr-focus-layer').style.display='none'">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="page-main" class="page active">
        <div class="top-nav">
            <div onclick="showPage('page-main')" style="cursor: pointer;">
    <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
    <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
</div>
            <div class="auth-links" id="auth-area"></div>
        </div>
        <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
            <h1 class="fw-bolder mt-2" id="welcome-message">í•¨ê»˜ ë§Œë“œëŠ”<br><strong>í‘¸ë¥¸ ê¹€ë…• Wave</strong></h1>
        </div>
        <div class="dashboard-card" id="qr-trigger">
            <div><div class="small fw-bold text-muted">MY POINTS</div><div class="amount-text user-points-display" id="main-u-points">0</div></div>
            <div style="background: var(--primary-grad); color:white; width:50px; height:50px; border-radius:18px; display:flex; align-items:center; justify-content:center; font-size:1.5rem;"><i class="bi bi-qr-code"></i></div>
        </div>
        <div class="menu-grid">
            <div class="menu-item" onclick="openSubmit('ìš°ë¦¬ ë§ˆì„ í”Œë¡œê¹… (ììœ )', 2000, 'ê¹€ë…•ë§ˆì„ í™˜ê²½ ì •í™”ì— ë™ì°¸í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>í™œë™ ì‚¬ì§„ì„ ììœ ë¡­ê²Œ ì˜¬ë ¤ì£¼ì„¸ìš”.')">
                <i class="bi bi-patch-check-fill"></i>
                <div class="menu-title">ì •í™” í™œë™</div>
            </div>
            <div class="menu-item" onclick="showPage('page-partners')">
                <i class="bi bi-bag-heart-fill"></i>
                <div class="menu-title">ê°€ë§¹ì </div>
            </div>
            <div class="menu-item" onclick="showPage('page-activities')" style="position: relative;">
                <i class="bi bi-calendar-check-fill"></i>
                <div class="menu-title">ì§„í–‰ì¤‘ í™œë™</div>
                <div id="activity-badge-count" class="activity-badge" style="display: flex;">0</div> 
            </div>
            <div class="menu-item" onclick="showPage('page-guide')">
                <i class="bi bi-info-circle-fill"></i>
                <div class="menu-title">ì•±ì‚¬ìš© ì•ˆë‚´</div>
            </div>
        </div>
    </div> <div id="page-guide" class="page">
        <div class="top-nav">
            <div class="fw-bold text-secondary" style="cursor:pointer; padding:10px;" onclick="showPage('page-main')">
                <i class="bi bi-chevron-left"></i> ë’¤ë¡œ
            </div>
            <div style="color:var(--primary); font-weight:900; font-size:1.3rem;">ì•± ì‚¬ìš© ì•ˆë‚´</div>
        </div>
        <div class="px-4 mt-3">
            <div class="dashboard-card mb-3" style="flex-direction: column; align-items: flex-start; animation: none;">
                <div class="fw-bold">ğŸŒ± í¬ì¸íŠ¸ ì ë¦½ ë°©ë²•</div>
                <div class="small text-muted mt-2">1. ë©”ì¸ í™”ë©´ì˜ 'ì •í™” í™œë™'ì„ ëˆ„ë¦…ë‹ˆë‹¤.</div>
                <div class="small text-muted">2. í™œë™ ì‚¬ì§„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ì‹ ì²­í•©ë‹ˆë‹¤.</div>
                <div class="small text-muted">3. ê´€ë¦¬ì ìŠ¹ì¸ í›„ í¬ì¸íŠ¸ê°€ ì§€ê¸‰ë©ë‹ˆë‹¤.</div>
            </div>
            <div class="dashboard-card mb-3" style="flex-direction: column; align-items: flex-start; animation: none;">
                <div class="fw-bold">ğŸ›ï¸ í¬ì¸íŠ¸ ì‚¬ìš© ë°©ë²•</div>
                <div class="small text-muted mt-2">1. ê°€ë§¹ì ì— ë°©ë¬¸í•˜ì—¬ í•˜ë‹¨ QR ìŠ¤ìº” ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.</div>
                <div class="small text-muted">2. ë§¤ì¥ì— ë¹„ì¹˜ëœ QRì½”ë“œë¥¼ ì´¬ì˜í•˜ë©´ ê²°ì œê°€ ì™„ë£Œë©ë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>

    <div id="page-mypage" class="page" style="background: #000 !important;"> 
    <div class="top-nav" style="background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);">
        <div class="fw-bold" style="cursor:pointer; padding:10px; color: rgba(255,255,255,0.6);" onclick="showPage('page-main')">
            <i class="bi bi-chevron-left"></i> í™ˆìœ¼ë¡œ
        </div>
        <div style="color:var(--primary); font-weight:900; font-size:1.3rem; letter-spacing: -0.5px;">ë§ˆì´í˜ì´ì§€</div>
    </div>
    
    <div class="px-4 pt-2">
        <div class="premium-card text-center" style="margin: 0; background: linear-gradient(160deg, #1a1a1a 0%, #0a0a0a 100%); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.4); border-radius: 35px; padding: 40px 20px;">
            <div style="margin-bottom: 35px;">
                <div style="color: var(--primary); font-size: 0.75rem; font-weight: 800; letter-spacing: 4px; margin-bottom: 12px; opacity: 0.8;">GIMNYEONG PASS</div>
                <div style="color: #ffffff; font-size: 1.6rem; font-weight: 900; letter-spacing: -0.5px;">
                <span id="mypage-user-name" style="color: var(--primary);">ìˆ˜í˜¸ì</span>ë‹˜, ë°˜ê°€ì›Œìš”!
                </div>
            </div>

            <div class="qr-integration-box" style="margin-bottom: 35px;">
                <div class="qr-top-logo">
                    <img src="https://gnpay.my/log2.png" style="width: 100%; height: 100%; object-fit: cover; background: #01b2ad; padding: 2px;">
                </div>
                <div class="qr-frame" style="background: #fff; padding: 15px; border-radius: 25px; display: inline-block; box-shadow: 0 0 25px rgba(1, 178, 173, 0.2);">
                    <img id="my-qr-img" src="" style="width: 180px; height: 180px; border-radius: 15px;">
                </div>
            </div>

            <div style="background: rgba(255,255,255,0.05); padding: 25px 15px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="color: rgba(255,255,255,0.4); font-size: 0.85rem; font-weight: 700; letter-spacing: 1.5px; margin-bottom: 8px;">AVAILABLE POINTS</div>
                <div style="display: flex; align-items: baseline; justify-content: center; gap: 6px;">
                    <div class="user-points-display" id="my-u-points" style="font-size: 3.2rem; font-weight: 900; color: var(--primary); line-height: 1;">0</div>
                    <div style="font-size: 1.4rem; font-weight: 800; color: #fff; opacity: 0.8;">P</div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed rgba(255,255,255,0.15);">
                    <span style="font-size: 0.85rem; color: var(--primary); font-weight: 600; opacity: 0.9;">ê¹€ë…•ì˜ í‘¸ë¥¸ ê°€ì¹˜ë¥¼ ì ë¦½í–ˆìŠµë‹ˆë‹¤</span>
                </div>
            </div>
        </div>

        <div class="mt-4" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="menu-item" onclick="openEditInfo()" style="background: #151515; border: 1px solid #222; padding: 22px 10px; border-radius: 25px; transition: 0.3s;">
                <i class="bi bi-person-vcard-fill" style="font-size: 1.8rem; color: var(--primary); margin-bottom: 8px; display: block;"></i>
                <div class="menu-title" style="color: #fff; font-weight: 600; font-size: 0.95rem;">ë‚´ ì •ë³´ ìˆ˜ì •</div>
            </div>
            <div class="menu-item" onclick="loadActivityHistory()" style="background: #151515; border: 1px solid #222; padding: 22px 10px; border-radius: 25px; transition: 0.3s;">
                <i class="bi bi-journal-check" style="font-size: 1.8rem; color: var(--primary); margin-bottom: 8px; display: block;"></i>
                <div class="menu-title" style="color: #fff; font-weight: 600; font-size: 0.95rem;">í™œë™ ë‚´ì—­</div>
            </div>
        </div>

        <div class="mt-5 mb-5 text-center">
            <button class="btn" onclick="logout()" style="color: #ff5e5e; font-size: 0.9rem; font-weight: 700; background: rgba(255, 94, 94, 0.08); padding: 14px 35px; border-radius: 18px; border: 1px solid rgba(255, 94, 94, 0.2); width: 100%;">
                <i class="bi bi-box-arrow-right me-2"></i> ì•ˆì „í•˜ê²Œ ë¡œê·¸ì•„ì›ƒ
            </button>
            <div class="mt-4 opacity-20" style="letter-spacing: 2px; font-size: 0.65rem; color: #fff;">GIMNYEONG PAY VERSION 2.0</div>
        </div>
    </div>
</div>

    <div id="page-login" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
    <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
    <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
</div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')"><i class="bi bi-x"></i></div>
    </div>
    <div class="mt-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mb-4" style="line-height: 1.2;">ë°˜ê°€ì›Œìš”!<br><strong>ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</strong></h1>
        <div class="mt-5"> <input type="email" id="login-email" class="form-control custom-input" placeholder="ì´ë©”ì¼">
            <input type="password" id="login-pw" class="form-control custom-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button class="btn-scan w-100" onclick="submitLogin()">ë¡œê·¸ì¸í•˜ê¸°</button>
        </div>
    </div>
</div>

    <div id="page-signup" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')"><i class="bi bi-x"></i></div>
    </div>
    
    <div class="mt-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mb-4" style="line-height: 1.2;">ìƒˆë¡œìš´ ì‹œì‘!<br><strong>ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</strong></h1>
        
        <div class="mt-4">
            <div class="d-flex gap-2 mb-3">
                <div style="position: relative; flex: 2;">
                    <i class="bi bi-person" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                    <input type="text" id="reg-name" class="form-control custom-input" placeholder="ì´ë¦„" style="padding-left: 45px; margin-bottom:0;">
                </div>
                <div style="flex: 1;">
                    <select id="reg-gender" class="form-control custom-input" style="padding-left: 15px; margin-bottom:0; font-weight: 600; color: #666;">
                        <option value="">ì„±ë³„</option>
                        <option value="ë‚¨">ë‚¨ì„±</option>
                        <option value="ì—¬">ì—¬ì„±</option>
                    </select>
                </div>
            </div>

            <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-envelope" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="email" id="reg-email" class="form-control custom-input" placeholder="ì´ë©”ì¼" style="padding-left: 45px;">
            </div>
            <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-lock" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="password" id="reg-pw" class="form-control custom-input" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding-left: 45px;">
            </div>
            <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-phone" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="tel" id="reg-phone" class="form-control custom-input" placeholder="ì „í™”ë²ˆí˜¸" style="padding-left: 45px;">
            </div>

            <div style="position: relative; margin-bottom: 20px;">
                <i class="bi bi-geo-alt" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <select id="reg-region" class="form-control custom-input" style="padding-left: 45px; font-weight: 600; color: #666;">
                    <option value="">ê±°ì£¼ ì§€ì—­ ì„ íƒ</option>
                    <option value="ì œì£¼">ì œì£¼</option>
                    <option value="ì„œìš¸">ì„œìš¸</option>
                    <option value="ê²½ê¸°">ê²½ê¸°</option>
                    <option value="ì¸ì²œ">ì¸ì²œ</option>
                    <option value="ê°•ì›">ê°•ì›</option>
                    <option value="ëŒ€ì „">ëŒ€ì „</option>
                    <option value="ì „ë¶">ì „ë¶</option>
                    <option value="ì „ë‚¨">ì „ë‚¨</option>
                    <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                    <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                    <option value="ì¶©ë¶">ì¶©ë¶</option>
                    <option value="ê²½ë¶">ê²½ë¶</option>
                    <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                    <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                    <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <div class="p-3 mb-4" style="background: rgba(1, 178, 173, 0.05); border-radius: 18px; border: 1px dashed rgba(1, 178, 173, 0.3);">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <input type="checkbox" id="reg-agree" style="width: 20px; height: 20px; accent-color: var(--primary);">
                        <label for="reg-agree" class="ms-2 small fw-bold text-dark" style="cursor:pointer;">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜)</label>
                    </div>
                    <span class="small text-muted" style="text-decoration: underline; cursor:pointer;" onclick="alert('ê¹€ë…•í˜ì´ ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•œ ìµœì†Œí•œì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.')">ë³´ê¸°</span>
                </div>
            </div>
            
            <button class="btn-scan w-100 mt-2" onclick="checkAndSignup()">ê°€ì…í•˜ê¸°</button>
        </div>

        <div class="text-center mt-4 pb-5">
            <span class="text-muted small">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?</span>
            <span class="fw-bold ms-2" style="color:var(--primary); cursor:pointer;" onclick="showPage('page-login')">ë¡œê·¸ì¸</span>
        </div>
    </div>
</div>

    <div id="page-edit-info" class="page">
        <div class="top-nav">
            <div class="fw-bold text-secondary" style="cursor:pointer; padding:10px;" onclick="showPage('page-mypage')"><i class="bi bi-chevron-left"></i> ì·¨ì†Œ</div>
            <div class="fw-bold">ì •ë³´ ìˆ˜ì •</div>
        </div>
        <div class="px-4 mt-3">
            <div class="form-label">ì´ë¦„ (ìˆ˜ì •ë¶ˆê°€)</div>
            <input type="text" id="edit-name" class="form-control custom-input" disabled>
            <div class="form-label">ì´ë©”ì¼ (ìˆ˜ì •ë¶ˆê°€)</div>
            <input type="email" id="edit-email" class="form-control custom-input" disabled>
            <div class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸</div>
            <input type="password" id="edit-pw" class="form-control custom-input" placeholder="ë³€ê²½í•  ê²½ìš°ì—ë§Œ ì…ë ¥">
            <div class="form-label">ì „í™”ë²ˆí˜¸</div>
            <input type="tel" id="edit-phone" class="form-control custom-input">
            <button class="btn-scan w-100 mt-4" onclick="submitEditInfo()">ìˆ˜ì • ì™„ë£Œ</button>
        </div>
    </div>

    <div id="page-history" class="page">
    <div class="top-nav">
        <div class="fw-bold text-secondary" style="cursor:pointer; padding:10px;" onclick="showPage('page-main')">
            <i class="bi bi-chevron-left"></i> ë’¤ë¡œ
        </div>
        <div class="fw-bold">ì‹ ì²­ ë‚´ì—­</div>
    </div>
        <div class="px-4 mt-2" id="history-list">
            <div class="text-center text-muted mt-5 small">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <div id="page-activities" class="page">
        <div class="top-nav">
            <div class="fw-bold text-secondary" style="cursor:pointer; padding:10px;" onclick="showPage('page-main')"><i class="bi bi-chevron-left"></i> í™ˆìœ¼ë¡œ</div>
            <div style="color:var(--primary); font-weight:900; font-size:1.3rem;">ì§„í–‰ì¤‘ í™œë™</div>
        </div>
        <div id="activity-list-container" class="px-3 mt-3">
            <div class="dashboard-card" onclick="openSubmit('ê¹€ë…• ì„±ì„¸ê¸°í•´ë³€ í”Œë¡œê¹…', 2000, 'ê¹€ë…•ì˜ í‘¸ë¥¸ ë°”ë‹¤ë¥¼ ìœ„í•´ í”Œë¡œê¹… í™œë™ì„ ì¸ì¦í•´ì£¼ì„¸ìš”.')">
                <div><div class="fw-bold">ê¹€ë…• ì„±ì„¸ê¸°í•´ë³€ í”Œë¡œê¹…</div><div class="text-success small fw-bold">+2,000 í¬ì¸íŠ¸</div></div>
                <i class="bi bi-chevron-right fs-4"></i>
            </div>
        </div>
    </div>

    <div id="page-submit-act" class="page">
        <div class="top-nav">
            <div class="fw-bold text-secondary" style="cursor:pointer; padding:10px;" onclick="showPage('page-main')"><i class="bi bi-x-lg"></i></div>
            <div id="act-title-display" class="fw-bold">ì¸ì¦í•˜ê¸°</div>
        </div>
        <div class="px-4 mt-3">
            <div id="act-desc-display" class="small text-muted mb-4 p-3 bg-light rounded-3"></div>
            <textarea id="act-content" class="form-control custom-input" rows="4" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
            <input type="file" id="act-files" class="form-control custom-input" accept="image/*" multiple onchange="previewImages()">
            <div id="image-preview" class="d-flex gap-2 mb-4 overflow-auto pb-2"></div>
            <button class="btn-scan w-100" onclick="submitActivity()">ì‹ ì²­í•˜ê¸°</button>
        </div>
    </div>

    <div id="page-partners" class="page">
        <div class="top-nav">
            <div class="fw-bold text-secondary" style="cursor:pointer; padding:10px;" onclick="showPage('page-main')"><i class="bi bi-chevron-left"></i> ë’¤ë¡œ</div>
            <div style="color:var(--primary); font-weight:900; font-size:1.3rem;">í¬ì¸íŠ¸ ì‚¬ìš©ì²˜</div>
        </div>
        <div class="px-4 mt-3">
            <div class="small text-muted mb-4">ê¹€ë…•í˜ì´ í¬ì¸íŠ¸ë¥¼ í˜„ê¸ˆì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ë§¹ì ì…ë‹ˆë‹¤.</div>
            <div class="dashboard-card mb-3" style="padding: 22px; flex-direction: column; align-items: flex-start; animation: none;">
                <div class="fw-bold">ê¹€ë…•ìˆ˜ì‚°ë¬¸í™”ë³µí•©ì„¼í„°</div>
                <div class="small text-muted">ğŸ“ ê°ì¢… ì²´í—˜ í™œë™ Â· 2ì¸µ í•´ë…€ì‚¼ì¶˜ì»¤í”¼</div>
            </div>
            <div class="dashboard-card mb-3" style="padding: 22px; flex-direction: column; align-items: flex-start; animation: none;">
                <div class="fw-bold">ê¹€ë…•ì–´ìš¸ë¦¼ì„¼í„°</div>
                <div class="small text-muted">ğŸ“ ê°ì¢… ì²´í—˜ í™œë™ Â· 1ì¸µ ì‚¼ì¶˜ì¹´í˜ ë“±</div>
            </div>
        </div>
    </div>

    <div class="floating-tab-bar">
        <div class="tab-item active" onclick="showPage('page-main'); updateTab(this)">
            <i class="bi bi-house-door-fill"></i>
            <span>í™ˆ</span>
        </div>
        <div class="tab-item" onclick="loadActivityHistory(); updateTab(this)">
            <i class="bi bi-journal-text"></i>
            <span>ë‚´ì—­</span>
        </div>
        <div class="tab-scan-btn" onclick="handleScan()">
            <i class="bi bi-qr-code-scan"></i>
        </div>
        <div class="tab-item" onclick="showPage('page-guide'); updateTab(this)">
            <i class="bi bi-info-circle-fill"></i>
            <span>ì•ˆë‚´</span>
        </div>
        <div class="tab-item" onclick="showPage('page-mypage'); updateTab(this)">
            <i class="bi bi-person-fill"></i>
            <span>ë‚´ì •ë³´</span>
        </div>
    </div>

    <div id="scanner-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:20000;">
        <div id="reader" style="width:100%; height:80vh;"></div>
        <button class="btn btn-light" style="position:absolute; bottom:50px; left:50%; transform:translateX(-50%);" onclick="closeScanner()">ë‹«ê¸°</button>
    </div>

</body>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz8m3LTwxNeVFQltpArarGbQq4UQO7-_t3Z1NuQFJEYe6X5jJgGUrsdyCCiFUuBtl4L/exec";
function updateTab(element) {
    // 1. ëª¨ë“  íƒ­ì—ì„œ active í´ë˜ìŠ¤ ì œê±° (ë¶ˆ ë„ê¸°)
    document.querySelectorAll('.tab-item').forEach(tab => {
        tab.classList.remove('active');
    });

    // 2. í´ë¦­í•œ íƒ­ì— active ì¶”ê°€ (ë¶ˆ ì¼œê¸° + ì«€ë“í•œ ì• ë‹ˆë©”ì´ì…˜ ë°œë™)
    element.classList.add('active');

    // 3. [í•µì‹¬] ë§ˆì´í˜ì´ì§€ë¡œ ê°ˆ ë•Œ QR ì½”ë“œë¥¼ ì¦‰ì‹œ ë¡œë”©í•¨
    // íƒ­ ì•ˆì˜ ê¸€ìê°€ 'ë‚´ì •ë³´'ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    const tabName = element.querySelector('span')?.innerText;
    
    if (tabName === 'ë‚´ì •ë³´') {
        if (userData && userData.isLoggedIn) {
            // ë§ˆì´í˜ì´ì§€ í¬ì¸íŠ¸ ì• ë‹ˆë©”ì´ì…˜ 0ë¶€í„° ì‹œì‘í•˜ë„ë¡ ì„¸íŒ…
            const myPointEl = document.getElementById('my-u-points');
            if (myPointEl) {
                myPointEl.innerText = "0";
                animateValue('my-u-points', 0, Number(userData.points || 0), 1000);
            }
            // ì‚¬ì¥ë‹˜ì˜ ì›…ì¥í•œ QR ìƒì„± í˜¸ì¶œ
            const qrImg = document.getElementById('my-qr-img');
            if (qrImg) {
                qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
            }
        } else if (!userData.isLoggedIn) {
            // ë¡œê·¸ì¸ ì•ˆ ëìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ê°•ì œ ì´ë™
            showPage('page-login');
        }
    }
}
        let userData = JSON.parse(localStorage.getItem('gnpay_user')) || { isLoggedIn: false, points: 0 };
        let selectedImages = [];
        let currentAct = { title: "", amount: 0 };
        const loading = document.getElementById('loading-overlay');
        let html5QrCode;

function showPage(pageId) {
    // 1. ë¡œê·¸ì¸ ì•ˆ ëì„ ë•Œ ê²€ë¬¸í•˜ëŠ” ê³³ (í—ˆìš© ëª©ë¡ì— ë¡œê·¸ì¸/íšŒì›ê°€ì… ì¶”ê°€)
    if (!userData.isLoggedIn && 
        pageId !== 'page-main' && 
        pageId !== 'page-partners' && 
        pageId !== 'page-guide' && 
        pageId !== 'page-login' &&   // ì¶”ê°€: ë¡œê·¸ì¸ í˜ì´ì§€ í—ˆìš©
        pageId !== 'page-signup'     // ì¶”ê°€: íšŒì›ê°€ì… í˜ì´ì§€ í—ˆìš©
    ) {
        pageId = 'page-login'; 
    }

    // 2. ì´ì œ ì •ìƒì ìœ¼ë¡œ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const target = document.getElementById(pageId);
    if(target) target.classList.add('active');
    window.scrollTo(0, 0);
}
function updateUI() {
    const authArea = document.getElementById('auth-area');
    const welcome = document.getElementById('welcome-message');
document.querySelectorAll('.user-points-display').forEach(el => {
    // 1. í˜„ì¬ í™”ë©´ì— ì¨ìˆëŠ” ìˆ«ì ê°€ì ¸ì˜¤ê¸° (ì½¤ë§ˆ ë¹¼ê³ )
    const currentVal = parseInt(el.innerText.replace(/,/g, '')) || 0;
    // 2. ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ì‹¤ì œ ë‚´ í¬ì¸íŠ¸
    const targetVal = Number(userData.points || 0);
    
    // 3. ìˆ«ìê°€ ë‹¤ë¥´ë©´ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘!
    if (currentVal !== targetVal) {
        animateValue(el.id, currentVal, targetVal, 1000); // 1000ì€ 1ì´ˆ ë™ì•ˆ êµ´ë¦°ë‹¤ëŠ” ëœ»
    }
});
if (userData.isLoggedIn && document.getElementById('mypage-user-name')) {
        document.getElementById('mypage-user-name').innerText = userData.name;
    }

    if (userData.isLoggedIn) {
        authArea.innerHTML = `<span class="auth-link" style="color:var(--primary); font-weight:800;" onclick="goToMyPage()">${userData.name}ë‹˜</span><span style="color:#eee; font-size:0.7rem;">|</span><span class="auth-link" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</span>`;
        welcome.innerHTML = `${userData.name}ë‹˜, ì˜¤ëŠ˜ë„<br><strong>í‘¸ë¥¸ ê¹€ë…•ì„ ì§€ì¼œìš”!</strong>`;
        
        // [ì¶”ê°€] ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ ë°°ì§€ ìˆ«ìë¥¼ ê³„ì‚°í•´ì„œ ë„ì›ë‹ˆë‹¤.
        updateActivityBadge(); 

        if (!window.pointSyncInterval) {
            window.pointSyncInterval = setInterval(syncPointsRealtime, 5000);
        }
    } else {
        authArea.innerHTML = `<span class="auth-link" onclick="showPage('page-signup')">íšŒì›ê°€ì…</span><span style="color:#eee; font-size:0.7rem;">|</span><span class="auth-link text-dark" onclick="showPage('page-login')">ë¡œê·¸ì¸</span>`;
        welcome.innerHTML = `í•¨ê»˜ ë§Œë“œëŠ”<br><strong>í‘¸ë¥¸ ê¹€ë…• Wave</strong>`;
        
        // [ì¶”ê°€] ë¡œê·¸ì•„ì›ƒ ìƒíƒœì¼ ë•ŒëŠ” ë°°ì§€ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
        const badge = document.getElementById('activity-badge-count');
        if(badge) badge.style.display = 'none';

        if (window.pointSyncInterval) {
            clearInterval(window.pointSyncInterval);
            window.pointSyncInterval = null;
        }
        if (userData.isLoggedIn && document.getElementById('mypage-user-name')) {
        document.getElementById('mypage-user-name').innerText = userData.name;
    }
    }
}
// [ì¶”ê°€] ë°°ì§€ ìˆ«ìë¥¼ ì‹¤ì œë¡œ ê³„ì‚°í•˜ê³  ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
function updateActivityBadge() {
    // 1. ìˆ«ìë¥¼ í‘œì‹œí•  ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const badge = document.getElementById('activity-badge-count');
    // 2. ì‚¬ì¥ë‹˜ì´ ë§Œë“œì‹  í™œë™ ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const container = document.getElementById('activity-list-container');
    
    if (badge && container) {
        // ì»¨í…Œì´ë„ˆ ì•ˆì— ìˆëŠ” 'dashboard-card' ê°œìˆ˜ë¥¼ ì„¸ì–´ë´…ë‹ˆë‹¤.
        const count = container.querySelectorAll('.dashboard-card').length;
        
        if (count > 0) {
            badge.innerText = count;  // ê°œìˆ˜ë¥¼ ë°°ì§€ì— ì…ë ¥
            badge.style.display = 'flex'; // ë°°ì§€ ë³´ì´ê¸°
        } else {
            badge.style.display = 'none'; // ê°œìˆ˜ê°€ 0ì´ë©´ ìˆ¨ê¸°ê¸°
        }
    }
}

        async function syncPointsRealtime() {
            if (!userData.isLoggedIn) return;
            try {
                const res = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ type: 'login', email: userData.email, password: userData.password })
                }).then(r => r.json());

                if (res.result === 'success') {
                    userData.points = res.user.points;
                    localStorage.setItem('gnpay_user', JSON.stringify(userData));
                    document.querySelectorAll('.user-points-display').forEach(el => {
                        el.innerText = Number(res.user.points).toLocaleString();
                    });
                }
            } catch (e) { console.log("sync..."); }
        }

function goToMyPage() {
    // 1. í˜ì´ì§€ë¥¼ ë¨¼ì € ë³´ì—¬ì¤ë‹ˆë‹¤ (ë³´ì—¬ì•¼ ì—”ì§„ì´ ëŒì•„ê°‘ë‹ˆë‹¤)
    showPage('page-mypage');

    // 2. ë§ˆì´í˜ì´ì§€ í¬ì¸íŠ¸ ì¹¸ì„ ê°•ì œë¡œ "0"ìœ¼ë¡œ ì´ˆê¸°í™” (0ë¶€í„° ì‹œì‘í•˜ê²Œ ë§Œë“¤ê¸°)
    const myPointEl = document.getElementById('my-u-points');
    if (myPointEl) {
        myPointEl.innerText = "0";
        
        // 3. ì§€íœ˜ë³¸ë¶€(updateUI)ë¥¼ ë¶€ë¥´ì§€ ë§ê³ , ì—¬ê¸°ì„œ ì§ì ‘ ì—”ì§„ì„ ì´ì¤ë‹ˆë‹¤.
        // animateValue(ì•„ì´ë””, ì‹œì‘ê°’, ëª©í‘œê°’, ì‹œê°„)
        const targetVal = Number(userData.points || 0);
        animateValue('my-u-points', 0, targetVal, 1000);
    }

    // 4. QR ì½”ë“œ ìƒì„±
    document.getElementById('my-qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
}

        async function submitLogin() {
            const email = document.getElementById('login-email').value;
            const pw = document.getElementById('login-pw').value;
            if(!email || !pw) return alert("ì…ë ¥í•´ì£¼ì„¸ìš”.");
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'login', email, password: pw }) }).then(r => r.json());
                if (res.result === 'success') {
                    userData = { isLoggedIn: true, ...res.user, password: pw };
                    localStorage.setItem('gnpay_user', JSON.stringify(userData));
                    updateUI();
                    showPage('page-main');
                } else { alert(res.message); }
            } catch (e) { alert("ë¡œê·¸ì¸ ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

        async function submitSignup() {
            const data = { type: 'signup', name: document.getElementById('reg-name').value, email: document.getElementById('reg-email').value, password: document.getElementById('reg-pw').value, phone: document.getElementById('reg-phone').value };
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(data) }).then(r => r.json());
                if (res.result === 'success') { alert("ê°€ì… ì„±ê³µ!"); showPage('page-login'); } else { alert(res.message); }
            } catch (e) { alert("íšŒì›ê°€ì… ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

        function openSubmit(title, amount, desc) {
            if (!userData.isLoggedIn) return showPage('page-login');
            currentAct = { title, amount };
            document.getElementById('act-title-display').innerText = title;
            document.getElementById('act-desc-display').innerHTML = desc || "í™œë™ ë‚´ìš©ì„ ì¸ì¦í•˜ì„¸ìš”.";
            showPage('page-submit-act');
        }

async function previewImages() {
    const fileInput = document.getElementById('act-files');
    const previewContainer = document.getElementById('image-preview');
    const files = fileInput.files;
    
    if (files.length === 0) return;

    previewContainer.innerHTML = ''; // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì§€ìš°ê¸°
    selectedImages = []; // ì €ì¥ì†Œ ì´ˆê¸°í™”
    
    loading.style.display = 'flex'; // ì••ì¶• ì‹œì‘í•˜ë‹ˆ ë¡œë”©ë°” ë„ìš°ê¸°

    const options = {
        maxSizeMB: 0.5,          // 0.5MBê¹Œì§€ ì••ì¶•
        maxWidthOrHeight: 1280, // ê°€ë¡œì„¸ë¡œ ìµœëŒ€ 1280px
        useWebWorker: true
    };

    try {
        for (let i = 0; i < files.length; i++) {
            // [í•µì‹¬] ì—¬ê¸°ì„œ ì‚¬ì¥ë‹˜ì´ ê°€ì ¸ì˜¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì••ì¶•ì„ ì§„í–‰í•©ë‹ˆë‹¤
            const compressedFile = await imageCompression(files[i], options);
            
            const reader = new FileReader();
            reader.readAsDataURL(compressedFile);
            
            await new Promise((resolve) => {
                reader.onloadend = () => {
                    const base64data = reader.result;
                    selectedImages.push(base64data);
                    
                    const img = document.createElement('img');
                    img.src = base64data;
                    img.className = 'history-img'; // ì‚¬ì¥ë‹˜ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€
                    img.style.width = '80px';
                    img.style.height = '80px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '12px';
                    previewContainer.appendChild(img);
                    resolve();
                };
            });
        }
    } catch (error) {
        console.error(error);
        alert("ì´ë¯¸ì§€ ì••ì¶• ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    } finally {
        loading.style.display = 'none'; // ì••ì¶• ëë‚¬ìœ¼ë‹ˆ ë¡œë”©ë°” ë„ê¸°
    }
}
        async function submitActivity() {
            const content = document.getElementById('act-content').value;
            if(!content || selectedImages.length === 0) return alert("í™œë™ ë‚´ìš©ê³¼ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.");
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'submitActivity', email: userData.email, title: currentAct.title, content: content, images: selectedImages, pointAmount: currentAct.amount }) }).then(r => r.json());
                if(res.result === 'success') { alert("ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"); showPage('page-main'); }
                else { alert("ì˜¤ë¥˜: " + res.message); }
            } catch(e) { alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

        async function loadActivityHistory() {
            showPage('page-history');
            const list = document.getElementById('history-list');
            list.innerHTML = '<div class="text-center mt-5"><div class="spinner-border text-info"></div></div>';
            
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'getActivityHistory', email: userData.email }) }).then(r => r.json());
                if(res.result === 'success') {
                    if(res.history.length === 0) {
                        list.innerHTML = '<div class="text-center text-muted mt-5 small">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    } else {
                        list.innerHTML = res.history.map((item, idx) => {
                            let badgeClass = item.status === 'ìŠ¹ì¸' ? 'badge-approved' : (item.status === 'ë°˜ë ¤' ? 'badge-rejected' : 'badge-pending');
                            let imagesHtml = '';
                            if(item.img1) imagesHtml += `<img src="${item.img1}" class="history-img">`;
                            if(item.img2) imagesHtml += `<img src="${item.img2}" class="history-img">`;
                            if(item.img3) imagesHtml += `<img src="${item.img3}" class="history-img">`;

                            return `
                                <div class="bg-white p-3 mb-3 rounded-4 shadow-sm border" onclick="this.querySelector('.detail-view').classList.toggle('d-none')">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="badge-status ${badgeClass}">${item.status}</span>
                                        <span class="small text-muted">${item.date}</span>
                                    </div>
                                    <div class="fw-bold">${item.title}</div>
                                    <div class="small text-muted mt-1">+${item.points.toLocaleString()}P</div>
                                    
                                    <div class="detail-view d-none">
                                        <div class="history-content">${item.content}</div>
                                        <div class="d-flex flex-column gap-2">
                                            ${imagesHtml}
                                        </div>
                                    </div>
                                </div>`;
                        }).join('');
                    }
                }
            } catch(e) { list.innerHTML = '<div class="text-center text-danger">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>'; }
        }

        function openEditInfo() {
            document.getElementById('edit-name').value = userData.name;
            document.getElementById('edit-email').value = userData.email;
            document.getElementById('edit-phone').value = userData.phone;
            showPage('page-edit-info');
        }

        async function submitEditInfo() {
            const newPw = document.getElementById('edit-pw').value;
            const newPhone = document.getElementById('edit-phone').value;
            if(!newPhone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            loading.style.display = 'flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'updateUserInfo', email: userData.email, newPhone: newPhone, newPw: newPw }) }).then(r => r.json());
                if(res.result === 'success') {
                    alert("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    userData.phone = newPhone;
                    if(newPw) userData.password = newPw;
                    localStorage.setItem('gnpay_user', JSON.stringify(userData));
                    showPage('page-mypage');
                } else { alert("ìˆ˜ì • ì‹¤íŒ¨"); }
            } catch(e) { alert("ì˜¤ë¥˜ ë°œìƒ"); }
            loading.style.display = 'none';
        }

        async function handleScan() {
            if (!userData.isLoggedIn) return showPage('page-login');
            document.getElementById('scanner-modal').style.display = 'block';
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, async (text) => {
                closeScanner();
                processAddPoints(100, "í˜„ì¥ QR ì¸ì¦");
            });
        }
        function closeScanner() { if(html5QrCode) html5QrCode.stop(); document.getElementById('scanner-modal').style.display='none'; }
        
        async function processAddPoints(amount, action) {
            loading.style.display = 'flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'addPoints', email: userData.email, amount: amount, action: action }) }).then(r => r.json());
                if (res.result === 'success') {
                    alert(amount + "í¬ì¸íŠ¸ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    userData.points = res.newPoints;
                    localStorage.setItem('gnpay_user', JSON.stringify(userData));
                    updateUI();
                }
            } catch (e) { alert("ì ë¦½ ì˜¤ë¥˜"); }
            loading.style.display = 'none';
        }

        function logout() { if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { localStorage.removeItem('gnpay_user'); location.reload(); } }

document.getElementById('qr-trigger').onclick = (e) => {
    if (!userData.isLoggedIn) { showPage('page-login'); return; }
    
    // 1. íŒì—…ì°½ì˜ í¬ì¸íŠ¸ ì¹¸(focus-points)ì„ 0ìœ¼ë¡œ ì´ˆê¸°í™”
    const focusPointEl = document.getElementById('focus-points');
    if (focusPointEl) {
        focusPointEl.innerText = "0";
        
        // 2. íŒì—…ì„ ë¨¼ì € ë„ì›ë‹ˆë‹¤ (ë³´ì—¬ì•¼ ì˜¬ë¼ê°€ëŠ” ê²Œ ë³´ì„!)
        document.getElementById('qr-focus-layer').style.display = 'flex';
        
        // 3. 0ë¶€í„° ì‹¤ì œ í¬ì¸íŠ¸ê¹Œì§€ ì´¤ë¥´ë¥´ ì—”ì§„ ê°€ë™!
        const targetVal = Number(userData.points || 0);
        animateValue('focus-points', 0, targetVal, 1000);
    }

    // 4. QR ì½”ë“œ ìƒì„±
    document.getElementById('qr-img-large').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
};
function animateValue(id, start, end, duration) {
    const obj = document.getElementById(id);
    if (!obj) return;
    
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        // ìˆ«ìë¥¼ ì½¤ë§ˆ(,) í¬í•¨í•´ì„œ ì˜ˆì˜ê²Œ ì°ì–´ì¤ë‹ˆë‹¤
        obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    window.requestAnimationFrame(step);
}
        window.onload = updateUI;
function forceShowPage(pageId) {
    // 1. ëª¨ë“  í˜ì´ì§€ë¥¼ ì‹¹ ë‹¤ ìˆ¨ê¹ë‹ˆë‹¤.
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // 2. ê°€ë§¹ì  í˜ì´ì§€(page-partners)ë§Œ ë”± ë³´ì—¬ì¤ë‹ˆë‹¤.
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.add('active');
        window.scrollTo(0, 0);
    }
}  
function checkAndSignup() {
    const agree = document.getElementById('reg-agree').checked;
    const gender = document.getElementById('reg-gender').value;
    const region = document.getElementById('reg-region').value;

    if (!gender) return alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!region) return alert("ê±°ì£¼ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!agree) return alert("ê°œì¸ì •ë³´ ì œê³µì— ë™ì˜í•´ì£¼ì„¸ìš”.");
    
    // ëª¨ë“  ì²´í¬ í†µê³¼ ì‹œ ê¸°ì¡´ ê°€ì… í•¨ìˆ˜ ì‹¤í–‰
    submitSignup(); 
}
document.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        const activePage = document.querySelector('.page.active');
        if (activePage) {
            if (activePage.id === 'page-login') submitLogin();
            else if (activePage.id === 'page-signup') submitSignup();
        }
    }
});  
</script>
</body>
</html>
