<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>김녕페이</title>
<style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #f7fbfc; }
    iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; display: block; }
</style>
<script>
    // [보안] 깡통 주소 방어
    if (window.location.hostname.includes('googleusercontent.com')) {
        window.location.replace('https://gnpay.my');
    }
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    
window.addEventListener('message', function(e) {
    if (!e.data || !e.data.type) return;

    if (e.data.type === 'SAVE_USER') {
        localStorage.setItem('k_user', JSON.stringify(e.data.data));
    } 
    else if (e.data.type === 'LOGOUT') {
        // 부모 쪽 데이터도 깨끗이 삭제
        localStorage.removeItem('k_user');
        // 자식이 직접 이동시키겠지만, 안전장치로 한 번 더 메인 이동
        setTimeout(() => {
            window.location.replace('https://gnpay.my');
        }, 100);
    }
});

    function createIframe() {
        let src = baseUrl;
        const saved = localStorage.getItem('k_user');
        if (saved) {
            try {
                const data = JSON.parse(saved);
                if (data.email) src += "?u=" + encodeURIComponent(data.email) + "&v=" + Date.now();
            } catch(e){}
        }
        const iframe = document.createElement('iframe');
        iframe.id = "appFrame";
        iframe.src = src;
        // [핵심] allow-modals 추가하여 로그아웃 confirm 창 해결
        iframe.allow = "camera; microphone; storage-access; clipboard-write";
        iframe.setAttribute("sandbox", "allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation allow-modals");
        iframe.setAttribute("allowfullscreen", "");
        document.body.appendChild(iframe);
    }
    window.addEventListener('load', createIframe);
</script>
</head>
<body></body>
</html>



