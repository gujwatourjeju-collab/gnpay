<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ê¹€ë…•í˜ì´ (GIMNYEONG PAY)">
    <meta property="og:description" content="íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ ë° í”Œë¡œê¹… í™œë™ìœ¼ë¡œ ë‚˜ë§Œì˜ ì—ì½” í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”. ğŸŒ±">
    <meta property="og:image" content="/og-image.png">
    <title>ê¹€ë…•í˜ì´</title>
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#f7fbfc; }
        iframe { border:none; width:100%; height:100%; }
    </style>
</head>
<body>
<iframe id="appFrame" 
    src="https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec" 
    allow="camera; microphone;" 
    sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation"
    allowfullscreen>
</iframe>

<script>
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    const frame = document.getElementById('appFrame');
    const savedUser = localStorage.getItem('k_user');

    // 1. ì´ˆê¸° í”„ë ˆì„ ì£¼ì†Œ ì„¤ì • (ë¡œê·¸ì¸ ìœ ì§€ìš©)
    if (savedUser) {
        try {
            const data = JSON.parse(savedUser);
            if(data.email) {
                frame.src = baseUrl + "?u=" + encodeURIComponent(data.email);
            } else {
                frame.src = baseUrl;
            }
        } catch(e) {
            frame.src = baseUrl;
        }
    } else {
        frame.src = baseUrl;
    }

    // 2. ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ (ë¡œê·¸ì¸ ì •ë³´ ì €ì¥ ë° ë¡œê·¸ì•„ì›ƒ)
    window.addEventListener('message', function(e) {
        if (e.data.type === 'SAVE_USER') {
            localStorage.setItem('k_user', JSON.stringify(e.data.data));
        } else if (e.data.type === 'LOGOUT') {
            localStorage.removeItem('k_user');
            window.location.reload();
        }
    });

    // 3. ë¸Œë¼ìš°ì €ê°€ ì´ìƒí•œ êµ¬ê¸€ ì£¼ì†Œ(googleusercontent)ë¥¼ ê¸°ì–µí•˜ì§€ ëª»í•˜ê²Œ ë°©ì–´
    window.onload = function() {
        // í˜„ì¬ ì£¼ì†Œê°€ gnpay.myë„ ì•„ë‹ˆê³ , vercel.appë„ ì•„ë‹Œ 'ë³‘ì‹  ê°™ì€ ì£¼ì†Œ'ì¼ ë•Œë§Œ íŠ•ê²¨ëƒ„
        if (!window.location.hostname.includes('gnpay.my') && !window.location.hostname.includes('vercel.app')) {
            window.location.href = 'https://gnpay.my';
        }
    };

    // 4. í˜ì´ì§€ë¥¼ ë– ë‚  ë•Œ íˆìŠ¤í† ë¦¬ë¥¼ ë©”ì¸ ë„ë©”ì¸ìœ¼ë¡œ ê°•ì œ ê³ ì •
    window.onunload = function() {
        window.history.replaceState(null, null, "/");
    };
</script>
</body>
</html>
