<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta property="og:type" content="website">
<meta property="og:title" content="ê¹€ë…•í˜ì´ (GIMNYEONG PAY)">
<meta property="og:description" content="íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ ë° í”Œë¡œê¹… í™œë™ìœ¼ë¡œ ë‚˜ë§Œì˜ ì—ì½” í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”. ğŸŒ±">
<meta property="og:image" content="/og-image.png">

<title>ê¹€ë…•í˜ì´</title>
<style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #f7fbfc; }
    iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; display: block; }
</style>
<script>
    // [ë³´ì•ˆ] ê¹¡í†µ ì£¼ì†Œ ë°©ì–´
    if (window.location.hostname.includes('googleusercontent.com')) {
        window.location.replace('https://gnpay.my');
    }
    
    // GAS ë°°í¬ URL (ìˆ˜ì • ê¸ˆì§€)
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    
    // [ìˆ˜ì •ëœ ë¡œì§] ë¡œê·¸ì•„ì›ƒ ë° ì„¸ì…˜ ê´€ë¦¬
    window.addEventListener('message', function(e) {
        if (!e.data || !e.data.type) return;

        // 1. ì„¸ì…˜ ìš”ì²­ ì‘ë‹µ
        if (e.data.type === 'GET_SESSION') {
            const saved = localStorage.getItem('k_user');
            if (saved) {
                const iframe = document.getElementById('appFrame');
                if (iframe && iframe.contentWindow) {
                    iframe.contentWindow.postMessage({ 
                        type: 'SEND_SESSION', 
                        data: JSON.parse(saved) 
                    }, '*');
                }
            }
        } 
        // 2. ë¡œê·¸ì¸ ì €ì¥
        else if (e.data.type === 'SAVE_USER') {
            localStorage.setItem('k_user', JSON.stringify(e.data.data));
        } 
        // 3. ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ (êµ¬ë²„ì „/ì‹ ë²„ì „ ì‹ í˜¸ ëª¨ë‘ ìˆ˜ì‹ )
        else if (e.data.type === 'LOGOUT' || e.data.type === 'LOGOUT_FORCE') {
            console.log("ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰");
            localStorage.removeItem('k_user');
            window.location.href = 'https://gnpay.my'; // ê°•ì œ ìƒˆë¡œê³ ì¹¨
        }
    });

function createIframe() {
        let src = baseUrl;
        const saved = localStorage.getItem('k_user');
        
        // [ì¢€ë¹„ ë¡œê·¸ì¸ ë°©ì§€] 
        // ë¡œê·¸ì•„ì›ƒ í–ˆëŠ”ë°ë„ ìŠ¤í† ë¦¬ì§€ì— ì •ë³´ê°€ ë‚¨ì•„ìˆìœ¼ë©´ URLì— íŒŒë¼ë¯¸í„°ë¥¼ ë¶™ì´ëŠ” ë¡œì§ ë•Œë¬¸ì—
        // ë¬´í•œ ì¬ë¡œê·¸ì¸ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
        // savedê°€ í™•ì‹¤íˆ ìˆì„ ë•Œë§Œ íŒŒë¼ë¯¸í„°ë¥¼ ë¶™ì…ë‹ˆë‹¤.
        if (saved) {
            try {
                const data = JSON.parse(saved);
                if (data.email) src += "?u=" + encodeURIComponent(data.email) + "&v=" + Date.now();
            } catch(e){}
        }
        
        const iframe = document.createElement('iframe');
        iframe.id = "appFrame";
        iframe.src = src;
        
        // [í•„ìˆ˜] ê¶Œí•œ í—ˆìš© ì„¤ì •
        iframe.allow = "camera; microphone; storage-access; clipboard-write";
        
        // â˜…â˜…â˜… [ì—¬ê¸°ê°€ í•µì‹¬ì…ë‹ˆë‹¤] â˜…â˜…â˜…
        // allow-top-navigation : ì´ê²Œ ìˆì–´ì•¼ ìì‹ì´ ë¶€ëª¨ ì£¼ì†Œì°½ì„ ê°•ì œë¡œ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        // allow-modals : ì´ê²Œ ìˆì–´ì•¼ alert, confirm ì°½ì´ ëœ¹ë‹ˆë‹¤.
        iframe.setAttribute("sandbox", 
            "allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation allow-modals allow-top-navigation"
        );
        
        iframe.setAttribute("allowfullscreen", "");
        
        document.body.appendChild(iframe);
    }
    window.addEventListener('load', createIframe);
</script>
</head>
<body></body>
</html>

