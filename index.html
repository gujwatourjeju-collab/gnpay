<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta property="og:type" content="website">
<meta property="og:title" content="ê¹€ë…•í˜ì´">
<meta property="og:description" content="íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ ë° í”Œë¡œê¹… í™œë™ìœ¼ë¡œ ë‚˜ë§Œì˜ ì—ì½” í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”. ğŸŒ±">
<meta property="og:image" content="/og-image.png">

<title>ê¹€ë…•í˜ì´</title>
<style>
    body { margin:0; padding:0; overflow:hidden; background:#f7fbfc; }
    iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; }
</style>
<script>
    // [ì¤‘ìš”] GAS ë°°í¬ ì£¼ì†Œ (ìµœì‹  ë²„ì „ì¸ì§€ ê¼­ í™•ì¸í•˜ì„¸ìš”)
    const gasUrl = "https://script.google.com/macros/s/AKfycbxUJvtOV1-zk7zYhpU7rpbUBsrO8BpMEC-zC4zM51DDG4mpNkN3qGgrqJudtH0Goig6/exec";

    // 1. ìì‹(GAS) ì‹ í˜¸ ìˆ˜ì‹  ë¦¬ìŠ¤ë„ˆ
    window.addEventListener('message', function(e) {
        // ë³´ì•ˆ ì—ëŸ¬ ë°©ì§€: ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¬´ì‹œ
        if (!e.data) return;

        let data = e.data;
        // ë°ì´í„°ê°€ ë¬¸ìì—´(JSON)ë¡œ ì˜¬ ê²½ìš° ëŒ€ë¹„ íŒŒì‹±
        if (typeof data === 'string') {
            try { data = JSON.parse(data); } catch(err) { return; }
        }

        // ë¡œê·¸ì¸ ì°½ ì—´ê¸° ì‹ í˜¸ ìˆ˜ì‹  ì‹œ
        if (data.type === 'OPEN_LOGIN') {
            console.log("ë¶€ëª¨ ìˆ˜ì‹ : ë¡œê·¸ì¸ íŒì—… ì‹¤í–‰");
            const w = 450, h = 650;
            const left = (window.screen.width / 2) - (w / 2);
            const top = (window.screen.height / 2) - (h / 2);
            
            // íŒì—… ì°½ ì—´ê¸°
            let popup = window.open(gasUrl + "?page=login_popup", "LoginPopup", `width=${w},height=${h},top=${top},left=${left}`);
            
            if(!popup) {
                alert("íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ì†Œì°½ ìš°ì¸¡ì—ì„œ íŒì—… í—ˆìš©ì„ í•´ì£¼ì„¸ìš”.");
                return;
            }

            // íŒì—… ë‹«í˜ ê°ì§€ ë° ìƒˆë¡œê³ ì¹¨
            let timer = setInterval(function() { 
                if(popup.closed) {
                    clearInterval(timer);
                    console.log("íŒì—… ë‹«í˜ ê°ì§€: ë©”ì¸ í”„ë ˆì„ ê°±ì‹ ");
                    // ìºì‹œ ë¬´ì‹œë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
                    document.getElementById('appFrame').src = gasUrl + "?t=" + new Date().getTime();
                }
            }, 500);
        }
    });

    // 2. Iframe ìƒì„± ë° ì´ˆê¸°í™”
    window.onload = function() {
        let iframe = document.createElement('iframe');
        iframe.id = 'appFrame';
        iframe.src = gasUrl;
        
        // ì¹´ë©”ë¼ ê¶Œí•œ ë° í´ë¦½ë³´ë“œ í—ˆìš©
        iframe.allow = "camera; microphone; clipboard-write";
        
        // [ë³´ì•ˆ í•µì‹¬] ìƒŒë“œë°•ìŠ¤ ì„¤ì •: allow-top-navigation-by-user-activation ì¶”ê°€ë¡œ postMessage ì—ëŸ¬ í•´ê²°
        iframe.setAttribute("sandbox", "allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation allow-modals allow-top-navigation allow-top-navigation-by-user-activation");
        
        document.body.appendChild(iframe);
    }
</script>
</head>
<body></body>
</html>




