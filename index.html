
<!DOCTYPE html>
<html lang="ko">
<head>
    <base target="_top">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#e6f7f6"> <meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="apple-mobile-web-app-capable" content="yes">
<title>ê¹€ë…•í˜ì´ 2.0</title>
<meta property="og:type" content="website">
<meta property="og:url" content="https://gnpay.my">
<meta property="og:title" content="ê¹€ë…•í˜ì´ 2.0">
<meta property="og:description" content="ì œì£¼ì—ì„œ í•¨ê»˜í•˜ëŠ” ë‚´ì†ì•ˆì˜ íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ í¬ì¸íŠ¸">
<meta property="og:image" content="https://gnpay.my/thumbnail.png"> <meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<link rel="icon" href="https://gnpay.my/log2.png" type="image/png">
<link rel="apple-touch-icon" href="https://gnpay.my/log2.png">
<link rel="shortcut icon" href="https://gnpay.my/log2.png">
<link rel="manifest" href="/manifest.json">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.1/dist/browser-image-compression.js"></script>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    :root { --primary: #01b2ad; --primary-grad: linear-gradient(135deg, #01b2ad 0%, #00d2ff 100%); --bg-grad: linear-gradient(180deg, #e6f7f6 0%, #f8fcfc 40%, #ffffff 100%); }
    
    body { 
    font-family: 'Pretendard', sans-serif; 
    /* 1. ë°°ê²½ìƒ‰ì„ ì—°ë¯¼íŠ¸ìƒ‰ìœ¼ë¡œ ê³ ì •í•´ì„œ ë…¸ì¹˜ ì˜ì—­ê¹Œì§€ ìƒ‰ì„ ì…í™ë‹ˆë‹¤ */
    background-color: #e6f7f6; 
    background-image: var(--bg-grad); 
    margin: 0; 
    /* 2. ë…¸ì¹˜ ë°‘ìœ¼ë¡œ ë¡œê³ ê°€ ë‚´ë ¤ì˜¤ë„ë¡ ê¸°ë³¸ ì—¬ë°± ë„‰ë„‰íˆ ë¶€ì—¬ */
    padding-top: env(safe-area-inset-top, 45px); 
    padding-bottom: 120px;
    min-height: 100vh; 
    color: #1a1a1a; 
    overflow-x: hidden; 
    -webkit-overflow-scrolling: touch; /* ì•„ì´í°ì—ì„œ ì«€ë“í•œ íƒ„ë ¥ ìŠ¤í¬ë¡¤ í™œì„±í™” */
}
    
/* [ìµœì¢… ìˆ˜ë¦¬] ëª¨ë“  í˜ì´ì§€ ìƒë‹¨ ë¡œê³  & íƒ€ì´í‹€ ìœ„ì¹˜/í¬ê¸° 100% ì¼ì¹˜ */
.top-nav {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: env(safe-area-inset-top, 20px) 20px 10px 20px !important; /* ë…¸ì¹˜ ëŒ€ì‘ í¬í•¨ */
    height: 80px !important; /* ë†’ì´ ê³ ì •ìœ¼ë¡œ í˜ì´ì§€ ì „í™˜ ì‹œ ëœì»¹ê±°ë¦¼ ë°©ì§€ */
}

/* ì™¼ìª½ ë¡œê³ +íƒ€ì´í‹€ ê·¸ë£¹ */
.nav-left-group {
    display: flex !important;
    align-items: center !important;
    gap: 10px !important; /* ë¡œê³ ì™€ ê¸€ì ì‚¬ì´ ê°„ê²© ê³ ì • */
    cursor: pointer;
}

/* ë¡œê³  ì´ë¯¸ì§€ ê·œê²©í™” */
.nav-left-group img {
    width: 42px !important; /* ê°€ë¡œí­ í†µì¼ */
    height: 42px !important; /* ì„¸ë¡œí­ í†µì¼ */
    object-fit: contain !important;
    margin: 0 !important;
}

/* íƒ€ì´í‹€ í°íŠ¸ ê·œê²©í™” */
.nav-left-group .nav-title {
    color: var(--primary) !important;
    font-weight: 900 !important;
    font-size: 1.3rem !important; /* í°íŠ¸ í¬ê¸° 1.3rem ê³ ì • */
    letter-spacing: -1px !important;
    line-height: 1.2 !important;
    margin: 0 !important;
    white-space: nowrap !important;
}
    .auth-links { display: flex; gap: 5px; align-items: center; }
    .auth-link { font-size: 0.8rem; font-weight: 700; color: #888; text-decoration: none; cursor: pointer; padding: 5px; line-height: 1; }
    
    /* ë©”ì¸ ëŒ€ì‹œë³´ë“œ ìˆ¨ì‰¬ê¸° */
  .dashboard-card { 
    background: white; 
    margin: 0 20px 15px; 
    padding: 20px; 
    border-radius: 24px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    cursor: pointer;
    position: relative; 
    
    /* [ìˆ˜ë¦¬ í¬ì¸íŠ¸] ì•„ë˜ animation ì¤„ì„ ì§€ìš°ê±°ë‚˜ ì£¼ì„ì²˜ë¦¬ í•˜ì„¸ìš” */
    /* animation: breathe 2s infinite ease-in-out; */ 
    
    transition: transform 0.2s ease; /* ì´ê±´ ëˆ„ë¥¼ ë•Œ ì«€ë“í•œ íš¨ê³¼ë¼ ë‚¨ê²¨ë‘ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤ */
    border: 1px solid rgba(1, 178, 173, 0.1);
}
    
    @keyframes breathe {
        0% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.15); }
        50% { transform: scale(1.04); box-shadow: 0 0 35px rgba(1, 178, 173, 0.5), 0 10px 40px rgba(0, 210, 255, 0.3); }
        100% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.15); }
    }

    .amount-text { font-size: 1.8rem; font-weight: 900; background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    /* [ìˆ˜ì •] ë§ˆì´í˜ì´ì§€ í”„ë¦¬ë¯¸ì—„ ì¹´ë“œ ë° ì¼ì²´í˜• QR ë””ìì¸ */
  .premium-card {
    /* padding ìƒë‹¨ì„ 50px -> 30pxë¡œ ì¤„ì—¬ ê³µê°„ í™•ë³´ */
    padding: 30px 20px 25px !important; 
    margin: 10px 20px !important; 
}

    /* ë¡œê³ ì™€ QRì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ ìˆ¨ì‰¬ê²Œ í•˜ëŠ” ì»¨í…Œì´ë„ˆ */
.qr-integration-box {
    position: relative; 
    display: inline-block; 
    margin-top: 15px; /* ë¡œê³ ê°€ ê±¸ì¹  ê³µê°„ í™•ë³´ */
    margin-bottom: 15px; /* ì•„ë˜ìª½ ê°„ê²© ì¶•ì†Œ */
}

   .qr-frame {
    padding: 10px !important; /* ë‚´ë¶€ ì—¬ë°± ì¤„ì„ */
    border-radius: 20px !important;
}

    /* ë¡œê³  ìƒë‹¨ ì¤‘ì•™ ì¹¨ë²” ë°°ì¹˜ */
.qr-top-logo {
    position: absolute; 
    /* topì„ -20px ì •ë„ë¡œ ì¡°ì •í•˜ë©´ í”„ë ˆì„ ì„  ì¤‘ê°„ì— ë”± ê±¸ì¹©ë‹ˆë‹¤ */
    top: -20px !important; 
    left: 50%; 
    transform: translateX(-50%);
    width: 45px !important; /* í¬ê¸°ë„ ì‚´ì§ ì»´íŒ©íŠ¸í•˜ê²Œ ì¡°ì ˆ */
    height: 45px !important;
    z-index: 10;
}
.user-points-display#my-u-points {
    font-size: 2.5rem !important; /* ë„ˆë¬´ í¬ë©´ í•œ í™”ë©´ì— ì•ˆ ë“¤ì–´ì˜¤ë‹ˆ ì‚´ì§ ì¶•ì†Œ */
}

    @keyframes qr-breathe {
        0% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.3)); }
        50% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(1, 178, 173, 0.7)); }
        100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.3)); }
    }

    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 20px; margin-bottom: 15px; }
    .menu-item { background: white; padding: 15px 10px; text-align: center; border-radius: 20px; border: 1px solid #eee; cursor: pointer; }
    .menu-item i { font-size: 1.5rem; margin-bottom: 3px; display: inline-block; background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .menu-item .menu-title { font-size: 0.85rem; font-weight: 800; color: #333; }

  
    .history-img { width: 100%; max-height: 180px; object-fit: cover; border-radius: 12px; margin-top: 8px; border: 1px solid #eee; display: block; }
    .history-content { font-size: 0.8rem; color: #555; background: #f8f9fa; padding: 10px; border-radius: 10px; margin-top: 8px; }
.page {
    position: absolute; /* fixed ëŒ€ì‹  absoluteë¡œ ë³€ê²½ */
    top: 0;
    left: 0;
    width: 100%;
    min-height: 100vh;
    background-color: #e6f7f6 !important; /* ë°°ê²½ìƒ‰ í†µì¼ */
    overflow-y: auto;
    display: none;
    opacity: 0;
    z-index: 10;
}

.page.active {
    display: block;
    opacity: 1;
    z-index: 20; /* í™œì„± í˜ì´ì§€ë§Œ ìœ„ë¡œ ë™‡! */
}
.page-next {
    transform: scale(0.9) translateX(100%);
    opacity: 0;
}
.from-left { transform: translateX(-100%); }
.from-right { transform: translateX(100%); }
/* íƒ­ë°”ê°€ ê°€ë¦¬ëŠ” í˜„ìƒ ë°©ì§€ìš© ë°”ë‹¥ ì—¬ë°± */
#page-main, #page-mypage, #page-history, #page-activities, #page-guide, #page-partners {
    padding-bottom: 150px !important; 
}
    .active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .badge-status { padding: 5px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
    .badge-pending { background: #fff3cd; color: #856404; }
    .badge-approved { background: #d4edda; color: #155724; }
    .badge-rejected { background: #f8d7da; color: #721c24; }
    
    .custom-input { border: none; border-radius: 16px; background: white; padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); margin-bottom: 15px; width: 100%; }
.btn-scan {
    background: var(--primary-grad);
    color: white;
    border: none;
    border-radius: 18px;
    padding: 16px;
    font-weight: 800;
    font-size: 1.1rem;
    box-shadow: 0 10px 20px rgba(1, 178, 173, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-scan:active, .btn-scan-popup:active {
    transform: scale(0.92) !important;
    filter: brightness(1.1);
    transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
    .form-label { font-size: 0.8rem; font-weight: 700; color: #666; margin-left: 5px; margin-bottom: 5px; }
.activity-badge {
    position: absolute;
    top: 15px;      /* ìœ„ì—ì„œ 15px */
    right: 15px;    /* ì˜¤ë¥¸ìª½ì—ì„œ 15px */
    background-color: #FF3B30; /* ì•„ì´í° ëŠë‚Œ ê°•ë ¬í•œ ë ˆë“œ */
    color: white;
    font-size: 0.7rem;
    font-weight: 900;
    min-width: 18px;
    height: 18px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid white; /* í°ìƒ‰ í…Œë‘ë¦¬ê°€ ìˆì–´ì•¼ ê³ ê¸‰ìŠ¤ëŸ½ìŠµë‹ˆë‹¤ */
    box-shadow: 0 2px 8px rgba(255, 59, 48, 0.3);
    z-index: 10;
    padding: 0 4px;
}
/* íŒì—… ë°°ê²½ - ì•„ì´í° ìŠ¤íƒ€ì¼ ìœ ë¦¬ì°½ íš¨ê³¼ */
.qr-glass-effect {
    background: rgba(255, 255, 255, 0.4) !important; 
    backdrop-filter: blur(15px) saturate(180%) !important; /* ë’·ë°°ê²½ íë¦¼ íš¨ê³¼ */
    -webkit-backdrop-filter: blur(15px) saturate(180%) !important;
    transition: all 0.3s ease;
}

/* íŒì—… ì¹´ë“œ - ì•„ë˜ì—ì„œ ìœ„ë¡œ ìŠ¤ë¥´ë¥µ */
.qr-slide-up {
    animation: luxurySlideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes qrSlideUp {
    from { transform: translateY(100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
@keyframes luxurySlideUp {
    from { transform: translateY(100px) scale(0.9); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}
/* ìˆ«ì ë°‘ì— ì€ì€í•œ ê·¸ë¦¼ì */
#focus-points {
    text-shadow: 0 10px 20px rgba(1, 178, 173, 0.2);
}
@keyframes aurora {
    from { box-shadow: 0 0 15px rgba(1, 178, 173, 0.1); }
    to { box-shadow: 0 0 40px rgba(1, 178, 173, 0.4); }
}
/* 1. íƒ­ë°” ë³¸ì²´: ë” ì–‡ê³ , ë” íˆ¬ëª…í•˜ê²Œ (ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜) */
.floating-tab-bar {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: 88%; /* ì•½ê°„ ë” ìŠ¬ë¦¼í•˜ê²Œ */
    max-width: 400px;
    background: rgba(255, 255, 255, 0.75); /* íˆ¬ëª…ë„ ë†’ì„ */
    backdrop-filter: blur(20px) saturate(180%); /* ìœ ë¦¬ ì§ˆê° ê·¹ëŒ€í™” */
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    height: 60px; /* ë†’ì´ë¥¼ ì‚´ì§ ì¤„ì—¬ ë¯¸ë‹ˆë©€í•˜ê²Œ */
    border-radius: 25px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); /* ê·¸ë¦¼ìëŠ” ì•„ì£¼ ì€ì€í•˜ê²Œ */
    z-index: 9999 !important;
    border: 1px solid rgba(255, 255, 255, 0.4);
    padding: 0 10px;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* ì´ ì¤„ì„ ì¶”ê°€! */
}

/* 2. ì•„ì´ì½˜ ìŠ¤íƒ€ì¼: í…ìŠ¤íŠ¸ëŠ” ë¹¼ê³  ì•„ì´ì½˜ë§Œ ê°•ì¡° (ë¯¸ë‹ˆë©€ë¦¬ì¦˜) */
.tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* ìˆ˜ì§ ì¤‘ì•™ */
    color: #b0b0b0; 
    transition: all 0.3s ease;
    cursor: pointer;
    flex: 1;
    height: 100%;
    position: relative; /* ìì‹ ìš”ì†Œë“¤ì˜ ê¸°ì¤€ì  */
    text-align: center;
}

.tab-item i { 
    font-size: 1.3rem; 
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: block;
    width: 100%; /* ë¶€ëª¨ ë„ˆë¹„ë¥¼ ë‹¤ ì“°ê²Œ í•´ì„œ ì¤‘ì•™ ì •ë ¬ ê°•ì œ */
}

.tab-item span { 
    font-size: 0.6rem; 
    font-weight: 800;
    margin-top: 2px;
    opacity: 0.7;
    transition: all 0.2s ease;
}

/* 2. ğŸŒŸ í™œì„±í™” ì‹œ: ê¸€ì ì¦ë°œ + ì•„ì´ì½˜ ì«€ë“ ë²Œí¬ì—… */
.tab-item.active { 
    color: #01b2ad; 
}

.tab-item.active i { 
    font-size: 1.8rem; 
    color: #01b2ad;
    animation: jellyPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    filter: drop-shadow(0 0 10px rgba(1, 178, 173, 0.4));
    
    /* ğŸŒŸ í•µì‹¬: ê¸€ìê°€ ìˆê±´ ì—†ê±´ 'ì¤‘ì•™'ì— ê³ ì •ì‹œí‚¤ëŠ” ë§ˆë²• */
    transform: translateY(8px); 
    margin-top: 0;
}

.tab-item.active span {
    display: none !important;
}

/* ì«€ë“í•œ ì ¤ë¦¬íŒ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ */
@keyframes jellyPop {
    0% { transform: scale(1) translateY(8px); }
    30% { transform: scale(1.4) translateY(8px); }
    50% { transform: scale(0.9) translateY(8px); }
    100% { transform: scale(1) translateY(8px); }
}

/* 3. ì¤‘ì•™ ìŠ¤ìº” ë²„íŠ¼ë„ ëˆ„ë¥¼ ë•Œ ì«€ë“í•˜ê²Œ ë°˜ì‘ */
.tab-scan-btn:active {
    transform: scale(0.8) rotate(-8deg); /* ê¾¹ ëˆŒë¦¬ëŠ” ëŠë‚Œ */
    filter: brightness(1.2);
}

/* 3. ì¤‘ì•™ ìŠ¤ìº” ë²„íŠ¼: 'ê¹€ë…• ë¯¼íŠ¸' ì •ì²´ì„± í­ë°œ */
.tab-scan-btn {
    width: 50px;
    height: 50px;
    background: var(--primary-grad); /* ì‚¬ì¥ë‹˜ì´ ì“°ì‹œëŠ” ê·¸ ê·¸ë¼ë°ì´ì…˜ */
    border-radius: 18px; /* ë¡œê³ ì™€ í†µì¼ê° ìˆëŠ” ë‘¥ê·¼ ì‚¬ê° */
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5rem;
    margin-top: -30px; /* ì‚´ì§ë§Œ ì†Ÿì•„ì˜¤ë¥´ê²Œ */
    box-shadow: 0 8px 20px rgba(1, 178, 173, 0.4);
    border: 4px solid #ffffff; /* í°ìƒ‰ í…Œë‘ë¦¬ë¡œ ë¶„ë¦¬ê° */
    transition: all 0.3s ease;
}

.tab-scan-btn:active {
    transform: scale(0.9) rotate(5deg);
}
@keyframes login-glow {
    0% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.1); border: 1px solid rgba(1, 178, 173, 0.1); }
    50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(1, 178, 173, 0.3); border: 1px solid rgba(1, 178, 173, 0.5); }
    100% { transform: scale(1); box-shadow: 0 10px 25px rgba(1, 178, 173, 0.1); border: 1px solid rgba(1, 178, 173, 0.1); }
}
.active-tab {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 12px rgba(1, 178, 173, 0.3);
}
.inactive-tab {
    background: #f0f5f5;
    color: #888;
}
.bottom-nav {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* ìŠ¥ ë‚´ë ¤ê°€ëŠ” íš¨ê³¼ */
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤... */
}
/* 1. ëª¨ë“  ë²„íŠ¼ ë° í´ë¦­ ìš”ì†Œì— ì«€ë“í•¨ ë¶€ì—¬ */
button, .btn, .menu-item, .dashboard-card, .tab-item, .auth-link {
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.2s ease !important;
}

/* 2. ëˆ„ë¥´ëŠ” ìˆœê°„(active) ë°˜ì‘ ì •ì˜ */
button:active, .btn:active, .menu-item:active, .dashboard-card:active, .tab-item:active, .auth-link:active {
    transform: scale(0.94) !important; /* 6% ì •ë„ ìŠ¥ ëˆŒë¦¬ëŠ” ë§› */
    filter: brightness(1.1) !important; /* ì‚´ì§ ë°˜ì§í•˜ëŠ” íš¨ê³¼ */
}

/* 3. ì·¨ì†Œ ë²„íŠ¼ ê°™ì€ íšŒìƒ‰ ë²„íŠ¼ ì „ìš© (ì¡°ê¸ˆ ë” ê¹Šê²Œ ëˆŒë¦¬ëŠ” ëŠë‚Œ) */
button[style*="background: #f8f9fa"]:active {
    transform: scale(0.92) !important;
    background-color: #e9ecef !important;
}
/* ëª¨ë“  í˜ì´ì§€ ê¸°ë³¸ ìƒíƒœ: ì‚´ì§ ì•„ë˜ì— ìˆê³  íˆ¬ëª…í•¨ */
.page {
    display: none;
    opacity: 0;
    transform: translateY(15px); /* ì‚´ì§ ì•„ë˜ì—ì„œ ëŒ€ê¸° */
    transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* í™œì„±í™”ëœ í˜ì´ì§€: ì œìë¦¬ë¡œ ì˜¤ë©´ì„œ ì„ ëª…í•´ì§ */
.page.active {
    display: block !important;
    opacity: 1;
    transform: translateY(0);
    animation: pageIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes pageIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
/* ì•ˆë‚´ í˜ì´ì§€ ì¹´ë“œ ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
/* ì»¨í…Œì´ë„ˆ: ë°°ì§€ê°€ íŠ€ì–´ë‚˜ì˜¬ ê³µê°„ì„ ìœ„í•´ padding-topì„ ì¶©ë¶„íˆ(40px) ì¤ë‹ˆë‹¤ */
/* [êµì²´] ìˆ˜ì§í˜• ê°€ì´ë“œ ì—”ì§„ */
.guide-slider-container {
    width: 100%;
    height: 450px; /* ê³ ì • ë†’ì´ ë¶€ì—¬ */
    overflow-y: auto; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ë¡œ ë³€ê²½ */
    scroll-snap-type: y mandatory; /* ì„¸ë¡œ ë°©í–¥ ìì„ íš¨ê³¼ */
    -webkit-overflow-scrolling: touch;
    padding: 20px 0;
    scrollbar-width: none;
    display: block; /* í”Œë ‰ìŠ¤ í•´ì œ */
}
.guide-slider-container::-webkit-scrollbar { display: none; }

.guide-slider {
    display: flex;
    flex-direction: column; /* ì„¸ë¡œ ì •ë ¬ */
    align-items: center;
    gap: 30px; /* ì¹´ë“œ ê°„ê²© */
    padding: 0 20px 100px; /* ì•„ë˜ìª½ ì—¬ìœ  ê³µê°„ */
}

/* ì‚´ì•„ìˆëŠ” ìˆ˜ì§ ì¹´ë“œ */
.guide-card {
    flex: 0 0 350px; /* ì¹´ë“œì˜ ì„¸ë¡œ ë†’ì´ ê³ ì • */
    width: 90%; /* ê°€ë¡œ ë„ˆë¹„ */
    scroll-snap-align: center;
    background: white;
    border-radius: 40px;
    padding: 40px 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    border: 1px solid rgba(1, 178, 173, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform: scale(0.9);
    opacity: 0.5;
}

/* ì¤‘ì•™(í¬ì»¤ìŠ¤)ì— ì™”ì„ ë•Œ íš¨ê³¼ */
.guide-card.active-focus {
    transform: scale(1.02);
    opacity: 1;
    box-shadow: 0 20px 40px rgba(1, 178, 173, 0.15);
    border: 1px solid rgba(1, 178, 173, 0.3);
}

.guide-step-badge {
    position: absolute;
    top: -15px;
    background: #1a1a1a;
    color: #fff;
    padding: 5px 20px;
    border-radius: 50px;
    font-size: 0.7rem;
    font-weight: 900;
}
.nav-close-btn {
    cursor: pointer;
    padding: 10px;
    color: #adb5bd;
    transition: all 0.2s;
}
.nav-close-btn:active {
    transform: scale(0.9);
    opacity: 0.6;
}
/* íŠ¸ë Œë””í•œ í˜ì´ì§€ ì „í™˜ ì•¡ì…˜ */
.page {
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
}

/* ë“¤ì–´ì˜¤ëŠ” í˜ì´ì§€ íš¨ê³¼ */
.page-enter-right { transform: translateX(100%); opacity: 0; }
.page-enter-left { transform: translateX(-100%); opacity: 0; }
.page-active { transform: translateX(0); opacity: 1; }

/* í•€í…Œí¬ ìŠ¤íƒ€ì¼ ë©”ë‰´ ì•„ì´í…œ */
/* 1. ê·¸ë¦¬ë“œ ì„¤ì •: 1ì¤„ì— 4ê°œ(1fr 1fr 1fr 1fr) */
.menu-grid-iphone {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4ì—´ ìœ ì§€ */
    gap: 12px;
    padding: 10px 18px;
    margin-top: 12px;
}

/* 2. ì•„ì´í…œ: ê¸°ì¡´ ì«€ë“í•œ íŠ¸ëœì§€ì…˜ì— ê·¸ë¦¼ì ë³€í™” ì¶”ê°€ */
.menu-item-iphone {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    position: relative;
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

 @keyframes jellyPopMain {
    0% { transform: scale(1); }
    30% { transform: scale(1.2); } /* ì‚´ì§ ë²Œí¬ì—… */
    50% { transform: scale(0.9); } /* í›… ì¤„ì–´ë“¤ì—ˆë‹¤ê°€ */
    100% { transform: scale(1); } /* ë³µê·€ */
}
.menu-item-iphone:active .icon-circle {
    /* ì‚¬ì¥ë‹˜ ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€! */
    animation: jellyPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
/* 3. ì•„ì´ì½˜ ë°•ìŠ¤: ë°°ê²½ ì—†ì´ ì•„ì´ì½˜ë§Œ ê°•ì¡°í•˜ê±°ë‚˜ ì•„ì£¼ ì—°í•œ ì›í˜• */
.icon-circle {
    position: relative;
    width: 64px;
    height: 64px;
    border-radius: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    background: #ffffff;
    /* ì€ì€í•œ 3D ì…ì²´ê° ì£¼ì… */
    box-shadow: 
        0 8px 15px rgba(0, 0, 0, 0.05),
        inset 0 -3px 5px rgba(0, 0, 0, 0.02);
    margin-bottom: 8px;
    border: 1px solid rgba(255, 255, 255, 0.8);
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.menu-item-iphone:nth-child(1) .icon-circle { color: #01b2ad; background: #f0fbfb; }
.menu-item-iphone:nth-child(2) .icon-circle { color: #ff9800; background: #fff9f0; }
.menu-item-iphone:nth-child(3) .icon-circle { color: #00d2ff; background: #f0faff; }
.menu-item-iphone:nth-child(4) .icon-circle { color: #ffc107; background: #fffcf0; }
.menu-item-iphone:nth-child(5) .icon-circle { color: #673ab7; background: #f5f0ff; }

    /* 4. ì•± ì´ë¦„ ìŠ¤íƒ€ì¼ */
.menu-title-iphone {
    font-size: 0.78rem;  /* ê¸°ì¡´ 0.72rem -> 0.78remìœ¼ë¡œ ê°€ë…ì„± ì—…! */
    font-weight: 700;
    color: #333;
    letter-spacing: -0.5px;
    text-align: center;
    white-space: nowrap;
    line-height: 1.4; 
}
    /* ë¹¨ê°„ ë°°ì§€: ì•„ì´ì½˜ ì˜¤ë¥¸ìª½ ìƒë‹¨ì— ë”±! */
.badge-iphone {
    position: absolute;
    /* [ìˆ˜ì • í¬ì¸íŠ¸] 
       ë§ˆì´ë„ˆìŠ¤ ê°’ì„ ì£¼ë©´ ì•„ì´ì½˜ ë°•ìŠ¤ 'ë°”ê¹¥ìª½'ìœ¼ë¡œ ë°€ë ¤ë‚©ë‹ˆë‹¤. 
       -5px ì •ë„ê°€ ì•„ì´í° ì•± ë°°ì§€ ìœ„ì¹˜ì™€ ê°€ì¥ í¡ì‚¬í•©ë‹ˆë‹¤.
    */
    top: -5px; 
    right: -5px; 
    
    background: #FF3B30;
    color: white;
    font-size: 0.7rem;
    font-weight: 900;
    min-width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid white; /* ë°°ê²½ê³¼ ëŒ€ë¹„ë˜ëŠ” í…Œë‘ë¦¬ í•„ìˆ˜ */
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    padding: 0 2px;
}
@keyframes harryFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
.fw-900 { font-weight: 900 !important; }
    #rank-table-list .fw-900 { letter-spacing: -0.8px; }
    #rank-info-layer b { color: var(--primary); font-weight: 900; }
    
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.02); opacity: 0.9; }
        100% { transform: scale(1); opacity: 1; }
    }
/* 1. ì»¨í…Œì´ë„ˆ: ë°•ìŠ¤ í˜•íƒœë¥¼ ë²„ë¦¬ê³  ë°°ê²½ì— ë…¹ì•„ë“¤ê²Œ */
.level-container {
    margin: 10px 0;
    padding: 12px 16px; /* í¬ê¸°ë¥¼ í™• ì¤„ì„ */
    background: transparent; /* ë°°ê²½ìƒ‰ ì œê±° (ë¶€ëª¨ ì»¨í…Œì´ë„ˆì— ë§ì¶¤) */
}

/* 2. í…ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ: ê°€ë…ì„± ì¤‘ì‹¬ */
.level-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.current-level {
    font-size: 0.85rem;
    font-weight: 700;
    color: #333;
}

.points-left {
    font-size: 0.75rem;
    color: #888;
}

.points-left strong {
    color: var(--primary); /* ì•± ë©”ì¸ ì»¬ëŸ¬ ì‚¬ìš© */
    font-weight: 800;
}

/* 3. ê²Œì´ì§€ ë°”: ìŠ¬ë¦¼í•˜ê³  ì„¸ë ¨ë˜ê²Œ */
.gauge-background {
    width: 100%;
    height: 8px; /* ì–‡ê²Œ ë³€ê²½ */
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
}

.gauge-fill {
    height: 100%;
    background: var(--primary); /* ë‹¨ìƒ‰ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ */
    border-radius: 10px;
    transition: width 0.6s ease-out;
    /* 3D ë±ƒì§€ì™€ í†µì¼ê°ì„ ì£¼ê¸° ìœ„í•´ ìƒë‹¨ì—ë§Œ ì•„ì£¼ ì–‡ì€ í•˜ì´ë¼ì´íŠ¸ */
    box-shadow: inset 0 1px 1px rgba(255,255,255,0.4);
}

/* 4. ì•„ë˜ ë ˆì´ë¸”ì€ êµ³ì´ í•„ìš” ì—†ë‹¤ë©´ ì œê±°í•˜ê±°ë‚˜ ì•„ì£¼ ì‘ê²Œ */
.level-labels {
    display: none; /* ì¼ë‹¨ ìˆ¨ê²¨ì„œ ë¯¸ë‹ˆë©€í•˜ê²Œ ìœ ì§€ */
}
.harry-float-container {
    /* ê¸°ì¡´ bottom: 5pxì—ì„œ ë” ìœ„ë¡œ ì˜¬ë¦½ë‹ˆë‹¤ */
    bottom: 20px !important; 
    transition: all 0.3s ease-in-out;
}
/* ìºë¦­í„° ì‚°ì±…ë¡œ ì „ìš© ë² ì´ìŠ¤ */
.walk-path {
    position: fixed;
    bottom: 75px; 
    left: 0;
    width: 100%;
    height: 100px; /* ìºë¦­í„°ê°€ ì»¤ì¡Œìœ¼ë‹ˆ ê²½ë¡œ ë†’ì´ë„ í™•ë³´ */
    z-index: 9998;
    pointer-events: none;
    overflow: hidden;
}

#walking-harry {
    width: 95px; /* ê¸°ì¡´ 65px -> ì•½ 1.5ë°°ì¸ 95pxë¡œ í™•ëŒ€ */
    height: 95px;
    position: absolute;
    object-fit: contain;
    /* ìºë¦­í„°ê°€ ì»¤ì§„ ë§Œí¼ ê·¸ë¦¼ìë„ ì‚´ì§ ë” ê¹Šê²Œ ì¤˜ì•¼ ë°”ë‹¥ì— ë”± ë¶™ì–´ ë³´ì…ë‹ˆë‹¤ */
    filter: drop-shadow(4px 8px 6px rgba(0,0,0,0.2));
    animation: harryWalk 18s linear infinite; /* ë©ì¹˜ê°€ ì»¤ì¡Œìœ¼ë‹ˆ ì†ë„ë¥¼ ì‚´ì§ ëŠ¦ì¶°ì•¼ ë” ë¬µì§í•˜ê³  ê·€ì—½ìŠµë‹ˆë‹¤ */
}

@keyframes harryWalk {
    0% { left: -100px; transform: scaleX(1); } /* ì‹œì‘ ìœ„ì¹˜ë„ ìºë¦­í„° í¬ê¸°ë§Œí¼ ì¡°ì ˆ */
    48% { transform: scaleX(1); }
    50% { left: calc(100% + 20px); transform: scaleX(-1); }
    98% { transform: scaleX(-1); }
    100% { left: -100px; transform: scaleX(1); }
}
@keyframes splashPulse {
    0%, 100% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(1.08); opacity: 1; }
}

.splash-fade-out {
    opacity: 0 !important;
    visibility: hidden !important;
    transition: opacity 0.8s ease-out, visibility 0.8s;
}
.my-rank-sticky {
    position: sticky;
    bottom: 0;
    left: 0;
    width: 100%;
    background: var(--primary-grad);
    color: white;
    padding: 15px 25px;
    border-top-left-radius: 25px;
    border-top-right-radius: 25px;
    box-shadow: 0 -10px 20px rgba(1, 178, 173, 0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
    margin-top: 10px;
}

.my-rank-num {
    font-size: 1.2rem;
    font-weight: 900;
}
.my-rank-fixed-bar {
    position: fixed;
    bottom: 95px; /* íƒ­ë°” ë°”ë¡œ ìœ„ */
    left: 50%;
    transform: translateX(-50%); /* ì¢Œìš° ì¤‘ì•™ ì •ë ¬ë§Œ ìœ ì§€ */
    width: 90%;
    max-width: 400px;
    background: var(--primary-grad);
    color: white;
    padding: 16px 22px;
    border-radius: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    display: flex; /* ì²˜ìŒë¶€í„° displayëŠ” flexë¡œ */
    justify-content: space-between;
    align-items: center;
    z-index: 10002;
    /* ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ë§Œ ë”°ë¡œ ë¶€ì—¬ */
    animation: luxurySlideUp 0.5s ease-out;
}

@keyframes luxurySlideUp {
    from { transform: translate(-50%, 100px); opacity: 0; }
    to { transform: translate(-50%, 0); opacity: 1; }
}

html, body {
        background-color: #e6f7f6 !important;
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
    }

    /* 2. ëª¨ë“  í˜ì´ì§€ ì»¨í…Œì´ë„ˆë„ í°ìƒ‰ ë§ê³  ì´ ìƒ‰ìœ¼ë¡œ! */
    .page, #page-main {
        background-color: #e6f7f6 !important;
    }

    /* 3. ìŠ¤í”Œë˜ì‹œ í™”ë©´ë„ ì´ ìƒ‰ìœ¼ë¡œ ë§ì¶°ì•¼ ë“¤ì–´ê°ˆ ë•Œ ì•ˆ ëŠê¹ë‹ˆë‹¤ */
    #splash-screen {
        background-color: #e6f7f6 !important;
    }
    /* ëª¨ë“  íŒì—… ì»¨í…Œì´ë„ˆ (ëª¨ë‹¬) ê³µí†µ ìˆ˜ë¦¬ */
.modal-dialog, .modal-content, .dashboard-card.popup, #rank-info-layer > div, #pw-reset-layer > div, #profile-edit-layer > div {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
    width: 90% !important;
    max-width: 400px !important;
}

/* 2. íŒì—… ë’¤ì— ê¹”ë¦¬ëŠ” ê²€ì€ ë°°ê²½(ì˜¤ë²„ë ˆì´) ìˆ˜ë¦¬ */
.modal-backdrop {
    width: 100vw !important;
    height: 100vh !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
}
/* ë§ˆì´í¬ì¸íŠ¸ QR íŒì—… ë³¸ì²´ ê°•ì œ ì •ë ¬ */
#qr-focus-layer {
    display: none; /* JSì—ì„œ flexë¡œ ë°”ê¾¸ë”ë¼ë„ ê¸°ì¤€ì€ ì•„ë˜ ìŠ¤íƒ€ì¼ì„ ë”°ë¦„ */
    justify-content: center;
    align-items: center;
}

/* íŒì—… ì•ˆì˜ í°ìƒ‰ ì¹´ë“œ ë°•ìŠ¤ */
#qr-focus-layer > div {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important; /* ì¢Œí‘œ ê¸°ì¤€ì„ ì¤‘ì•™ìœ¼ë¡œ */
    margin: 0 !important;
    width: 85% !important;
    max-width: 350px !important;
    /* ê¸°ì¡´ ì• ë‹ˆë©”ì´ì…˜ ìœ ì§€ */
    animation: luxurySlideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* íŒì—… ëœ° ë•Œ ë’¤ì— ê¹”ë¦¬ëŠ” ìœ ë¦¬ íš¨ê³¼ ë°°ê²½ */
.qr-glass-effect {
    width: 100vw !important;
    height: 100vh !important;
    top: 0 !important;
    left: 0 !important;
    position: fixed !important;
}
/* ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì „ìš© ì‹¤ì‹œê°„ í˜„í™© ì¹´ë“œ */
/* ì¹´ë“œ ë„ˆë¹„ í™•ì¥ ë° ë ˆì´ì•„ì›ƒ */
.live-dashboard-card {
    /* 1. ë°°ê²½ ë° ì§ˆê° ìœ ì§€ */
    background: rgba(20, 35, 45, 0.9) !important;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    overflow: hidden !important;
    /* 2. [ìˆ˜ë¦¬ í•µì‹¬] ì•„ë˜ .dashboard-cardì™€ ë˜‘ê°™ì´ ë§ˆì§„ 20pxë¥¼ ì¢Œìš°ì— ë°•ìŠµë‹ˆë‹¤ */
    margin-left: -3px !important;
    margin-right: -3px !important;
    margin-bottom: 5px !important;
    
    /* 3. [ìˆ˜ë¦¬ í•µì‹¬] ë„ˆë¹„ë¥¼ autoë¡œ ë‘ê±°ë‚˜ ê½‰ ì±„ìš°ë„ë¡ ê°•ì œí•©ë‹ˆë‹¤ */
    width: auto !important; 
    flex: 1 !important; /* ë¶€ëª¨ê°€ flexì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ê³µê°„ ê½‰ ì±„ìš°ê¸° */

    /* 4. ë‚´ë¶€ ë ˆì´ì•„ì›ƒ */
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 24px !important;
    border-radius: 24px !important;
    
    min-height: 180px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    box-sizing: border-box !important; /* íŒ¨ë”©ì´ ë„ˆë¹„ì— ì˜í–¥ì„ ì•ˆ ì£¼ê²Œ í•¨ */
}
/* ê´‘íƒ íš¨ê³¼ ì—”ì§„ ì¶”ê°€ */
.live-dashboard-card::after {
    content: "";
    position: absolute;
    top: -100%;
    left: -150%;
    width: 60%; 
    height: 300%;
    background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.4) 50%, 
        rgba(255, 255, 255, 0) 100%
    );
    transform: rotate(30deg);
    animation: metalShine 4s infinite cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

/* ë¹›ì´ ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í›‘ê³  ì§€ë‚˜ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes metalShine {
    0% { left: -150%; opacity: 0; }
    10% { opacity: 1; } /* ë‚˜íƒ€ë‚˜ë©´ì„œ ì‹œì‘ */
    30% { left: 150%; opacity: 1; } /* ë¹ ë¥´ê²Œ í†µê³¼ */
    40% { left: 150%; opacity: 0; } /* ì‚¬ë¼ì§ */
    100% { left: 150%; opacity: 0; } /* ë‹¤ìŒ í„´ê¹Œì§€ ëŒ€ê¸° */
}
/* ì™¼ìª½ ì½˜í…ì¸  */
.card-left-content { flex: 1; }
.live-dot { width: 8px; height: 8px; background: #4cd964; border-radius: 50%; display: inline-block; animation: pulse-green 1.5s infinite; margin-right: 5px; }
.live-status-text { color: #4cd964; font-weight: 800; font-size: 0.85rem; }

.main-display .label { color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 15px; font-weight: 600; }
.main-display .value-row { color: #01b2ad; font-size: 2.5rem; font-weight: 900; line-height: 1.1; }
.main-display .unit { font-size: 1.2rem; color: #fff; margin-left: 5px; }

.rank-summary { margin-top: 15px; }
.rank-text { color: #fff; font-size: 0.85rem; margin-bottom: 6px; opacity: 0.9; }
.rank-pills { display: flex; gap: 4px; }
.pill { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 900; color: #222; }
.gold { background: #ffcc00; } .silver { background: #c0c0c0; } .bronze { background: #cd7f32; color: #fff; }

/* ì˜¤ë¥¸ìª½ ìºë¦­í„° ë° ë±ƒì§€ ì˜ì—­ */
.card-right-character {
    position: relative; /* ë±ƒì§€ì˜ ê¸°ì¤€ì  */
    width: 100px;      /* ìºë¦­í„° í¬ê¸°ì— ë§ê²Œ ê³ ì • */
    height: 100px;
    display: flex;
    justify-content: flex-end; /* ì•ˆìª½ì—ì„œ ì˜¤ë¥¸ìª½ ì •ë ¬ */
    align-items: center;
    margin-right: -20px; /* ì˜¤ë¥¸ìª½ì´ ë„ˆë¬´ ë²Œì–´ì§€ë©´ ì´ ìˆ«ìë¥¼ ë§ˆì´ë„ˆìŠ¤ë¡œ ë” í‚¤ìš°ì„¸ìš” (-15px ë“±) */
}

/* 3. ì¹´ë“œ ì•ˆ ìºë¦­í„° ì´ë¯¸ì§€ */
#main-card-char-img {
    height: 100%;
    width: auto;
    object-fit: contain;
    z-index: 1;
}

/* ìºë¦­í„° ìœ„ì— ì˜¬ë¼ê°€ëŠ” ë±ƒì§€ ìŠ¤íƒ€ì¼ */
.rank-badge-on-card {
    position: absolute;
    top: -20px;
    right: 10px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 900;
    color: #fff;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    z-index: 2;
    white-space: nowrap;
}
/* ìƒë‹¨ ë‚´ë¹„ ì˜ì—­ ì •ë ¬ */
.top-nav > div:first-child {
    display: flex !important;
    align-items: center !important; /* ë¡œê³ ì™€ ê¸€ì ë†’ì´ ë§ì¶¤ */
    gap: 10px !important; /* ë¡œê³ ì™€ ê¸€ì ì‚¬ì´ ê°„ê²© */
}

.top-nav img {
    margin-bottom: 0 !important; /* ì•„ë˜ë¡œ ë°€ì–´ë‚´ë˜ ë§ˆì§„ ì œê±° */
    width: 45px !important; /* ê°€ë¡œ ë°°ì¹˜ë¥¼ ìœ„í•´ ë¡œê³  í¬ê¸° ì‚´ì§ ì¡°ì • (í•„ìš”ì‹œ ì¡°ì ˆ) */
    height: auto;
}

.top-nav div[style*="font-size:1.4rem"] {
    margin-left: 0 !important; /* ê¸°ì¡´ ì™¼ìª½ ë§ˆì§„ ì œê±° */
    margin-bottom: 0 !important; /* ê¸°ì¡´ ì•„ë˜ ë§ˆì§„ ì œê±° */
    white-space: nowrap; /* ê¸€ìê°€ ë°‘ìœ¼ë¡œ êº¾ì´ì§€ ì•Šê²Œ ê³ ì • */
}
/* QR í€µíŒ¨ìŠ¤ ì¹´ë“œë§Œ ì •ë°€ íƒ€ê²©í•´ì„œ ë””ìì¸ ë³€ê²½ */
/* 1. ìœ ë¦¬ ì§ˆê° + ì…ì²´ê° ë¶€ì—¬ */
#white-qr-card {
    background: rgba(255, 255, 255, 0.45) !important;
    backdrop-filter: blur(25px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(25px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.6) !important;
    margin: 0 20px 20px !important;
    padding: 15px 20px !important;
    display: flex !important;
    align-items: center !important;
    border-radius: 28px !important;
    min-height: 100px;
    cursor: pointer;
    transition: all 0.2s ease;


    /* [ğŸš¨ ìˆ˜ë¦¬ í¬ì¸íŠ¸] ìœ„ì—ì„œ ë¬¼ë ¤ë°›ì€ ìˆ¨ì‰¬ê¸° ì• ë‹ˆë©”ì´ì…˜ì„ ê°•ì œë¡œ êº¼ë²„ë¦½ë‹ˆë‹¤ */
    animation: none !important; 
}
#white-qr-card::after {
    content: none !important;
    display: none !important;
}
.qr-login-guide .qr-title {
    font-weight: 800 !important;
    font-size: 1rem !important;
}

.qr-login-guide .qr-subtitle {
    font-size: 0.75rem !important;
    color: #999 !important;
}

/* 2. [í•µì‹¬] QR ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ - 60pxì—ì„œ 85pxë¡œ ëŒ€í­ í™•ëŒ€ */
.qr-preview-box {
    width: 85px !important; /* ì‹œì›í•˜ê²Œ í‚¤ì›€ */
    height: 85px !important;
    background: white !important;
    padding: 6px !important; /* í…Œë‘ë¦¬ ì—¬ë°±ì€ ì¤„ì—¬ì„œ QR ì‹¤ë©´ì  í™•ë³´ */
    border-radius: 18px !important;
    box-shadow: 0 8px 20px rgba(1, 178, 173, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0; /* ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
}

/* 3. í…ìŠ¤íŠ¸ ì˜ì—­ ì—¬ë°± ì¡°ì • */
.qr-info-text {
    margin-left: 20px !important;
    flex: 1;
}

.qr-title {
    font-size: 1.1rem !important; /* ì œëª©ë„ ê°™ì´ ë°¸ëŸ°ìŠ¤ ë§ì¶¤ */
    font-weight: 900;
    color: #1a1a1a;
}

.qr-subtitle {
    font-size: 0.8rem;
    color: #666;
    margin-top: 4px;
    line-height: 1.3;
}

#white-qr-card:active {
    transform: scale(0.95) !important;
    background: rgba(255, 255, 255, 0.7) !important;
}
#welcome-message {
    /* ì¢Œì¸¡ ì—¬ë°±ì„ 26pxì—ì„œ 20pxë¡œ ì¡°ì • (ë¡œê³  ìœ„ì¹˜ì™€ ë§ì¶¤) */
    padding: 0px 20px 5px 10px !important; 
    font-size: 1.2rem !important;
    line-height: 1.3;
    color: #333;
    font-weight: 700;
    text-align: left; /* í˜¹ì‹œ ëª¨ë¥¼ ì¤‘ì•™ì •ë ¬ ë°©ì§€ */
}

/* ê¹€ë…• ë¯¼íŠ¸ ê·¸ë¼ë°ì´ì…˜ íƒ€ì´í‹€ */
#welcome-message strong {
    display: block; 
    font-size: 1.7rem !important; /* íšŒì›ê°€ì… í˜ì´ì§€ ì œëª© í¬ê¸°ì™€ ë§ì¶¤ */
    font-weight: 900 !important;
    
    background: var(--primary-grad); 
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    
    margin-top: 6px;
    letter-spacing: -1.2px; /* í°íŠ¸ê°€ ì»¤ì§„ ë§Œí¼ ìê°„ì„ ë” ì¢í˜€ì„œ ì—£ì§€ìˆê²Œ */
}
</style>
</head>
<body>

    <div id="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); z-index: 10000; display: none; justify-content: center; align-items: center; flex-direction: column;">
        <div class="spinner-border text-info" role="status"></div>
        <div class="mt-3 fw-bold" style="color:var(--primary)">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>
<div id="splash-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #e6f7f6; z-index: 20000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
    
    <div style="margin-bottom: 25px;">
        <img src="https://gnpay.my/log2.png" style="width: 120px; height: auto; filter: drop-shadow(0 4px 10px rgba(1, 178, 173, 0.2)); animation: splashPulse 2s infinite ease-in-out;">
    </div>
    
    <div style="color: #01b2ad; font-weight: 900; font-size: 1.8rem; letter-spacing: 1px; margin-bottom: 8px;">
        GIMNYEONG PAY
    </div>
    
    <div style="color: #333333; font-weight: 600; font-size: 0.95rem; opacity: 0.9; letter-spacing: -0.5px;">
        ë‚´ ì†ì•ˆì˜ íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ í¬ì¸íŠ¸
    </div>

    <div style="position: absolute; bottom: 60px; color: #888; font-size: 0.75rem; font-weight: 600; letter-spacing: 1px;">
        with êµ¬ì¢Œë§ˆì„ì—¬í–‰ì‚¬í˜‘ë™ì¡°í•©
    </div>
</div>

    <div id="qr-focus-layer" onclick="this.style.display='none'" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center;">
        <div class="bg-white p-4 rounded-5 text-center shadow-lg qr-slide-up" style="width:85%; max-width:350px; border: 1px solid rgba(255,255,255,0.3); position: relative;" onclick="event.stopPropagation()">
            <div class="qr-wrapper" style="position: relative; width: 100%; display: flex; justify-content: center; align-items: center; background: #f8fcfc; padding: 22px 10px; border-radius: 30px; box-shadow: 0 0 30px rgba(1, 178, 173, 0.15); animation: aurora 3s infinite alternate; margin-top: 25px;">
                <div style="position: absolute; top: -24px; left: 50%; transform: translateX(-50%); width: 48px; height: 48px; background: #01b2ad; border-radius: 14px; border: 3px solid #ffffff; box-shadow: 0 5px 12px rgba(1, 178, 173, 0.2); display: flex; align-items: center; justify-content: center; z-index: 10; overflow: hidden;">
                    <img src="https://gnpay.my/log2.png" style="width: 100%; height: 100%; object-fit: cover; background: #01b2ad; padding: 6px;">
                </div>
                <img id="qr-img-large" src="" style="width: 100%; max-width: 250px; border-radius: 12px; display: block;">
            </div>
            
            <div class="mt-4">
                <div class="amount-text user-points-display" id="focus-points" style="font-size: 2.7rem; font-weight: 900; color: var(--primary);">0</div>
                <div class="small text-muted fw-bold" style="opacity: 0.6; letter-spacing: 1px;">ë‚˜ì˜ ì—ì½” í¬ì¸íŠ¸</div>
            </div>
            <button class="btn mt-4 w-100 rounded-pill fw-bold" style="background: #f1f3f5; color: #666; padding: 12px;" onclick="closeQR()">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="page-main" class="page active">
    <div class="top-nav" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px;">
        <div onclick="showPage('page-main')" style="cursor: pointer; display: flex; align-items: center; gap: 8px;">
            <img src="https://gnpay.my/log.png" style="width: 42px; height: auto;">
            <div style="color:var(--primary); font-weight:900; font-size:1.3rem; letter-spacing:-1px; line-height: 1;">ê¹€ë…•í˜ì´ 2.0</div>
        </div>
        <div class="auth-links" id="auth-area"></div>
    </div>

    <div class="pb-2" style="padding-left: 26px; padding-right: 25px; position: relative;">
        <h1 class="fw-bolder mt-3" id="welcome-message" style="font-size: 1.6rem; line-height: 1.3; letter-spacing: -1px;">
    ì œì£¼ì—ì„œ í•¨ê»˜ í•˜ëŠ”<br><strong style="color:var(--primary);">íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ</strong>
</h1>

<div id="main-install-btn" style="display:none; margin: 15px 0; padding: 18px; background: linear-gradient(135deg, #01b2ad, #00d2ff); color: white; border-radius: 20px; text-align: center; font-weight: 800; box-shadow: 0 4px 15px rgba(1,178,173,0.3); cursor: pointer;" onclick="installApp()">
    ğŸ“² ê¹€ë…•í˜ì´ ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°
</div>

<div class="live-dashboard-card" id="qr-trigger" style="cursor: default;">
    
    <div class="card-left-content" onclick="showPage('page-ranking'); loadRankingData('today');" style="cursor: pointer; flex: 1;">
        <div class="d-flex align-items-center" style="width: 100%; margin-bottom: 12px; gap: 10px;">
            <div style="display: flex; align-items: center; gap: 6px;">
                <span class="live-dot"></span>
                <span style="color: #fff; font-weight: 800; font-size: 0.95rem;">
                    ê¹€ë…• ì¢…í•© <span id="main-my-rank" style="color: #4cd964;">-ìœ„</span>
                </span>
            </div>
            <div id="main-rank-pills"></div>
        </div>
        
        <div class="main-display">
            <div class="label" style="margin-top: 0; font-size: 0.8rem; opacity: 0.7;">ë‚˜ì˜ ì—ì½” í¬ì¸íŠ¸</div>
            <div class="value-row">
                <span id="main-u-points" class="user-points-display">0</span>
                <span class="unit">P</span>
            </div>
        </div>

        <div class="main-card-gauge-area" style="margin-top: 15px;">
            <div class="d-flex justify-content-between align-items-end mb-2" style="font-size: 0.75rem;">
                <div style="color: rgba(255,255,255,0.6);"><span id="main-next-rank-name" style="color: #fff;">-</span>ê¹Œì§€ <span id="main-next-needed" style="color: #01b2ad;">-</span>P</div>
                <div id="main-gauge-percent" style="color: #01b2ad;">0%</div>
            </div>
            <div style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;">
                <div id="main-card-gauge-bar" style="width: 0%; height: 100%; background: var(--primary-grad); border-radius: 10px;"></div>
            </div>
        </div>
    </div>

    <div class="card-right-character" onclick="event.stopPropagation(); openRankInfo();" style="cursor: pointer; z-index: 10;">
        <div id="main-card-badge" class="rank-badge-on-card">ë³´ë§</div>
        <img id="main-card-char-img" src="https://gnpay.my/r.png" alt="character">
    </div>
</div>
<div class="harry-float-container" style="display: none; position: absolute; right: 10px; bottom: 5px; width: 110px; height: 110px; z-index: 10;">
    <div id="harry-motion-box" style="width: 100%; height: 100%; position: relative; animation: harryFloat 3s infinite ease-in-out;">
        <div class="harry-float-container" onclick="openRankInfo()" style="position: absolute; right: 22px; bottom: 5px; width: 110px; height: 110px; z-index: 10; cursor: pointer;"></div>
        <div id="harry-badge" style="
            position: absolute; top: -20px; left: 5px; 
            background: linear-gradient(145deg, #222, #000); 
            color: #ffffff; padding: 5px 12px; border-radius: 20px; 
            font-size: 0.7rem; font-weight: 800; white-space: nowrap; 
            box-shadow: 3px 3px 8px rgba(0,0,0,0.3), inset 1px 1px 2px rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.1); z-index: 11;">
            ë°˜ê°€ì›Œìš”! ğŸŒŠ
        </div>

        <img id="harry-img" src="https://gnpay.my/3dlog.png" 
             style="width: 100%; height: 100%; object-fit: contain;"
             onerror="this.src='https://gnpay.my/harry.png'">
    </div>
</div>
</div>
      <div class="dashboard-card" id="white-qr-card" onclick="handleQRClick()">
    <div id="qr-content-logged-in" style="display: flex; align-items: center; width: 100%;">
        <div class="qr-preview-box">
            <img id="main-qr-preview" src="" style="width: 100%; height: 100%; object-fit: contain;">
        </div>
        <div class="qr-info-text">
            <div class="qr-title">QR í€µíŒ¨ìŠ¤ <i class="bi bi-check-circle-fill"></i></div>
            <div class="qr-subtitle">ê°€ë§¹ì  ê²°ì œ ë° í¬ì¸íŠ¸ ì ë¦½</div>
        </div>
    </div>

    <div id="qr-content-guest" style="display: none; align-items: center; width: 100%;">
        <div class="qr-preview-box" style="background: #f0fafa !important; display: flex; align-items: center; justify-content: center;">
            <i class="bi bi-lock-fill" style="font-size: 1.5rem; color: var(--primary); opacity: 0.5;"></i>
        </div>
        <div class="qr-info-text">
            <div class="qr-title" style="color: #666;">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>
            <div class="qr-subtitle">íƒ­í•˜ì—¬ ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš”</div>
        </div>
    </div>

    <i class="bi bi-chevron-right qr-arrow"></i>
</div>
       <div class="menu-grid-iphone">
    <div class="menu-item-iphone" onclick="openSubmit('ìš°ë¦¬ ë§ˆì„ í”Œë¡œê¹… (ììœ )', 2000, '...')">
        <div class="icon-circle" style="color: #01b2ad;">
            <i class="bi bi-tree-fill"></i>
        </div>
        <div class="menu-title-iphone">ììœ í™œë™</div>
    </div>

    <div class="menu-item-iphone" onclick="showPage('page-partners')">
        <div class="icon-circle" style="color: #ff9800;">
            <i class="bi bi-bag-heart-fill"></i>
        </div>
        <div class="menu-title-iphone">ê°€ë§¹ì </div>
    </div>
<div class="menu-item-iphone" onclick="showPage('page-activities')">
    <div class="icon-circle" style="color: #00d2ff;">
        <div id="activity-badge-count" class="badge-iphone" style="display: none;">0</div>
        <i class="bi bi-lightning-charge-fill"></i>
    </div>
    <div class="menu-title-iphone">í€˜ìŠ¤íŠ¸</div>
</div>
<div class="menu-item-iphone" onclick="showPage('page-ranking'); loadRankingData('today');">
    <div class="icon-circle" style="color: #ffc107;"> <i class="bi bi-trophy-fill"></i>
    </div>
    <div class="menu-title-iphone">ìˆ˜í˜¸ì ë­í‚¹</div>
</div>

    <div class="menu-item-iphone" onclick="showPage('page-guide')">
        <div class="icon-circle" style="color: #673ab7;">
            <i class="bi bi-info-circle-fill"></i>
        </div>
        <div class="menu-title-iphone">ì´ìš©ì•ˆë‚´</div>
    </div>
</div>
    </div> 
    
    <div id="page-guide" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-left: 10px;">ì•± ì´ìš© ì•ˆë‚´</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" 
     onclick="updateTab(document.querySelectorAll('.tab-item')[0]); showPage('page-main');">
    <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
</div>
    </div>

    <div class="pb-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: 1.8rem; line-height: 1.2; letter-spacing: -1.5px;">ê¹€ë…•í˜ì´<br><strong>ì‚¬ìš© ê°€ì´ë“œ</strong></h1>
    </div>

    <div class="guide-slider-container" id="guide-slider-scroll">
        <div class="guide-slider">
            <div class="guide-card active-focus">
                <div class="guide-step-badge">STEP 01</div>
                <div class="guide-icon-circle" style="width:75px; height:75px; border-radius:22px; background:#e6f7f6; color:var(--primary); display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:20px;">
                    <i class="bi bi-tree-fill"></i>
                </div>
                <h4 style="font-weight:900; letter-spacing:-1px; margin-bottom:12px;">ì—ì½” í¬ì¸íŠ¸ ì ë¦½</h4>
                <div class="step-desc" style="color:#666; font-size:0.95rem; line-height:1.7;">
                    ê¹€ë…• ì„±ì„¸ê¸° í•´ë³€ ì •í™” í›„<br>
                    <strong>í™œë™ ì‚¬ì§„</strong>ì„ ì¸ì¦í•˜ë©´<br>
                    ì—ì½” í¬ì¸íŠ¸ê°€ ì¦‰ì‹œ ì§€ê¸‰ë©ë‹ˆë‹¤.
                </div>
            </div>

            <div class="guide-card">
                <div class="guide-step-badge">STEP 02</div>
                <div class="guide-icon-circle" style="width:75px; height:75px; border-radius:22px; background:#fff9e6; color:#d4a017; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:20px;">
                    <i class="bi bi-bag-heart-fill"></i>
                </div>
                <h4 style="font-weight:900; letter-spacing:-1px; margin-bottom:12px;">ë§ˆì„ ê°€ë§¹ì  ì‚¬ìš©</h4>
                <div class="step-desc" style="color:#666; font-size:0.95rem; line-height:1.7;">
                    ì ë¦½ëœ í¬ì¸íŠ¸ëŠ” ê¹€ë…• ë§ˆì„ì˜<br>
                    <strong>ì¹´í˜, ì‹ë‹¹, ì²´í—˜ì²˜</strong>ì—ì„œ<br>
                    í˜„ê¸ˆì²˜ëŸ¼ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.
                </div>
            </div>

            <div class="guide-card">
                <div class="guide-step-badge">STEP 03</div>
                <div class="guide-icon-circle" style="width:75px; height:75px; border-radius:22px; background:#eefbff; color:#0099cc; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:20px;">
                    <i class="bi bi-qr-code-scan"></i>
                </div>
                <h4 style="font-weight:900; letter-spacing:-1px; margin-bottom:12px;">ìŠ¤ë§ˆíŠ¸ ì²´í¬ì¸</h4>
                <div class="step-desc" style="color:#666; font-size:0.95rem; line-height:1.7;">
                    ë§ˆì´í˜ì´ì§€ <strong>ë‚˜ì˜ QR</strong>ë¡œ<br>
                    ê°€ë§¹ì  ì…ì¥ê³¼ ë³¸ì¸ í™•ì¸ì„<br>
                    ëˆ„êµ¬ë³´ë‹¤ ë¹ ë¥´ê²Œ í•´ê²°í•˜ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

  <div class="text-center mt-2">
    <div class="badge rounded-pill bg-light text-dark px-3 py-2" style="font-size: 0.75rem; opacity: 0.7; border: 1px solid #eee;">
        <i class="bi bi-arrow-up-down me-1"></i> ìœ„ì•„ë˜ë¡œ ë°€ì–´ì„œ ë‹¤ìŒ ë‹¨ê³„ í™•ì¸
    </div>
</div>
</div>
<div id="page-mypage" class="page"> 
    <div class="top-nav" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 20px 20px 5px 26px;">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px;">
        </div>
        
        <div class="auth-links" id="mypage-auth-buttons" style="display: none;">
            <span class="auth-link" onclick="openEditInfo()" style="color:var(--primary); font-weight:800; font-size: 0.8rem; padding: 5px; line-height: 1;">ì •ë³´ìˆ˜ì •</span>
            <span style="color:#eee; font-size:0.7rem; line-height: 1;">|</span>
            <span class="auth-link" onclick="logout()" style="font-size: 0.8rem; font-weight: 700; color: #888; padding: 5px; line-height: 1;">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
    </div>

    <div id="mypage-guest-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 60vh; text-align: center; padding: 20px;">
        <div style="background: #f0fafa; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
            <i class="bi bi-person-lock" style="font-size: 2.5rem; color: var(--primary); opacity: 0.5;"></i>
        </div>
        <h5 class="fw-900">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h5>
        <p style="font-size: 0.85rem; color: #888; line-height: 1.5; margin-bottom: 25px;">
            íšŒì› ì •ë³´ì™€ í¬ì¸íŠ¸ ë‚´ì—­ì„ í™•ì¸í•˜ì‹œë ¤ë©´<br>ë¡œê·¸ì¸ì„ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.
        </p>
        <button class="btn-scan" onclick="showPage('page-login')" style="width: 180px; padding: 12px; font-weight: 800; border-radius: 15px;">ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°</button>
    </div>

    <div id="mypage-user-content" style="display: none;">
    <div class="mt-1" style="padding-left: 20px; padding-right: 20px;">
        <div class="premium-card text-center" style="margin: 0; background: white; border: 1px solid rgba(1, 178, 173, 0.15); box-shadow: 0 15px 35px rgba(0,0,0,0.08); border-radius: 35px; padding: 20px 20px 15px;">
            
            <div style="margin-bottom: 10px;">
                <div id="mypage-rank-label" style="color: var(--primary); font-size: 0.8rem; font-weight: 900; letter-spacing: 1px; margin-bottom: 5px; opacity: 1;">
                    &nbsp;
                </div>
                
                <div style="color: #1a1a1a; font-size: 1.5rem; font-weight: 900; letter-spacing: -1px;">
                    <span id="mypage-user-name" style="color:var(--primary)"></span>ë‹˜, ë°˜ê°€ì›Œìš”!
                </div>
            </div>

          <div class="qr-integration-box" style="margin-top: 15px; margin-bottom: 20px; display: inline-block; position: relative; animation: qr-breathe 2s infinite ease-in-out;">
    
    <div class="qr-top-logo" style="position: absolute; top: -18px; left: 50%; transform: translateX(-50%); border: 3px solid #fff; width: 42px; height: 42px; background: #01b2ad !important; overflow: hidden; display: flex; align-items: center; justify-content: center; border-radius: 12px !important; z-index: 10; box-shadow: 0 5px 12px rgba(0,0,0,0.2);"> 
        <img src="https://gnpay.my/log2.png" style="width: 100%; height: 100%; object-fit: contain;">
    </div>

    <div class="qr-frame" style="background: #f8fcfc; padding: 10px; border-radius: 25px; display: inline-block; border: 1px solid #edf7f6; box-shadow: 0 0 20px rgba(1, 178, 173, 0.2); animation: aurora 3s infinite alternate;">
        <img id="my-qr-img" src="" style="width: 145px; height: 145px; border-radius: 15px; display: block;">
    </div>
</div>

            <div style="background: #f8fcfc; padding: 15px 15px; border-radius: 28px; border: 1px solid rgba(1, 178, 173, 0.1);">
                <div style="color: #888; font-size: 0.7rem; font-weight: 700; letter-spacing: 1px; margin-bottom: 2px;">ì‚¬ìš©ê°€ëŠ¥ í¬ì¸íŠ¸</div>
                <div style="display: flex; align-items: baseline; justify-content: center; gap: 4px;">
                    <div class="user-points-display" id="my-u-points" style="font-size: 2.4rem; font-weight: 900; color: var(--primary); line-height: 1;">0</div>
                    <div style="font-size: 1.1rem; font-weight: 800; color: #333;">P</div>
                </div>
                
                <div class="text-center mt-2">
                    <button onclick="loadActivityHistory()" 
                            style="background: rgba(1, 178, 173, 0.08); border: none; padding: 6px 15px; border-radius: 50px; color: var(--primary); font-size: 0.75rem; font-weight: 800;">
                        ë‚´ì—­ ë³´ê¸° <i class="bi bi-chevron-right ms-1"></i>
                    </button>
                </div>

                <div class="level-container" onclick="openRankInfo()" style="cursor: pointer; padding: 10px 5px 0px;">
                    <div class="level-info" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="display: flex; flex-direction: column; align-items: flex-start;">
                            <span style="font-size: 0.6rem; color: #aaa; font-weight: 800; letter-spacing: 0.5px; margin-bottom: 2px;">ë‹¤ìŒ ë“±ê¸‰</span>
                            <span id="pop-rank-badge-text" style="font-size: 0.85rem; font-weight: 900; color: #333; letter-spacing: -0.5px;">ëª©í‘œ í™•ì¸ ì¤‘</span>
                        </div>
                        <div style="text-align: right; display: flex; flex-direction: column; align-items: flex-end;">
                            <span style="font-size: 0.6rem; color: #aaa; font-weight: 800; letter-spacing: 0.5px; margin-bottom: 2px;">ë‚¨ì€ í¬ì¸íŠ¸</span>
                            <div style="font-size: 1rem; font-weight: 900; color: var(--primary); line-height: 1;">
                                <span id="pop-next-info">0</span><span style="font-size: 0.7rem; margin-left: 2px;">P</span>
                            </div>
                        </div>
                    </div>
                    <div class="gauge-background" style="width: 100%; height: 8px; background: rgba(0,0,0,0.05); border-radius: 10px; overflow: hidden;">
                        <div id="pop-gauge-bar" class="gauge-fill" style="width: 0%; height: 100%; background: var(--primary-grad); border-radius: 10px; transition: width 1.2s cubic-bezier(0.1, 0.9, 0.2, 1);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div></div>

        
  <div id="page-login" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px; position: relative; z-index: 99999;" 
     onclick="event.stopPropagation(); window.scrollTo(0,0); document.querySelectorAll('.tab-item').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.tab-item')[0].classList.add('active'); showPage('page-main');">
    <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6; pointer-events: none;"></i>
</div>
    </div>

    <div class="mt-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mb-4" style="line-height: 1.2;">ë°˜ê°€ì›Œìš”!<br><strong>ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</strong></h1>
        
        <div class="mt-5"> 
<input type="email" id="login-email" class="form-control custom-input" placeholder="ì´ë©”ì¼" disabled>
<input type="password" id="login-pw" class="form-control custom-input" placeholder="ë¹„ë°€ë²ˆí˜¸" disabled>
            
            <div class="d-flex justify-content-between align-items-center px-1 mb-4" style="margin-top: -5px;">
                <div class="form-check d-flex align-items-center gap-2">
                    <input class="form-check-input" type="checkbox" id="remember-me" style="width: 17px; height: 17px; cursor: pointer;">
                    <label class="form-check-label small text-muted" for="remember-me" style="cursor: pointer; padding-top: 2px;">ì•„ì´ë”” ê¸°ì–µ</label>
                </div>
                <div class="small text-muted" onclick="handleForgotPassword()" style="cursor: pointer;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</div>
            </div>

            <button class="btn-scan w-100" onclick="submitLogin()">ë¡œê·¸ì¸í•˜ê¸°</button>

            <div class="text-center mt-4">
                <span class="text-muted small">ì•„ì§ íšŒì›ì´ ì•„ë‹ˆì‹ ê°€ìš”?</span>
                <span class="fw-bold small ms-2" style="color:var(--primary); cursor:pointer;" onclick="showPage('page-signup')">íšŒì›ê°€ì…</span>
            </div>
        </div>
    </div>
</div>
<div id="pw-reset-layer" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001; display: none; flex-direction: column; align-items: center; justify-content: center;">
    <div class="bg-white p-4 rounded-5 shadow-lg qr-slide-up" style="width:85%; max-width:350px; position: relative; border: 1px solid rgba(255,255,255,0.3);">
        
        <div style="position: absolute; top: -20px; left: 20px; width: 55px; height: 55px; 
            background: #01b2ad; /* ê¹€ë…•í˜ì´ ë©”ì¸ ë¡œê³ ìƒ‰ */
            border-radius: 18px; 
            border: 4px solid #fff; 
            box-shadow: 0 8px 15px rgba(1, 178, 173, 0.3); 
            display: flex; align-items: center; justify-content: center; z-index: 10;">
    
    <img src="https://gnpay.my/log2.png" style="width: 80%; height: 80%; object-fit: contain;">
</div>

        <div class="text-center mt-3 mb-4">
            <h5 class="fw-bold" style="color: #333; letter-spacing: -1px;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h5>
            <p class="small text-muted" style="font-size: 0.75rem;">ë“±ë¡ëœ ì´ë©”ì¼ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
        </div>
        
        <div class="px-1">
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ê°€ì… ì´ë©”ì¼</div>
            <input type="email" id="reset-email" class="form-control custom-input" placeholder="example@email.com" style="margin-bottom: 12px; font-size: 0.9rem;">
            
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ì „í™”ë²ˆí˜¸</div>
            <input type="tel" id="reset-phone" class="form-control custom-input" placeholder="ìˆ«ìë§Œ ì…ë ¥" style="margin-bottom: 20px; font-size: 0.9rem;">
        </div>
        
        <div class="d-flex gap-2">
            <button class="btn w-50 rounded-pill fw-bold" style="background: #f8f9fa; color: #999; padding: 14px; border: none; font-size: 0.9rem;" onclick="document.getElementById('pw-reset-layer').style.display='none'">ì·¨ì†Œ</button>
            <button class="btn-scan w-50" style="padding: 14px; font-size: 1rem; background: #01b2ad; border: none; color: #fff; border-radius: 50px;" onclick="processPwReset()">í™•ì¸</button>
        </div>
    </div>
</div>


    <div id="page-signup" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ê¹€ë…•í˜ì´ 2.0</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')"><i class="bi bi-x"></i></div>
    </div>
    
    <div class="mt-2" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mb-4" style="line-height: 1.2;">ìƒˆë¡œìš´ ì‹œì‘!<br><strong>ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</strong></h1>
        
        <div class="mt-4">
            <div class="d-flex gap-2 mb-3">
                <div style="position: relative; flex: 2;">
                    <i class="bi bi-person" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                    <input type="text" id="reg-name" class="form-control custom-input" placeholder="ì´ë¦„" style="padding-left: 45px; margin-bottom:0;">
                </div>
                <div style="flex: 1;">
                    <select id="reg-gender" class="form-control custom-input" style="padding-left: 15px; margin-bottom:0; font-weight: 600; color: #666;">
                        <option value="">ì„±ë³„</option>
                        <option value="ë‚¨">ë‚¨ì„±</option>
                        <option value="ì—¬">ì—¬ì„±</option>
                    </select>
                </div>
            </div>

            <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-envelope" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="email" id="reg-email" class="form-control custom-input" placeholder="ì´ë©”ì¼" style="padding-left: 45px;">
            </div>
            <div style="position: relative; margin-bottom: 5px;">
            <i class="bi bi-lock" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
            <input type="password" id="reg-pw" class="form-control custom-input" 
             placeholder="ë¹„ë°€ë²ˆí˜¸ (ì˜ë¬¸+ìˆ«ì í˜¼í•©)" 
             style="padding-left: 45px;">
            </div>
               <div style="position: relative; margin-bottom: 12px;">
                <i class="bi bi-phone" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <input type="tel" id="reg-phone" class="form-control custom-input" placeholder="ì „í™”ë²ˆí˜¸ (ìˆ«ìë§Œ ì—°ì†í•´ì„œ ì…ë ¥)" style="padding-left: 45px;">
            </div>

            <div style="position: relative; margin-bottom: 20px;">
                <i class="bi bi-geo-alt" style="position: absolute; left: 16px; top: 16px; color: #adb5bd;"></i>
                <select id="reg-region" class="form-control custom-input" style="padding-left: 45px; font-weight: 600; color: #666;">
                    <option value="">ê±°ì£¼ ì§€ì—­ ì„ íƒ</option>
                    <option value="ì œì£¼">ì œì£¼</option>
                    <option value="ì„œìš¸">ì„œìš¸</option>
                    <option value="ê²½ê¸°">ê²½ê¸°</option>
                    <option value="ì¸ì²œ">ì¸ì²œ</option>
                    <option value="ê°•ì›">ê°•ì›</option>
                    <option value="ëŒ€ì „">ëŒ€ì „</option>
                    <option value="ì „ë¶">ì „ë¶</option>
                    <option value="ì „ë‚¨">ì „ë‚¨</option>
                    <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                    <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
                    <option value="ì¶©ë¶">ì¶©ë¶</option>
                    <option value="ê²½ë¶">ê²½ë¶</option>
                    <option value="ê²½ë‚¨">ê²½ë‚¨</option>
                    <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                    <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <div class="p-3 mb-4" style="background: rgba(1, 178, 173, 0.05); border-radius: 18px; border: 1px dashed rgba(1, 178, 173, 0.3);">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <input type="checkbox" id="reg-agree" style="width: 20px; height: 20px; accent-color: var(--primary);">
                        <label for="reg-agree" class="ms-2 small fw-bold text-dark" style="cursor:pointer;">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜)</label>
                    </div>
                    <span class="small text-muted" style="text-decoration: underline; cursor:pointer;" onclick="alert('ê¹€ë…•í˜ì´ ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•œ ìµœì†Œí•œì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.')">ë³´ê¸°</span>
                </div>
            </div>
            
            <button class="btn-scan w-100 mt-2" onclick="checkAndSignup()">ê°€ì…í•˜ê¸°</button>
        </div>

        <div class="text-center mt-4 pb-5">
            <span class="text-muted small">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?</span>
            <span class="fw-bold ms-2" style="color:var(--primary); cursor:pointer;" onclick="showPage('page-login')">ë¡œê·¸ì¸</span>
        </div>
    </div>
</div>
<div id="profile-edit-layer" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001; display: none; flex-direction: column; align-items: center; justify-content: center;">
    <div class="bg-white p-4 rounded-5 shadow-lg qr-slide-up" style="width:85%; max-width:350px; position: relative; border: 1px solid rgba(255,255,255,0.3);">
        
        <div style="position: absolute; top: -20px; left: 20px; width: 55px; height: 55px; background: #01b2ad; border-radius: 18px; border: 4px solid #fff; box-shadow: 0 8px 15px rgba(1, 178, 173, 0.3); display: flex; align-items: center; justify-content: center; z-index: 10;">
            <img src="https://gnpay.my/log2.png" style="width: 80%; height: 80%; object-fit: contain;">
        </div>

        <div class="text-center mt-3 mb-4">
            <h5 class="fw-bold" style="color: #333; letter-spacing: -1px;">
                <span id="edit-user-name" style="color: #01b2ad;">ì‚¬ìš©ì</span>ë‹˜ ì •ë³´ ìˆ˜ì •
            </h5>
            <p class="small text-muted" style="font-size: 0.75rem;">ë³€ê²½í•  ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
        </div>
        
        <div class="px-1">
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ê±°ì£¼ ì§€ì—­</div>
            <select id="popup-edit-region" class="form-control custom-input" style="margin-bottom: 12px; font-size: 0.9rem; font-weight: 600;">
                <option value="ì œì£¼">ì œì£¼</option><option value="ì„œìš¸">ì„œìš¸</option><option value="ê²½ê¸°">ê²½ê¸°</option>
                <option value="ì¸ì²œ">ì¸ì²œ</option><option value="ê°•ì›">ê°•ì›</option><option value="ëŒ€ì „">ëŒ€ì „</option>
                <option value="ì „ë¶">ì „ë¶</option><option value="ì „ë‚¨">ì „ë‚¨</option><option value="ê´‘ì£¼">ê´‘ì£¼</option>
                <option value="ì¶©ë‚¨">ì¶©ë‚¨</option><option value="ì¶©ë¶">ì¶©ë¶</option><option value="ê²½ë¶">ê²½ë¶</option>
                <option value="ê²½ë‚¨">ê²½ë‚¨</option><option value="ë¶€ì‚°">ë¶€ì‚°</option><option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>

            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ì „í™”ë²ˆí˜¸</div>
            <input type="tel" id="popup-edit-phone" class="form-control custom-input" placeholder="ìˆ«ìë§Œ ì…ë ¥" style="margin-bottom: 12px; font-size: 0.9rem;">
            
            <div class="form-label" style="font-size: 0.7rem; color: #01b2ad;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ì„ íƒ)</div>
            <input type="password" id="popup-edit-pw" class="form-control custom-input" placeholder="ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥" style="margin-bottom: 20px; font-size: 0.9rem;">
        </div>
        
        <div class="d-flex gap-2">
            <button class="btn w-50 rounded-pill fw-bold" style="background: #f8f9fa; color: #999; padding: 14px; border: none; font-size: 0.9rem;" onclick="document.getElementById('profile-edit-layer').style.display='none'">ì·¨ì†Œ</button>
            <button class="btn-scan w-50" style="padding: 14px; font-size: 1rem; background: #01b2ad; border: none; color: #fff; border-radius: 50px;" onclick="submitPopupEdit()">ìˆ˜ì •ì™„ë£Œ</button>
        </div>
    </div>
</div>

<div id="rank-info-layer" class="qr-glass-effect" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001; display: none; flex-direction: column; align-items: center; justify-content: center;" onclick="this.style.display='none'">
    <div class="bg-white p-4 rounded-5 shadow-lg qr-slide-up" style="width:88%; max-width:360px; position: relative; border: 1px solid rgba(255,255,255,0.3);" onclick="event.stopPropagation()">
        
        <div style="position: absolute; top: -20px; left: 20px; width: 55px; height: 55px; background: var(--primary-grad); border-radius: 18px; border: 4px solid #fff; box-shadow: 0 8px 15px rgba(1, 178, 173, 0.3); display: flex; align-items: center; justify-content: center; z-index: 10;">
            <i class="bi bi-stars" style="color: white; font-size: 1.5rem;"></i>
        </div>

        <div class="text-center mt-3 mb-4">
    <h5 class="fw-900" style="color: #1a1a1a; letter-spacing: -1.5px; font-size: 1.4rem; line-height: 1.1;">
        ê¹€ë…• ìˆ˜í˜¸ì <span style="color: var(--primary);">ë¦¬í¬íŠ¸</span>
    </h5>
    <p style="font-size: 0.8rem; font-weight: 600; color: #888; margin-top: 5px; letter-spacing: -0.5px;">
        ì‹¤ì²œí• ìˆ˜ë¡ ê¹€ë…•ì˜ ë³´ë¬¼ì´ ìë¼ë‚˜ìš”!
    </p>
</div>
        
        <div class="p-4 mb-4" style="background: #f0fafa; border-radius: 30px; border: 1px solid #e0f2f1; position: relative; overflow: hidden;">
            <div class="d-flex align-items-center gap-3 mb-3">
                <div style="background: white; padding: 10px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                    <img id="pop-rank-img" src="" style="width: 65px; height: 65px; object-fit: contain;">
                </div>
                <div style="flex: 1;">
                    <div id="pop-rank-badge" style="display:inline-block; padding:3px 10px; border-radius:12px; font-size:0.7rem; color:white; font-weight:800; margin-bottom:5px;"></div>
                    <div class="fw-900" style="font-size: 1.2rem; color:#222;"><span id="pop-user-name"></span>ë‹˜</div>
                </div>
            </div>

            <div id="gauge-container">
                <div class="d-flex justify-content-between small fw-bold mb-1" style="font-size: 0.65rem; color: #666;">
                    <span>ì„±ì¥ ì—ë„ˆì§€</span>
                    <span id="pop-gauge-percent">0%</span>
                </div>
                <div style="width: 100%; height: 12px; background: #e0e0e0; border-radius: 10px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
                    <div id="pop-gauge-bar" style="width: 0%; height: 100%; background: var(--primary-grad); transition: width 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);"></div>
                </div>
                <div id="pop-next-info" class="text-center mt-2 fw-800" style="font-size: 0.75rem; color: var(--primary);"></div>
            </div>
        </div>

        <div id="rank-table-list" style="max-height: 220px; overflow-y: auto; padding-right: 5px;">
            </div>
        
        <button class="btn-scan w-100 mt-3" style="padding: 15px; border-radius: 20px;" onclick="document.getElementById('rank-info-layer').style.display='none'">í™•ì¸ ì™„ë£Œ</button>
    </div>
</div>
    <div id="page-history" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ë‚˜ì˜ í™œë™ ê¸°ë¡</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="d-flex px-4 mt-2 mb-4" style="gap: 10px;">
        <div id="tab-point" class="flex-fill text-center py-2 active-tab" onclick="switchHistoryTab('point')" style="cursor:pointer; font-weight:800; border-radius:15px; font-size:0.9rem;">í¬ì¸íŠ¸ ë‚´ì—­</div>
        <div id="tab-activity" class="flex-fill text-center py-2 inactive-tab" onclick="switchHistoryTab('activity')" style="cursor:pointer; font-weight:800; border-radius:15px; font-size:0.9rem;">ì •í™”í™œë™ í˜„í™©</div>
    </div>

    <div style="padding-left: 20px; padding-right: 20px;">
        <div id="history-point-section">
            <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8;">í¬ì¸íŠ¸ ì ë¦½ ë° ì‚¬ìš© ê¸°ë¡ì…ë‹ˆë‹¤.</div>
            <div id="point-history-list">
                <div class="text-center text-muted mt-5 small">í¬ì¸íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div id="history-activity-section" style="display:none;">
            <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8;">ì‹ ì²­í•˜ì‹  í™˜ê²½ ì •í™” í™œë™ì˜ ìŠ¹ì¸ í˜„í™©ì…ë‹ˆë‹¤.</div>
            <div id="activity-history-list">
                <div class="text-center text-muted mt-5 small">í™œë™ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>
</div>

    <div id="page-activities" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ì§„í–‰ì¤‘ í€˜ìŠ¤íŠ¸</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: calc(1.375rem + 1.5vw); line-height: 1.2;">ì§€ê¸ˆ ì°¸ì—¬í•˜ê³ <br><strong>í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”</strong></h1>
    </div>

    <div id="activity-list-container" style="padding-left: 20px; padding-right: 20px;">
        <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8; font-size: 0.85rem;">
            í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ê¹€ë…• ë§ˆì„ ì •í™” í€˜ìŠ¤íŠ¸ì…ë‹ˆë‹¤.
        </div>
        
<div class="dashboard-card mb-3" onclick="openSubmit('ê¹€ë…• ì„±ì„¸ê¸°í•´ë³€ í”Œë¡œê¹…', 2000, '...')" 
     style="padding: 22px; align-items: center; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;
            animation: breathe 2s infinite ease-in-out; /* ì—”ì§„ ì í™” */">
    <div style="flex: 1;">
        <div class="fw-bold" style="font-size: 1.1rem;">ê¹€ë…• ì„±ì„¸ê¸°í•´ë³€ í”Œë¡œê¹…</div>
        <div class="text-success small fw-bold" style="margin-top: 4px;">+3,000 í¬ì¸íŠ¸ ì ë¦½</div>
    </div>
    <i class="bi bi-chevron-right fs-4" style="color: #ccc;"></i>
</div>

        </div>
</div>

    <div id="page-submit-act" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div id="act-title-display" style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">í™˜ê²½ ì •í™” ì¸ì¦</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: calc(1.375rem + 1.5vw); line-height: 1.2;">ê¹¨ë—í•œ ê¹€ë…•ì„ ìœ„í•´<br><strong>í™œë™ì„ ì¸ì¦í•´ì£¼ì„¸ìš”</strong></h1>
    </div>

    <div style="padding-left: 20px; padding-right: 20px;">
        <div id="act-desc-display" class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8; font-size: 0.85rem;">
            í™œë™ ì‚¬ì§„ê³¼ ê°„ë‹¨í•œ ì†Œê°ì„ ë‚¨ê²¨ì£¼ì‹œë©´ í™•ì¸ í›„ í¬ì¸íŠ¸ë¥¼ ë“œë¦½ë‹ˆë‹¤.
        </div>
        
        <div class="p-1">
            <textarea id="act-content" class="form-control custom-input" rows="4" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ì •í™” í™œë™ì„ í•˜ì…¨ë‚˜ìš”?" style="border-radius: 20px; border: 1px solid #eee; margin-bottom: 15px;"></textarea>
            
            <div class="mb-2 small fw-bold text-muted" style="margin-left: 10px;">ì‚¬ì§„ ì²¨ë¶€ (ìµœëŒ€ 3ì¥)</div>
            <input type="file" id="act-files" class="form-control custom-input" accept="image/*" multiple onchange="previewImages()" style="border-radius: 20px; border: 1px solid #eee; margin-bottom: 15px;">
            
            <div id="image-preview" class="d-flex gap-2 mb-4 overflow-auto pb-2" style="padding-left: 5px;"></div>
            
            <button class="btn-scan w-100" onclick="submitActivity()" style="height: 60px; font-size: 1.2rem;">ì¸ì¦ ì‹ ì²­í•˜ê¸°</button>
        </div>
    </div>
</div>

  <div id="page-partners" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">í¬ì¸íŠ¸ ê°€ë§¹ì </div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px;" onclick="showPage('page-main')">
            <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.6;"></i>
        </div>
    </div>

    <div class="pb-4" style="padding-left: 35px; padding-right: 25px;">
        <h1 class="fw-bolder mt-2" style="font-size: calc(1.375rem + 1.5vw); line-height: 1.2;">ì–´ë””ì„œë‚˜ ììœ ë¡­ê²Œ<br><strong>í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”</strong></h1>
    </div>

    <div style="padding-left: 20px; padding-right: 20px;">
        <div class="small text-muted mb-4" style="padding-left: 15px; opacity: 0.8; font-size: 0.85rem;">
            ê¹€ë…•í˜ì´ í¬ì¸íŠ¸ë¥¼ í˜„ê¸ˆì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ë§¹ì ì…ë‹ˆë‹¤.
        </div>
        
      <div class="dashboard-card mb-3" 
     style="padding: 22px; flex-direction: column; align-items: flex-start; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;
            animation: breathe 2s infinite ease-in-out; /* ì—”ì§„ ì í™” */">
    <div class="fw-bold" style="font-size: 1.1rem;">ê¹€ë…•ìˆ˜ì‚°ë¬¸í™”ë³µí•©ì„¼í„°</div>
    <div class="small text-muted mt-1">ğŸ“ ê°ì¢… ì²´í—˜ í™œë™ Â· 2ì¸µ í•´ë…€ì‚¼ì¶˜ì»¤í”¼</div>
</div>

<div class="dashboard-card mb-3" 
     style="padding: 22px; flex-direction: column; align-items: flex-start; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;
            animation: breathe 2s infinite ease-in-out; /* ì—”ì§„ ì í™” */">
    <div class="fw-bold" style="font-size: 1.1rem;">ê¹€ë…•ì–´ìš¸ë¦¼ì„¼í„°</div>
    <div class="small text-muted mt-1">ğŸ“ ê°ì¢… ì²´í—˜ í™œë™ Â· 1ì¸µ ì‚¼ì¶˜ì¹´í˜ ë“±</div>
</div>
<div class="dashboard-card mb-3" 
     style="padding: 22px; flex-direction: column; align-items: flex-start; border-left: 5px solid var(--primary); margin: 0 0 15px 0; width: 100%;
            animation: breathe 2s infinite ease-in-out;">
    <div class="fw-bold" style="font-size: 1.1rem;">ì¹´í˜, ì²­êµ´ë¬¼</div>
    <div class="small text-muted mt-1">ğŸ“ ê°ì¢… ìŒë£Œ ë° ë””ì €íŠ¸ Â· ê°ì¢… êµ¿ì¦ˆ</div>
</div>
    </div>
</div>

    <div class="floating-tab-bar">
        <div class="tab-item active" onclick="showPage('page-main'); updateTab(this)">
            <i class="bi bi-house-door-fill"></i>
            <span>í™ˆ</span>
        </div>
       <div class="tab-item" onclick="showPage('page-partners'); updateTab(this)">
    <i class="bi bi-shop"></i> <span>ê°€ë§¹ì </span>
</div>
        <div class="tab-scan-btn" onclick="handleScan()">
            <i class="bi bi-qr-code-scan"></i>
        </div>
        <div class="tab-item" onclick="showPage('page-guide'); updateTab(this)">
            <i class="bi bi-info-circle-fill"></i>
            <span>ì•ˆë‚´</span>
        </div>
        <div class="tab-item" onclick="showPage('page-mypage'); updateTab(this)">
            <i class="bi bi-person-fill"></i>
            <span>ë‚´ì •ë³´</span>
        </div>
    </div>

    <div id="scanner-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:20000;">
        <div id="reader" style="width:100%; height:80vh;"></div>
        <button class="btn btn-light" style="position:absolute; bottom:50px; left:50%; transform:translateX(-50%);" onclick="closeScanner()">ë‹«ê¸°</button>
    </div>
<div id="page-ranking" class="page">
    <div class="top-nav">
        <div onclick="showPage('page-main')" style="cursor: pointer;">
            <img src="https://gnpay.my/log.png" style="width: 85px; margin-bottom: 8px;">
            <div style="color:var(--primary); font-weight:900; font-size:1.4rem; letter-spacing:-0.5px; margin-bottom: 5px; margin-left: 10px;">ìˆ˜í˜¸ì ë­í‚¹</div>
        </div>
        <div class="fs-2 text-secondary" style="cursor:pointer; padding: 10px; position: relative; z-index: 100001;" 
     onclick="
        event.stopPropagation();
        
        /* 1. ë­í‚¹ í˜ì´ì§€/ë ˆì´ì–´ í™•ì‹¤íˆ ë„ê¸° */
        const pRank = document.getElementById('page-ranking');
        if(pRank) {
            pRank.classList.remove('active');
            pRank.style.display = 'none';
        }
        if(document.getElementById('rank-info-layer')) document.getElementById('rank-info-layer').style.display='none';

        /* 2. ë©”ì¸ í˜ì´ì§€ ê°•ì œë¡œ ê¹¨ìš°ê¸° (ì´ë¯¸ activeì—¬ë„ ë¬´ì‹œí•˜ê³  ì‹¤í–‰) */
        const pMain = document.getElementById('page-main');
        if(pMain) {
            document.querySelectorAll('.page').forEach(p => { p.classList.remove('active'); p.style.display='none'; });
            pMain.style.display = 'block';
            pMain.style.opacity = '1';
            pMain.style.transform = 'translateX(0)';
            pMain.classList.add('active');
        }

        /* 3. í•˜ë‹¨ë°” ìì„ ë³µêµ¬ */
        const tb = document.querySelector('.floating-tab-bar');
        if(tb) {
            tb.style.display='flex';
            tb.style.setProperty('transform', 'translateX(-50%) translateY(0)', 'important');
        }

        /* 4. í™ˆ íƒ­ ì•„ì´ì½˜ ë¶ˆ ì¼œê¸° */
        document.querySelectorAll('.tab-item').forEach(t=>t.classList.remove('active'));
        if(document.querySelectorAll('.tab-item')[0]) document.querySelectorAll('.tab-item')[0].classList.add('active');
        
        window.scrollTo(0,0);
     ">
    <i class="bi bi-x-lg" style="font-size: 1.5rem; opacity: 0.8;"></i>
</div>
    </div>

    <div class="d-flex px-4 mt-2 mb-4" style="gap: 10px;">
        <div id="tab-rank-today" class="flex-fill text-center py-2 active-tab" onclick="switchRankTab('today')" style="cursor:pointer; font-weight:800; border-radius:15px; font-size:0.9rem;">ì˜¤ëŠ˜ì˜ ë­í‚¹</div>
        <div id="tab-rank-total" class="flex-fill text-center py-2 inactive-tab" onclick="switchRankTab('total')" style="cursor:pointer; font-weight:800; border-radius:15px; font-size:0.9rem;">ì „ì²´ ë­í‚¹</div>
    </div>

    <div id="ranking-list" style="padding: 0 20px 120px; height: calc(100vh - 220px); overflow-y: auto;">
        <div class="text-center text-muted mt-5 small">ìˆœìœ„ë¥¼ ì§‘ê³„ ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <div id="my-rank-bar-container"></div>
</div>
<div class="walk-path">
    <img id="walking-harry" src="https://gnpay.my/harry_walk.gif" onerror="this.src='https://gnpay.my/3dlog.png'">
</div>
</body>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycby6C0tEYO3LYB2LrTEQwW2W5kzA5JiTgs1UVserc_w8g7vsfcvGM-5Qlt7QPv9Zc5-oDg/exec";
    let currentRankMode = 'today';
    let totalRankingData = [];
    function updateTab(element) {
    document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
    element.classList.add('active');

    const tabName = element.querySelector('span')?.innerText;
    
    if (tabName === 'ë‚´ì •ë³´') {
        refreshUserData(); 
        showPage('page-mypage'); 
        updateMypageGauge();
        if (userData && userData.isLoggedIn) {
            setTimeout(() => {
                /* ... (ê¸°ì¡´ ë§ˆì´í˜ì´ì§€ ë°ì´í„° ì±„ìš°ê¸° ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€) ... */
                const nameDisplay = document.getElementById('mypage-user-name');
                if (nameDisplay) nameDisplay.innerText = userData.name || "ì‚¬ìš©ì";
                const myPointEl = document.getElementById('my-u-points');
                if (myPointEl) animateValue('my-u-points', 0, Number(userData.points || 0), 1000);
                const qrImg = document.getElementById('my-qr-img');
                if (qrImg && userData.uid) qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
            }, 50);
        }
    }
    // [â–¼ ì—¬ê¸°ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤!]
    else if (tabName === 'ê°€ë§¹ì ') {
        showPage('page-partners');
    }
    else if (tabName === 'í™ˆ') {
        showPage('page-main');
    }
    else if (tabName === 'ì•ˆë‚´') {
        showPage('page-guide');
    }
}
        let userData = JSON.parse(localStorage.getItem('gnpay_user')) || { isLoggedIn: false, points: 0 };
                let selectedImages = [];
        let currentAct = { title: "", amount: 0 };
        const loading = document.getElementById('loading-overlay');
        let html5QrCode;

function showPage(pageId) {
    const targetPage = document.getElementById(pageId);
    const currentPage = document.querySelector('.page.active');

    // 1. íƒ€ê²Ÿì´ ì—†ê±°ë‚˜ ì´ë¯¸ ê·¸ í˜ì´ì§€ë©´ ì¦‰ì‹œ ì¤‘ë‹¨
    if (!targetPage || currentPage === targetPage) return;

    // [ë³´ì™„] ë§ˆì´í˜ì´ì§€ ì§„ì… ì‹œ ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë‚´ë¶€ í™”ë©´ ë¯¸ë¦¬ ì„¸íŒ…
    if (pageId === 'page-mypage') {
        syncMypageState(); 
    }

    // ìºë¦­í„° ì‚°ì±…ë¡œ(Harry) ìˆ¨ê¹€ ì œì–´
    const walkPath = document.querySelector('.walk-path');
    if (walkPath) {
        const isAuthPage = ['page-login', 'page-signup'].includes(pageId);
        walkPath.style.display = isAuthPage ? 'none' : 'block';
    }

    // 2. ë°©í–¥ ê³„ì‚° (í˜ì´ì§€ ì´ë™ ì• ë‹ˆë©”ì´ì…˜ìš©)
    const order = ['page-login', 'page-signup', 'page-main', 'page-history', 'page-guide', 'page-mypage', 'page-activities', 'page-ranking'];
    const curIdx = currentPage ? order.indexOf(currentPage.id) : -1;
    const nextIdx = order.indexOf(pageId);

    // 3. ì…ë ¥ì°½ ì ê¸ˆ (ì „í™˜ ë„ì¤‘ í„°ì¹˜ ë°©ì§€)
    document.querySelectorAll('input, select, textarea').forEach(el => el.disabled = true);

    // 4. [ê¸°ì¡´ í˜ì´ì§€ ì²˜ë¦¬] ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜ ì‚¬ë¼ì§
    if (currentPage) {
        currentPage.classList.remove('active');
        currentPage.style.transition = 'transform 0.35s ease-out, opacity 0.35s ease-out';
        currentPage.style.transform = nextIdx > curIdx ? 'translateX(-100%)' : 'translateX(100%)';
        currentPage.style.opacity = '0';
        
        const prevPage = currentPage;
        setTimeout(() => {
            if (!prevPage.classList.contains('active')) {
                prevPage.style.display = 'none';
                prevPage.style.transform = 'none';
            }
        }, 350);
    }

    // 5. [íƒ€ê²Ÿ í˜ì´ì§€ ë“±ì¥] ì• ë‹ˆë©”ì´ì…˜ ì¤€ë¹„
    targetPage.style.display = 'block';
    targetPage.style.transition = 'none'; 
    
    const startX = nextIdx > curIdx ? '100%' : '-100%';
    targetPage.style.transform = `translateX(${startX})`;
    targetPage.style.opacity = '0';
    
    void targetPage.offsetWidth; // ë¸Œë¼ìš°ì € ë¦¬í”Œë¡œìš° ê°•ì œ (ì• ë‹ˆë©”ì´ì…˜ ì¤€ë¹„)

    requestAnimationFrame(() => {
        targetPage.style.transition = 'transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1), opacity 0.3s ease';
        targetPage.classList.add('active');
        targetPage.style.transform = 'translateX(0)';
        targetPage.style.opacity = '1';
    });

    // 6. ë§ˆë¬´ë¦¬ (UI ì—…ë°ì´íŠ¸ ë° ì…ë ¥ì°½ ì ê¸ˆ í•´ì œ)
    setTimeout(() => {
        targetPage.querySelectorAll('input, select, textarea').forEach(el => el.disabled = false);
        if (pageId === 'page-main' || pageId === 'page-mypage') updateUI();
    }, 400);

    // 7. [í•µì‹¬ ìˆ˜ë¦¬] í•˜ë‹¨ë°”(Tab Bar) ê°•ì œ ë³µêµ¬ ë° ì œì–´
    const tabBar = document.querySelector('.floating-tab-bar');
    if (tabBar) {
        const isAuthPage = ['page-login', 'page-signup'].includes(pageId);
        
        if (isAuthPage) {
            tabBar.style.display = 'none'; // ë¡œê·¸ì¸/ê°€ì… í˜ì´ì§€ëŠ” ìˆ¨ê¹€
        } else {
            // ğŸŒŸ ë­í‚¹ í˜ì´ì§€ ë“±ì—ì„œ X ëˆ„ë¥´ê³  ì˜¬ ë•Œ ë¬´ì¡°ê±´ ë‹¤ì‹œ ì‚´ë ¤ëƒ„
            tabBar.style.display = 'flex';
            tabBar.style.opacity = '1';
            // ì•„ë˜ë¡œ ìˆ¨ê²¨ì¡Œë˜ ìœ„ì¹˜ë¥¼ ê°•ì œë¡œ ì›ìœ„ì¹˜(0)ë¡œ ê³ ì •
            tabBar.style.setProperty('transform', 'translateX(-50%) translateY(0)', 'important');
            tabBar.style.pointerEvents = 'auto'; 
        }
        
        // í•˜ë‹¨ë°” ì•„ì´ì½˜ ë¶ˆ ì¼œê¸° ë™ê¸°í™”
        if (typeof syncTabBar === "function") syncTabBar(pageId);
    }
    
    window.scrollTo({ top: 0, behavior: 'instant' });
}

function syncMypageState() {
    // [ìˆ˜ì •] localStorageì˜ ì—‰ëš±í•œ í‚¤ ëŒ€ì‹ , í˜„ì¬ ë¡œë“œëœ userData ê°ì²´ì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    const isLogined = userData && userData.isLoggedIn; 
    
    const guestContent = document.getElementById('mypage-guest-content');
    const userContent = document.getElementById('mypage-user-content');
    const authButtons = document.getElementById('mypage-auth-buttons');

    if (!isLogined) {
        // ë¹„ë¡œê·¸ì¸: ê²ŒìŠ¤íŠ¸ í™”ë©´ ë…¸ì¶œ (ì—¬ê¸°ì— 'ë¡œê·¸ì¸ í•˜ëŸ¬ê°€ê¸°' ë²„íŠ¼ì´ ìˆìŒ)
        if(guestContent) guestContent.style.display = 'flex';
        if(userContent) userContent.style.display = 'none';
        if(authButtons) authButtons.style.display = 'none';
    } else {
        // ë¡œê·¸ì¸: íšŒì› ì¹´ë“œ ë…¸ì¶œ
        if(guestContent) guestContent.style.display = 'none';
        if(userContent) userContent.style.display = 'block';
        if(authButtons) authButtons.style.display = 'flex';
    }
}
function updateUI() {
    const authArea = document.getElementById('auth-area');
    const welcome = document.getElementById('welcome-message');
    
    const blackCard = document.getElementById('qr-trigger'); 
    const whiteCard = document.getElementById('white-qr-card'); 
    const qrPreview = document.getElementById('main-qr-preview');
    
    const mainMyRankEl = document.getElementById('main-my-rank');
    const medalBox = document.getElementById('main-rank-pills');
    const mainNextRankName = document.getElementById('main-next-rank-name');
    const mainNextNeeded = document.getElementById('main-next-needed');
    const mainGaugeBar = document.getElementById('main-card-gauge-bar');
    const mainGaugePercent = document.getElementById('main-gauge-percent');
    const rankLabel = document.getElementById('mypage-rank-label');

    syncMypageState(); 

    const qrLogged = document.getElementById('qr-content-logged-in');
    const qrGuest = document.getElementById('qr-content-guest');

    if (userData.isLoggedIn) {
        if(qrLogged) qrLogged.style.display = 'flex';
        if(qrGuest) qrGuest.style.display = 'none';

        const currentRankKey = getRankByPoints(userData.points);
        const rankData = {
            'GUEST':   { text: 'GIMNYEONG PAY', color: 'linear-gradient(145deg, #ffffff, #e6e6e6)', textColor: '#333' },
            'ë³´ë§':    { text: 'ê¹€ë…• ë³´ë§ ğŸš', color: 'linear-gradient(145deg, #ffdee9, #b5fffc)', textColor: '#333' },
            'ê°ì':    { text: 'ê¹€ë…• ê°ì ğŸ¥”', color: 'linear-gradient(145deg, #e1b382, #c89666)', textColor: '#fff' },
            'ë‹¹ê·¼':    { text: 'ê¹€ë…• ë‹¹ê·¼ ğŸ¥•', color: 'linear-gradient(145deg, #ff9a9e, #fecfef)', textColor: '#fff' },
            'ëŒê³ ë˜':  { text: 'ê¹€ë…• ëŒê³ ë˜ ğŸ¬', color: 'linear-gradient(145deg, #01b2ad, #00d2ff)', textColor: '#fff' },
            'í•´ë…€':    { text: 'ì „ì„¤ì˜ í•´ë…€ ğŸ‘‘', color: 'linear-gradient(145deg, #667eea, #764ba2)', textColor: '#fff' }
        };

        // ğŸŒŸ [ìˆ˜ì • í¬ì¸íŠ¸] ìˆœìœ„ ì—…ë°ì´íŠ¸ ë¡œì§ ğŸŒŸ
        if (mainMyRankEl) {
            // [ì¤‘ìš”] lastRankingData(ì˜¤ëŠ˜/ì „ì²´ ê°€ë³€í˜•)ê°€ ì•„ë‹ˆë¼ totalRankingData(ì „ì²´ ê³ ì •í˜•)ë¥¼ ë´…ë‹ˆë‹¤.
            const allRanking = totalRankingData || []; 
            const myIdx = allRanking.findIndex(u => String(u.name).trim() === String(userData.name).trim());
            
            if (allRanking.length > 0) { 
                if (myIdx !== -1) {
                    mainMyRankEl.innerText = (myIdx + 1) + "ìœ„"; 
                    if (medalBox) {
                        if (myIdx === 0) medalBox.innerHTML = '<div class="pill gold">ğŸ¥‡</div>';
                        else if (myIdx === 1) medalBox.innerHTML = '<div class="pill silver">ğŸ¥ˆ</div>';
                        else if (myIdx === 2) medalBox.innerHTML = '<div class="pill bronze">ğŸ¥‰</div>';
                        else medalBox.innerHTML = ''; 
                    }
                } else {
                    mainMyRankEl.innerText = "ìˆœìœ„ ì™¸"; 
                    if (medalBox) medalBox.innerHTML = '';
                }
            } else {
                // ì•„ì§ ì „ì²´ ë­í‚¹ ë°ì´í„°ë¥¼ í•œ ë²ˆë„ ì•ˆ ë¶ˆëŸ¬ì™”ì„ ë•Œ í‘œì‹œ
                mainMyRankEl.innerText = "-ìœ„"; 
            }
        }

        // 2. ê²Œì´ì§€ ë° ë‹¤ìŒ ë“±ê¸‰ ê³„ì‚° (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        const points = Number(userData.points || 0);
        const ranks = [
            { id: 'ë³´ë§', name: 'ë³´ë§', pt: 0 },
            { id: 'ê°ì', name: 'ê°ì', pt: 1000 },
            { id: 'ë‹¹ê·¼', name: 'ë‹¹ê·¼', pt: 3000 },
            { id: 'ëŒê³ ë˜', name: 'ëŒê³ ë˜', pt: 5000 },
            { id: 'í•´ë…€', name: 'í•´ë…€', pt: 10000 }
        ];

        const nextRank = ranks.find(r => r.pt > points);
        const currentRankData = [...ranks].reverse().find(r => r.pt <= points);
        
        // ê²Œì´ì§€ í…ìŠ¤íŠ¸ ì˜ì—­ (ë¶€ëª¨ ìš”ì†Œë¥¼ í†µì§¸ë¡œ ì œì–´í•´ì„œ 'ê¹Œì§€', 'P'ë¥¼ ì§€ì›ë‹ˆë‹¤)
        const gaugeTextArea = document.querySelector('.main-card-gauge-area .d-flex.justify-content-between');

        if (nextRank) {
            // [ì¼ë°˜ ë“±ê¸‰] ë‹¤ìŒ ëª©í‘œê°€ ìˆì„ ë•Œ (ê¸°ì¡´ í‹€ ìœ ì§€)
            if (gaugeTextArea) {
                gaugeTextArea.innerHTML = `
                    <div style="color: rgba(255,255,255,0.6);">
                        <span id="main-next-rank-name" style="color: #fff;">${nextRank.name}</span>ê¹Œì§€ 
                        <span id="main-next-needed" style="color: #01b2ad;">${(nextRank.pt - points).toLocaleString()}</span>P
                    </div>
                    <div id="main-gauge-percent" style="color: #01b2ad;">${Math.min(Math.floor(((points - currentRankData.pt) / (nextRank.pt - currentRankData.pt)) * 100), 100)}%</div>
                `;
            }
            if (mainGaugeBar) mainGaugeBar.style.width = Math.min(Math.floor(((points - currentRankData.pt) / (nextRank.pt - currentRankData.pt)) * 100), 100) + "%";
        } else {
            // ğŸŒŸ [ìµœê³  ë“±ê¸‰] 'í•´ë…€' ë‹¬ì„± ì‹œ (í‹€ì„ ìƒˆë¡œ ì§­ë‹ˆë‹¤)
            if (gaugeTextArea) {
                gaugeTextArea.innerHTML = `
                    <div style="color: #fff; font-weight: 800; letter-spacing: -0.5px;">
                        <i class="bi bi-patch-check-fill" style="color:#ffcc00;"></i> ê¹€ë…•ì˜ ì „ì„¤ì ì¸ í•´ë…€
                    </div>
                    <div style="color: #ffcc00; font-weight: 900;">MAX</div>
                `;
            }
            if (mainGaugeBar) {
                mainGaugeBar.style.width = "100%";
                mainGaugeBar.style.background = "linear-gradient(90deg, #01b2ad, #00d2ff)";
            }
        }
        // 3. QR í´ë¦­ ì„¸íŒ… ë° ë‚˜ë¨¸ì§€ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        if (qrPreview) {
            qrPreview.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${userData.uid}`;
        }

        if (whiteCard) {
            whiteCard.onclick = () => {
                const tabBar = document.querySelector('.floating-tab-bar');
                if (tabBar) tabBar.style.display = 'none';
                document.getElementById('qr-focus-layer').style.display = 'flex';
                const targetPoints = Number(userData.points || 0);
                animateValue('focus-points', 0, targetPoints, 1000);
                document.getElementById('qr-img-large').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
            };
        }

        if (blackCard) {
            blackCard.onclick = () => {
                showPage('page-ranking');
                loadRankingData('today');
            };
        }

        if (rankLabel) {
            const data = rankData[currentRankKey] || rankData['GUEST'];
            rankLabel.innerText = data.text;
            rankLabel.style.display = 'inline-block';
            rankLabel.style.padding = '4px 14px';
            rankLabel.style.borderRadius = '15px';
            rankLabel.style.background = data.color;
            rankLabel.style.color = data.textColor;
            rankLabel.style.fontSize = '0.75rem';
            rankLabel.style.fontWeight = '900';
            rankLabel.style.boxShadow = '0 4px 10px rgba(0,0,0,0.08)';
            rankLabel.style.marginBottom = '8px';
        }

        updateHarryCharacter(currentRankKey);

        authArea.innerHTML = `<span class="auth-link" style="color:var(--primary); font-weight:800;" onclick="showPage('page-mypage')">${userData.name}ë‹˜</span><span style="color:#eee; font-size:0.7rem;">|</span><span class="auth-link" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</span>`;
        welcome.innerHTML = `${userData.name}ë‹˜, ë°˜ê°‘ìŠµë‹ˆë‹¤!<br><strong>ê¹€ë…•ì„ ì§€ì¼œì£¼ì„¸ìš”!</strong>`;
        
        const targetPoints = Number(userData.points || 0);
        const pDisplay = document.getElementById('main-u-points');
        if (pDisplay) animateValue('main-u-points', 0, targetPoints, 1000);
        animateValue('my-u-points', 0, targetPoints, 1000); 

        const myName = document.getElementById('mypage-user-name');
        if(myName) myName.innerText = userData.name;

        const myQr = document.getElementById('my-qr-img');
        if(myQr) myQr.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${userData.uid}`;

        updateActivityBadge();

        if (!window.pointSyncInterval) {
            window.pointSyncInterval = setInterval(syncPointsRealtime, 5000);
        }

    } else {
        // ë¹„ë¡œê·¸ì¸ ë¡œì§ (ê¸°ì¡´ ìœ ì§€)
        if(qrLogged) qrLogged.style.display = 'none';
        if(qrGuest) qrGuest.style.display = 'flex';
        updateHarryCharacter('GUEST');
        authArea.innerHTML = `<span class="auth-link" onclick="showPage('page-signup')">íšŒì›ê°€ì…</span><span style="color:#eee; font-size:0.7rem;">|</span><span class="auth-link text-dark" onclick="showPage('page-login')">ë¡œê·¸ì¸</span>`;
        if (blackCard) blackCard.onclick = () => showPage('page-login');
        if (whiteCard) whiteCard.onclick = () => showPage('page-login');
        welcome.innerHTML = `ë‚´ì†ì•ˆì˜ íƒ„ì†Œì¤‘ë¦½í¬ì¸íŠ¸(ì‹¤ì²œ)<br><strong>ë¡œê·¸ì¸ í›„ ê¹€ë…•ì„ ì§€ì¼œì£¼ì„¸ìš”!</strong>`;
    }
}
function updateActivityBadge() {
    // 1. ìˆ«ìë¥¼ í‘œì‹œí•  ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const badge = document.getElementById('activity-badge-count');
    // 2. ì‚¬ì¥ë‹˜ì´ ë§Œë“œì‹  í™œë™ ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const container = document.getElementById('activity-list-container');
    
    if (badge && container) {
        // ì»¨í…Œì´ë„ˆ ì•ˆì— ìˆëŠ” 'dashboard-card' ê°œìˆ˜ë¥¼ ì„¸ì–´ë´…ë‹ˆë‹¤.
        const count = container.querySelectorAll('.dashboard-card').length;
        
        if (count > 0) {
            badge.innerText = count;  // ê°œìˆ˜ë¥¼ ë°°ì§€ì— ì…ë ¥
            badge.style.display = 'flex'; // ë°°ì§€ ë³´ì´ê¸°
        } else {
            badge.style.display = 'none'; // ê°œìˆ˜ê°€ 0ì´ë©´ ìˆ¨ê¸°ê¸°
        }
    }
}

async function syncPointsRealtime() {
    if (!userData.isLoggedIn) return;
    try {
        const res = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ type: 'login', email: userData.email, password: userData.password })
        }).then(r => r.json());

        if (res.result === 'success') {
            // 1. ë°ì´í„° ì—…ë°ì´íŠ¸
            userData.points = res.user.points;
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            
            // 2. [ì¶”ê°€] ë­í‚¹ ë°ì´í„°ë„ ìµœì‹ ìœ¼ë¡œ ê¸ì–´ì˜¤ê¸°
            // ì´ê²Œ ìˆì–´ì•¼ ìˆ˜í˜¸ì ì¹´ë“œì— "ëª‡ ìœ„"ì¸ì§€ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤.
            await loadRankingData(currentRankMode);

            // 3. í™”ë©´ì˜ ìˆ«ì(í¬ì¸íŠ¸) ì—…ë°ì´íŠ¸
            document.querySelectorAll('.user-points-display').forEach(el => {
                el.innerText = Number(res.user.points).toLocaleString();
            });

            // 4. [ë³´ê°•] ìˆ˜í˜¸ì ì¹´ë“œ ì „ì²´ UI ë¦¬í”„ë ˆì‰¬
            // ê²Œì´ì§€ ë°”, ë‹¤ìŒ ë“±ê¸‰ê¹Œì§€ ë‚¨ì€ í¬ì¸íŠ¸ ê³„ì‚°ì„ ì—¬ê¸°ì„œ ë‹¤ì‹œ ë•Œë ¤ì¤ë‹ˆë‹¤.
            updateUI(); 

            // 5. ìºë¦­í„° ë° ë“±ê¸‰ ì¦‰ì‹œ ê°±ì‹ 
            const currentRank = getRankByPoints(res.user.points);
            updateHarryCharacter(currentRank);
        }
    } catch (e) { 
        console.log("ì‹¤ì‹œê°„ ë™ê¸°í™” ì¤‘..."); 
    }
}
function goToMyPage() {
    // 1. ë§ˆì´í˜ì´ì§€ë¡œ í™”ë©´ ì „í™˜
    showPage('page-mypage');
    
    // 2. [í•µì‹¬] ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ ì‹¤ì œ ì´ë¦„ì„ í™”ë©´ì— ë°•ì•„ë„£ê¸°
    const nameDisplay = document.getElementById('mypage-user-name');
    if (nameDisplay && userData.name) {
        nameDisplay.innerText = userData.name;
    }

    // 3. í¬ì¸íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
    const pointDisplay = document.getElementById('my-u-points');
    if (pointDisplay) {
        pointDisplay.innerText = Number(userData.points || 0).toLocaleString();
    }

    // 4. QR ì½”ë“œ ìƒì„± (ì‚¬ìš©ì UID ê¸°ë°˜)
    const qrImg = document.getElementById('my-qr-img');
    if (qrImg && userData.uid) {
        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
    }
}

    // 4. QR ì½”ë“œ ìƒì„±
    document.getElementById('my-qr-img').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;


       async function submitLogin() {
    // [ì¹¼ê° ìœ ì§€] í˜•ë‹˜ì´ ì“°ì‹œëŠ” ID ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤
    const email = document.getElementById('login-email').value;
    const pw = document.getElementById('login-pw').value;
    
    if(!email || !pw) return alert("ì…ë ¥í•´ì£¼ì„¸ìš”.");
    loading.style.display='flex';
    
    try {
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ type: 'login', email, password: pw }) 
        }).then(r => r.json());

        if (res.result === 'success') {
            // [ì§€í›ˆì´ì˜ ì—”ì§„ ì¶”ê°€] ì•„ì´ë”” ê¸°ì–µí•˜ê¸° ì²´í¬ ì—¬ë¶€ í™•ì¸
            const rememberMe = document.getElementById('remember-me').checked;
            if (rememberMe) {
                localStorage.setItem('gnpay_remember_email', email);
            } else {
                localStorage.removeItem('gnpay_remember_email');
            }

            userData = { isLoggedIn: true, ...res.user, password: pw };
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            updateUI();
            showPage('page-main');
        } else { 
            alert(res.message); 
        }
    } catch (e) { 
        alert("ë¡œê·¸ì¸ ì˜¤ë¥˜"); 
    }
    loading.style.display='none';
}
        async function submitSignup() {
            const data = { type: 'signup', name: document.getElementById('reg-name').value, email: document.getElementById('reg-email').value, password: document.getElementById('reg-pw').value, phone: document.getElementById('reg-phone').value };
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(data) }).then(r => r.json());
                if (res.result === 'success') { alert("ê°€ì… ì„±ê³µ!"); showPage('page-login'); } else { alert(res.message); }
            } catch (e) { alert("íšŒì›ê°€ì… ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

        function openSubmit(title, amount, desc) {
            if (!userData.isLoggedIn) return showPage('page-login');
            currentAct = { title, amount };
            document.getElementById('act-title-display').innerText = title;
            document.getElementById('act-desc-display').innerHTML = desc || "í™œë™ ë‚´ìš©ì„ ì¸ì¦í•˜ì„¸ìš”.";
            showPage('page-submit-act');
        }

        // [ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜] ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥ë°›ì•„ ì„œë²„(GAS)ì— ì„ì‹œë¹„ë²ˆ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
// 1. íŒì—… ì—´ê¸° (ê¸°ì¡´ì˜ prompt ëŒ€ì‹  ì´ê±¸ ì‹¤í–‰)

// [ìˆ˜ì •ëœ ê²Œì´ì§€ ì—…ë°ì´íŠ¸ ì—”ì§„]
function updateMypageGauge() {
    if (!userData.isLoggedIn) return;

    const points = Number(userData.points || 0);
    const ranks = [
        { id: 'ë³´ë§', name: 'ê¹€ë…• ë³´ë§ ğŸš', pt: 0 },
        { id: 'ê°ì', name: 'ê¹€ë…• ê°ì ğŸ¥”', pt: 1000 },
        { id: 'ë‹¹ê·¼', name: 'ê¹€ë…• ë‹¹ê·¼ ğŸ¥•', pt: 3000 },
        { id: 'ëŒê³ ë˜', name: 'ê¹€ë…• ëŒê³ ë˜ ğŸ¬', pt: 5000 },
        { id: 'í•´ë…€', name: 'ì „ì„¤ì˜ í•´ë…€ ğŸ‘‘', pt: 10000 }
    ];

    // ë‹¤ìŒ ë“±ê¸‰ê³¼ í˜„ì¬ ë“±ê¸‰ ê¸°ì¤€ ì°¾ê¸°
    const nextRank = ranks.find(r => r.pt > points);
    const currentRankData = [...ranks].reverse().find(r => r.pt <= points);

    // HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° (ì‚¬ì¥ë‹˜ ì½”ë“œì˜ ID ê¸°ì¤€)
    const badgeText = document.getElementById('pop-rank-badge-text'); 
    const nextInfo = document.getElementById('pop-next-info');
    const gaugeBar = document.getElementById('pop-gauge-bar');

    if (nextRank) {
        const range = nextRank.pt - currentRankData.pt;
        const progress = points - currentRankData.pt;
        const percent = Math.min(Math.floor((progress / range) * 100), 100);
        
        // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        if (badgeText) badgeText.innerText = nextRank.name;
        if (nextInfo) nextInfo.innerText = (nextRank.pt - points).toLocaleString();
        
        // ê²Œì´ì§€ ë°” ì• ë‹ˆë©”ì´ì…˜
        if (gaugeBar) {
            gaugeBar.style.width = percent + "%";
        }
    } else {
        if (badgeText) badgeText.innerText = "ìµœê³  ë“±ê¸‰ ë‹¬ì„±! ğŸ‘‘";
        if (nextInfo) nextInfo.innerText = "0";
        if (gaugeBar) gaugeBar.style.width = "100%";
    }
}
function handleForgotPassword() {
    const layer = document.getElementById('pw-reset-layer');
    if(layer) {
        layer.style.display = 'flex';
        
        // [ìˆ˜ì • í•µì‹¬] ì—¬ê¸°ë„ íŒì—… ì—´ë¦´ ë•Œ ì ê¸ˆ í•´ì œ ì¶”ê°€
        layer.querySelectorAll('input').forEach(el => el.disabled = false);

        document.getElementById('reset-email').value = '';
        document.getElementById('reset-phone').value = '';
    }
}

// 2. ì‹¤ì œ ì„œë²„ ì „ì†¡ (ì«€ë“í•œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰)
async function processPwReset() {
    const email = document.getElementById('reset-email').value;
    const phone = document.getElementById('reset-phone').value;

    if (!email || !phone) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");

    loading.style.display = 'flex';
    try {
        const res = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ 
                type: 'requestPwReset', 
                email: email, 
                phone: phone.replace(/[^0-9]/g, "") 
            })
        }).then(r => r.json());

        if (res.result === 'success') {
            alert("ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!\në©”ì¼ë¡œ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤.");
            document.getElementById('pw-reset-layer').style.display = 'none';
        } else {
            alert(res.message);
        }
    } catch (e) {
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    }
    loading.style.display = 'none';
}
async function previewImages() {
    const fileInput = document.getElementById('act-files');
    const previewContainer = document.getElementById('image-preview');
    const files = fileInput.files;
    
    if (files.length === 0) return;

    previewContainer.innerHTML = ''; // ê¸°ì¡´ ë¯¸ë¦¬ë³´ê¸° ì§€ìš°ê¸°
    selectedImages = []; // ì €ì¥ì†Œ ì´ˆê¸°í™”
    
    loading.style.display = 'flex'; // ì••ì¶• ì‹œì‘í•˜ë‹ˆ ë¡œë”©ë°” ë„ìš°ê¸°

    const options = {
        maxSizeMB: 0.5,          // 0.5MBê¹Œì§€ ì••ì¶•
        maxWidthOrHeight: 1280, // ê°€ë¡œì„¸ë¡œ ìµœëŒ€ 1280px
        useWebWorker: true
    };

    try {
        for (let i = 0; i < files.length; i++) {
            // [í•µì‹¬] ì—¬ê¸°ì„œ ì‚¬ì¥ë‹˜ì´ ê°€ì ¸ì˜¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì••ì¶•ì„ ì§„í–‰í•©ë‹ˆë‹¤
            const compressedFile = await imageCompression(files[i], options);
            
            const reader = new FileReader();
            reader.readAsDataURL(compressedFile);
            
            await new Promise((resolve) => {
                reader.onloadend = () => {
                    const base64data = reader.result;
                    selectedImages.push(base64data);
                    
                    const img = document.createElement('img');
                    img.src = base64data;
                    img.className = 'history-img'; // ì‚¬ì¥ë‹˜ ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€
                    img.style.width = '80px';
                    img.style.height = '80px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '12px';
                    previewContainer.appendChild(img);
                    resolve();
                };
            });
        }
    } catch (error) {
        console.error(error);
        alert("ì´ë¯¸ì§€ ì••ì¶• ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    } finally {
        loading.style.display = 'none'; // ì••ì¶• ëë‚¬ìœ¼ë‹ˆ ë¡œë”©ë°” ë„ê¸°
    }
}
        async function submitActivity() {
            const content = document.getElementById('act-content').value;
            if(!content || selectedImages.length === 0) return alert("í™œë™ ë‚´ìš©ê³¼ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.");
            loading.style.display='flex';
            try {
                const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ type: 'submitActivity', email: userData.email, title: currentAct.title, content: content, images: selectedImages, pointAmount: currentAct.amount }) }).then(r => r.json());
                if(res.result === 'success') { alert("ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"); showPage('page-main'); }
                else { alert("ì˜¤ë¥˜: " + res.message); }
            } catch(e) { alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜"); }
            loading.style.display='none';
        }

   // [ìµœì¢…] ë‚´ì—­ ì¡°íšŒ í•¨ìˆ˜: ì„œë²„ì—ì„œ ì¥ë¶€ì™€ ì‹ ì²­ë‚´ì—­ì„ ë™ì‹œì— ê°€ì ¸ì˜´
async function loadActivityHistory() {
    showPage('page-history');
    switchHistoryTab('point'); 

    const pointList = document.getElementById('point-history-list');
    const activityList = document.getElementById('activity-history-list');
    
    pointList.innerHTML = '<div class="text-center p-4 small text-muted">ë°ì´í„° ë™ê¸°í™” ì¤‘...</div>';
    activityList.innerHTML = '<div class="text-center p-4 small text-muted">ë°ì´í„° ë™ê¸°í™” ì¤‘...</div>';

    try {
        const response = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ 
                type: 'login', 
                email: userData.email, 
                password: userData.password 
            }) 
        });
        const res = await response.json();

        if (res.result === 'success') {
            const pLogs = res.user.history || [];       // PointLogs ë°ì´í„°
            const aLogs = res.user.applications || [];  // Applications ë°ì´í„°

            let pHtml = '';
            let aHtml = '';

            // 1. í¬ì¸íŠ¸ ë‚´ì—­ ë¹Œë“œ (ì¥ë¶€ ë°ì´í„°)
if (pLogs.length > 0) {
    pLogs.forEach(log => {
        const isPlus = Number(log.amount) > 0;
        pHtml += `
            <div class="dashboard-card mb-3" style="padding:18px; border-left:5px solid ${isPlus ? 'var(--primary)' : '#ff4d4d'}; width:100%; margin:0 0 12px 0; cursor:default;
                animation: breathe 2s infinite ease-in-out; /* [í•µì‹¬] ìˆ¨ì‰¬ê¸° ì• ë‹ˆë©”ì´ì…˜ ê°•ì œ ì£¼ì… */
            ">
                <div style="flex:1;">
                    <div class="fw-bold" style="font-size:1rem;">${log.title}</div>
                    <div class="small text-muted">${log.date}</div>
                </div>
                <div class="fw-bold" style="color:${isPlus ? 'var(--primary)' : '#ff4d4d'}">
                    ${isPlus ? '+' : ''}${Number(log.amount).toLocaleString()} P
                </div>
            </div>`;
    });
}

            // 2. í™œë™ í˜„í™© ë¹Œë“œ (ì‚¬ì§„ í¼ì¹˜ê¸° ê¸°ëŠ¥ íƒ‘ì¬)
if (aLogs.length > 0) {
    aLogs.forEach((app, idx) => {
        const s = app.status || 'ëŒ€ê¸°';
        // ìŠ¹ì¸ì´ë©´ ì´ˆë¡(var(--primary)), ë°˜ë ¤ë©´ ë¹¨ê°•(#ff4d4d), ëŒ€ê¸°ë©´ ë…¸ë‘(#ffcc00)
        const sColor = s === 'ìŠ¹ì¸' ? 'var(--primary)' : (s === 'ë°˜ë ¤' ? '#ff4d4d' : '#ffcc00');
        
        // ì‚¬ì§„ ë°ì´í„° í™•ë³´
        const pic1 = app.img1 || app.ì‚¬ì§„1 || app.photo1;
        const pic2 = app.img2 || app.ì‚¬ì§„2 || app.photo2;
        const pic3 = app.img3 || app.ì‚¬ì§„3 || app.photo3;

        aHtml += `
            <div class="dashboard-card mb-3" style="padding:18px; border-left:5px solid ${sColor}; flex-direction:column; align-items:flex-start; cursor:pointer;" 
                 onclick="const d = document.getElementById('detail-${idx}'); d.style.display = (d.style.display === 'none' ? 'block' : 'none')">
                
                <div class="d-flex justify-content-between w-100 align-items-center">
                    <div style="flex:1;">
                        <div class="fw-bold" style="font-size:1rem; color:#333;">${app.title}</div>
                        <div class="small text-muted">${app.date}</div>
                    </div>
                    <div class="text-end">
                        <div class="badge mb-1" style="background:${sColor}; color:white; border-radius:8px; font-size:0.7rem; padding:4px 10px;">${s}</div>
                        ${s === 'ìŠ¹ì¸' ? `<div class="fw-bold" style="color:var(--primary); font-size:0.9rem;">+${Number(app.points).toLocaleString()} P</div>` : ''}
                    </div>
                </div>

                <div id="detail-${idx}" style="display:none; width:100%; margin-top:15px; border-top:1px dashed #eee; padding-top:15px;">
                    <div class="row g-2 mb-3">
                        ${pic1 ? `<div class="col-4"><img src="${pic1}" class="img-fluid rounded-3 shadow-sm" style="aspect-ratio:1; object-fit:cover;"></div>` : ''}
                        ${pic2 ? `<div class="col-4"><img src="${pic2}" class="img-fluid rounded-3 shadow-sm" style="aspect-ratio:1; object-fit:cover;"></div>` : ''}
                        ${pic3 ? `<div class="col-4"><img src="${pic3}" class="img-fluid rounded-3 shadow-sm" style="aspect-ratio:1; object-fit:cover;"></div>` : ''}
                    </div>

                    ${s === 'ë°˜ë ¤' ? `
                        <div style="background:#fff5f5; padding:12px; border-radius:12px; border:1px solid #ffe3e3;">
                            <div class="d-flex justify-content-between align-items:center;">
                                <span class="small text-muted">í¬ì¸íŠ¸ íšë“ ì‹¤íŒ¨</span>
                                <span class="fw-bold" style="color:#ff4d4d; text-decoration:line-through;">+${Number(app.points).toLocaleString()} P</span>
                            </div>
                            ${app.message ? `<div class="mt-2 small" style="color:#e03131;"><strong>ì‚¬ìœ :</strong> ${app.message}</div>` : ''}
                        </div>
                    ` : `
                        <div class="small text-muted text-center py-2" style="background:#f8f9fa; border-radius:10px;">
                            ${s === 'ìŠ¹ì¸' ? 'ì •ìƒ ìŠ¹ì¸ëœ í™œë™ì…ë‹ˆë‹¤.' : 'ê´€ë¦¬ìê°€ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤.'}
                        </div>
                    `}
                </div>
            </div>`;
    });
}

            pointList.innerHTML = pHtml || '<div class="text-center text-muted mt-5 small">í¬ì¸íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            activityList.innerHTML = aHtml || '<div class="text-center text-muted mt-5 small">í™œë™ ì‹ ì²­ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            
            userData.points = res.user.points;
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            updateUI();
        }
    } catch (e) {
        console.error(e);
        pointList.innerHTML = '<div class="text-center text-muted mt-5 small">ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
    }
}
// ì •ë³´ ìˆ˜ì • ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
// ì •ë³´ ìˆ˜ì • ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
function openEditInfo() {
    const layer = document.getElementById('profile-edit-layer');
    if (layer) {
        layer.style.display = 'flex';
        
        // [ìˆ˜ì • í•µì‹¬] íŒì—…ì´ ì—´ë¦´ ë•Œ, ì–µì§€ë¡œ ì ê²¨ìˆë˜ ì…ë ¥ì°½ë“¤ì„ ê¹¨ì›Œì¤ë‹ˆë‹¤.
        layer.querySelectorAll('input, select').forEach(el => el.disabled = false);
        
        if (userData) {
            // ì‚¬ì¥ë‹˜ ìš”ì²­: íŒì—… ì œëª©ì— ì´ë¦„ ë„£ê¸°
            const nameTarget = document.getElementById('edit-user-name');
            if (nameTarget) nameTarget.innerText = userData.name || "ì‚¬ìš©ì";

            // ê¸°ì¡´ ì •ë³´ ì±„ìš°ê¸°
            const regionSelect = document.getElementById('popup-edit-region');
            const phoneInput = document.getElementById('popup-edit-phone');

            if(regionSelect) regionSelect.value = userData.region || "ì œì£¼";
            if(phoneInput) phoneInput.value = userData.phone || "";
        }
        // ë¹„ë°€ë²ˆí˜¸ ì¹¸ì€ ë¹„ì›Œë‘ê¸°
        const pwInput = document.getElementById('popup-edit-pw');
        if(pwInput) pwInput.value = "";
    }
}
// íŒì—… ì•ˆì—ì„œ 'ìˆ˜ì •ì™„ë£Œ' ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
async function submitPopupEdit() {
    const newRegion = document.getElementById('popup-edit-region').value;
    const newPhone = document.getElementById('popup-edit-phone').value;
    const newPw = document.getElementById('popup-edit-pw').value;

    if(!newPhone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    loading.style.display = 'flex';
    try {
        const res = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({
                type: 'updateUserInfo',
                email: userData.email,
                newPhone: newPhone,
                newPw: newPw,
                newRegion: newRegion,
                newGender: userData.gender // ê¸°ì¡´ ì •ë³´ ìœ ì§€
            })
        }).then(r => r.json());

        if(res.result === 'success') {
            alert("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ˜Š");
            
            // ë‚´ í°ì˜ ë¡œì»¬ ë°ì´í„°ë„ ì¦‰ì‹œ ê°±ì‹ 
            userData.phone = newPhone;
            userData.region = newRegion;
            if(newPw) userData.password = newPw;
            
            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            
            // íŒì—… ë‹«ê¸°
            document.getElementById('profile-edit-layer').style.display = 'none';
        } else {
            alert("ìˆ˜ì • ì‹¤íŒ¨: " + res.message);
        }
    } catch(e) {
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”!");
    }
    loading.style.display = 'none';
}
async function submitEditInfo() {
    // 1. í™”ë©´ì—ì„œ ê°’ ê¸ì–´ì˜¤ê¸°
    const newPhone = document.getElementById('edit-phone').value;
    const newPw = document.getElementById('edit-pw').value;
    const newGender = document.getElementById('edit-gender').value; 
    const newRegion = document.getElementById('edit-region').value;

    if(!newPhone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    loading.style.display = 'flex';
    try {
        // 2. ì„œë²„(GAS)ì— ëª¨ë“  ì •ë³´ë¥¼ ì‹¤ì–´ì„œ ë³´ëƒ„
        const res = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ 
                type: 'updateUserInfo', 
                email: userData.email, 
                newPhone: newPhone, 
                newPw: newPw,
                newGender: newGender, 
                newRegion: newRegion  
            }) 
        }).then(r => r.json());

        if(res.result === 'success') {
            alert("ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ˜Š");
            
            // 3. ë‚´ í°(ë©”ëª¨ë¦¬) ë°ì´í„°ë„ ì¦‰ì‹œ ê°±ì‹ 
            userData.phone = newPhone;
            userData.gender = newGender;
            userData.region = newRegion;
            if(newPw) userData.password = newPw;

            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            showPage('page-mypage');
        } else { 
            alert("ìˆ˜ì • ì‹¤íŒ¨: " + res.message); 
        }
    } catch(e) { 
        alert("ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!"); 
    }
    loading.style.display = 'none';
}
        async function handleScan() {
            if (!userData.isLoggedIn) return showPage('page-login');
            document.getElementById('scanner-modal').style.display = 'block';
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, async (text) => {
                closeScanner();
                processAddPoints(100, "í˜„ì¥ QR ì¸ì¦");
            });
        }
        function closeScanner() { if(html5QrCode) html5QrCode.stop(); document.getElementById('scanner-modal').style.display='none'; }
        
async function processAddPoints(amount, action) {
    loading.style.display = 'flex';
    try {
        const response = await fetch(GAS_URL, { 
            method: 'POST', 
            body: JSON.stringify({ 
                type: 'addPoints', 
                email: userData.email, 
                amount: amount, 
                action: action // "í˜„ì¥ QR ì ë¦½" ë“±ì´ Descriptionìœ¼ë¡œ ë“¤ì–´ê°
            }) 
        });
        const res = await response.json();

        if (res.result === 'success') {
            alert(amount + "í¬ì¸íŠ¸ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤!");
            
            // ì•± ë‚´ë¶€ ë°ì´í„° ë™ê¸°í™”
            userData.points = res.newPoints;
            
            // ë‚´ì—­ íƒ­ì„ ëˆŒë €ì„ ë•Œ ë°”ë¡œ ë³´ì´ê²Œ ë¡œì»¬ ë°°ì—´ì—ë„ ì„ì‹œ ì¶”ê°€
            if(!userData.pointLogs) userData.pointLogs = [];
            userData.pointLogs.unshift({
                Date: "ë°©ê¸ˆ ì „",
                Description: action,
                Change: amount
            });

            localStorage.setItem('gnpay_user', JSON.stringify(userData));
            updateUI();
        }
    } catch (e) {
        alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨");
    }
    loading.style.display = 'none';
}

        function logout() { if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { localStorage.removeItem('gnpay_user'); location.reload(); } }

// [ì „ì²´ êµì²´] ë©”ì¸ ì¹´ë“œ í´ë¦­ ì‹œ
document.getElementById('qr-trigger').onclick = (e) => {
    if (!userData.isLoggedIn) { showPage('page-login'); return; }
    
    // í•˜ë‹¨ë°” ì°¾ì•„ì„œ í™•ì‹¤í•˜ê²Œ ì•„ë˜ë¡œ 200px ë˜ì ¸ë²„ë¦¬ê¸°
    const tabBar = document.querySelector('.floating-tab-bar');
    if (tabBar) {
        tabBar.style.setProperty('transform', 'translateX(-50%) translateY(200px)', 'important');
    }
    
    // QR íŒì—… ë„ìš°ê¸°
    document.getElementById('qr-focus-layer').style.display = 'flex';
    
    const targetVal = Number(userData.points || 0);
    animateValue('focus-points', 0, targetVal, 1000);
    document.getElementById('qr-img-large').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${userData.uid}`;
};

// [ì „ì²´ êµì²´] íŒì—… ë‹«ì„ ë•Œ (ë‹«ê¸° ë²„íŠ¼ì— onclick="closeQR()" ê¼­ ë„£ì–´ì£¼ì„¸ìš”!)
// [í™•ì¸ ì‚¬ì‚´ ë²„ì „] ë”± í•˜ë‚˜ë§Œ ë‚¨ê¸°ì„¸ìš”
function closeQR() {
    // 1. QR íŒì—… ë„ê¸°
    document.getElementById('qr-focus-layer').style.display = 'none';
    
    // 2. í•˜ë‹¨ë°” ë‹¤ì‹œ ë¬´ì¡°ê±´ ì‚´ë¦¬ê¸° (display ë°©ì‹ì„ ì“°ë©´ ì ˆëŒ€ ì‹¤íŒ¨ ì•ˆ í•©ë‹ˆë‹¤)
    const tabBar = document.querySelector('.floating-tab-bar');
    if (tabBar) {
        tabBar.style.setProperty('display', 'flex', 'important');
    }
}
function animateValue(id, start, end, duration) {
    const obj = document.getElementById(id);
    if (!obj) return;
    
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        // ìˆ«ìë¥¼ ì½¤ë§ˆ(,) í¬í•¨í•´ì„œ ì˜ˆì˜ê²Œ ì°ì–´ì¤ë‹ˆë‹¤
        obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    window.requestAnimationFrame(step);
}
function forceShowPage(pageId) {
    // 1. ëª¨ë“  í˜ì´ì§€ë¥¼ ì‹¹ ë‹¤ ìˆ¨ê¹ë‹ˆë‹¤.
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    // 2. ê°€ë§¹ì  í˜ì´ì§€(page-partners)ë§Œ ë”± ë³´ì—¬ì¤ë‹ˆë‹¤.
    const targetPage = document.getElementById(pageId);
    if (targetPage) {
        targetPage.classList.add('active');
        window.scrollTo(0, 0);
    }
}  
function checkAndSignup() {
    // 1. ì…ë ¥ ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
    const name = document.getElementById('reg-name').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const pw = document.getElementById('reg-pw').value.trim();
    const phone = document.getElementById('reg-phone').value.trim();
    const gender = document.getElementById('reg-gender').value;
    const region = document.getElementById('reg-region').value;
    const agree = document.getElementById('reg-agree').checked;

    // 2. ë¹ˆì¹¸ ë° ìœ íš¨ì„± ì²´í¬ (í˜•ë‹˜, ì—¬ê¸°ê°€ í•µì‹¬ì…ë‹ˆë‹¤)
    if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (!gender) return alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!email) return alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (email.indexOf('@') === -1) return alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
    if (!pw) return alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (pw.length < 4) return alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ìë¦¬ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
    if (!phone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (!region) return alert("ê±°ì£¼ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!agree) return alert("ê°œì¸ì •ë³´ ì œê³µì— ë™ì˜í•´ì£¼ì„¸ìš”.");
    
    // ëª¨ë“  ì²´í¬ í†µê³¼ ì‹œì—ë§Œ ê¸°ì¡´ ê°€ì… í•¨ìˆ˜ ì‹¤í–‰
    submitSignup(); 
}
document.addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        const activePage = document.querySelector('.page.active');
        if (activePage) {
            if (activePage.id === 'page-login') submitLogin();
            else if (activePage.id === 'page-signup') submitSignup();
        }
    }
});  
function switchHistoryTab(type) {
    const pointTab = document.getElementById('tab-point');
    const activityTab = document.getElementById('tab-activity');
    const pointSection = document.getElementById('history-point-section');
    const activitySection = document.getElementById('history-activity-section');

    if (type === 'point') {
        pointTab.className = 'flex-fill text-center py-2 active-tab';
        activityTab.className = 'flex-fill text-center py-2 inactive-tab';
        pointSection.style.display = 'block';
        activitySection.style.display = 'none';
    } else {
        pointTab.className = 'flex-fill text-center py-2 inactive-tab';
        activityTab.className = 'flex-fill text-center py-2 active-tab';
        pointSection.style.display = 'none';
        activitySection.style.display = 'block';
    }
}
async function loadUserHistory() {
    // 1. íƒ­ ë©”ë‰´ êµ¬ì„± (í¬ì¸íŠ¸ / í™œë™)
    const historyHtml = `
        <div class="p-3">
            <div class="d-flex gap-2 mb-4 bg-white p-1 rounded-4 shadow-sm">
                <button class="btn w-50 rounded-4 fw-bold active-tab" id="tab-p" onclick="switchTab('p')">í¬ì¸íŠ¸ ë‚´ì—­</button>
                <button class="btn w-50 rounded-4 fw-bold" id="tab-a" onclick="switchTab('a')">í™œë™ ì‹ ì²­</button>
            </div>
            
            <div id="history-content">
                </div>
        </div>
    `;
    document.getElementById('page-history').innerHTML = historyHtml;
    renderPointLogs(); // ê¸°ë³¸ê°’ìœ¼ë¡œ í¬ì¸íŠ¸ ë‚´ì—­ ë¨¼ì € ë³´ì—¬ì¤Œ
}

// [í¬ì¸íŠ¸ ë‚´ì—­ ë Œë”ë§]
function renderPointLogs() {
    const container = document.getElementById('history-content');
    // userData.historyëŠ” ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ PointLogs ë°ì´í„°
    if (!userData.history || userData.history.length === 0) {
        container.innerHTML = '<div class="text-center py-5 text-muted">í¬ì¸íŠ¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    container.innerHTML = userData.history.map(log => `
        <div class="dashboard-card mb-3 p-3 d-flex justify-content-between align-items-center">
            <div>
                <div class="fw-bold">${log.title}</div>
                <div class="small text-muted">${log.date}</div>
            </div>
            <div class="fw-bold ${log.amount > 0 ? 'text-primary' : 'text-danger'}">
                ${log.amount > 0 ? '+' : ''}${log.amount.toLocaleString()} P
            </div>
        </div>
    `).join('');
}

// [í™œë™ ì‹ ì²­ í˜„í™© ë Œë”ë§]
function renderAppLogs() {
    const container = document.getElementById('history-content');
    if (!userData.applications || userData.applications.length === 0) {
        container.innerHTML = '<div class="text-center py-5 text-muted">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    container.innerHTML = userData.applications.map(app => {
        let statusClass = 'bg-warning'; // ëŒ€ê¸°
        if(app.status === 'ìŠ¹ì¸') statusClass = 'bg-success';
        if(app.status === 'ë°˜ë ¤') statusClass = 'bg-danger';

        return `
            <div class="dashboard-card mb-3 p-3">
                <div class="d-flex justify-content-between">
                    <div class="fw-bold">${app.title}</div>
                    <span class="badge ${statusClass}">${app.status}</span>
                </div>
                <div class="d-flex justify-content-between mt-2 align-items-end">
                    <div class="small text-muted">${app.date}</div>
                    <div class="fw-bold text-secondary">+${app.amount.toLocaleString()} P ì˜ˆì •</div>
                </div>
            </div>
        `;
    }).join('');
}
function syncTabBar(pageId) {
    document.querySelectorAll('.tab-item').forEach(tab => {
        tab.classList.remove('active');
    });

    let targetIdx = -1;
    if (pageId === 'page-main') targetIdx = 0;       // í™ˆ
    else if (pageId === 'page-partners') targetIdx = 1; // [ìˆ˜ì •] ë‚´ì—­ -> ê°€ë§¹ì 
    else if (pageId === 'page-guide') targetIdx = 2;    // ì•ˆë‚´ (ì•„ì´ì½˜ ìˆœì„œì— ë”°ë¼ ë²ˆí˜¸ ì¡°ì • í•„ìš”í•  ìˆ˜ ìˆìŒ)
    // ì›ë˜ ì•ˆë‚´ê°€ 3ë²ˆì§¸ì˜€ë‹¤ë©´ ê·¸ëŒ€ë¡œ ë‘ì‹œë©´ ë©ë‹ˆë‹¤.
    // (HTML ìˆœì„œ: í™ˆ(0) - ê°€ë§¹ì (1) - ìŠ¤ìº”ë²„íŠ¼ - ì•ˆë‚´(2) - ë‚´ì •ë³´(3))
    
    // ì•ˆë‚´ í˜ì´ì§€ê°€ HTMLìƒì—ì„œ 4ë²ˆì§¸(ì¸ë±ìŠ¤ 3)ì— ìˆë‹¤ë©´ targetIdx = 3ìœ¼ë¡œ ì¡ì•„ì•¼ í•©ë‹ˆë‹¤.
    // í˜„ì¬ HTML êµ¬ì¡°ìƒ: í™ˆ, ê°€ë§¹ì , (ìŠ¤ìº”ë²„íŠ¼), ì•ˆë‚´, ë‚´ì •ë³´ ìˆœì´ë¯€ë¡œ
    // ì•ˆë‚´ëŠ” querySelectorAll('.tab-item') í–ˆì„ ë•Œ 2ë²ˆì§¸ ì¸ë±ìŠ¤(0,1,2)ê°€ ë§ìŠµë‹ˆë‹¤.
    
    else if (pageId === 'page-mypage') targetIdx = 3;   // ë‚´ì •ë³´

    const tabItems = document.querySelectorAll('.tab-item');
    if (targetIdx !== -1 && tabItems[targetIdx]) {
        tabItems[targetIdx].classList.add('active');
    }
}
function refreshUserData() {
    const saved = localStorage.getItem('gnpay_user');
    if (saved) userData = JSON.parse(saved);
}
function openMypage() {
    document.querySelector('.bottom-nav').style.transform = 'translateY(100%)'; // í•˜ë‹¨ë°” ìˆ¨ê¸°ê¸°
    showPage('page-mypage');
}

// ë§ˆì´í˜ì´ì§€ ë‹«ì„ ë•Œ ë‹¤ì‹œ ë³´ì—¬ì£¼ê¸°
function closeMypage() {
    document.querySelector('.bottom-nav').style.transform = 'translateY(0)'; // í•˜ë‹¨ë°” ë³µêµ¬
    showPage('page-main');
}
// ê°€ì´ë“œ ìŠ¬ë¼ì´ë” ì‹¤ì‹œê°„ ì¹´ë“œ í™œì„±í™” ì—”ì§„
const guideSlider = document.getElementById('guide-slider-scroll');

if (guideSlider) {
    guideSlider.addEventListener('scroll', () => {
        const cards = guideSlider.querySelectorAll('.guide-card');
        const containerRect = guideSlider.getBoundingClientRect();
        // ê¸°ì¤€ì ì„ ì„¸ë¡œ ì¤‘ì•™ìœ¼ë¡œ ë³€ê²½
        const containerCenter = containerRect.top + containerRect.height / 2;

        cards.forEach((card) => {
            const cardRect = card.getBoundingClientRect();
            const cardCenter = cardRect.top + cardRect.height / 2;
            
            const distance = Math.abs(containerCenter - cardCenter);
            
            if (distance < 150) { // ì¤‘ì•™ ê¸°ì¤€ 150px ì´ë‚´ë©´ í™œì„±í™”
                card.classList.add('active-focus');
            } else {
                card.classList.remove('active-focus');
            }
        });
    });
}
// --- ìŠ¤ì™€ì´í”„ í™”ë©´ ì „í™˜ ì—”ì§„ ì‹œì‘ ---
let touchstartX = 0;
let touchendX = 0;
const tabOrder = ['page-main', 'page-history', 'page-guide', 'page-mypage'];

function handleGesture() {
    const swipeThreshold = 70;
    const activePage = document.querySelector('.page.active');
    
    // íŒì—… ì—´ë ¤ìˆìœ¼ë©´ ì¤‘ë‹¨
    if (document.getElementById('qr-focus-layer').style.display === 'flex' || 
        document.getElementById('scanner-modal').style.display === 'block') return;

    let currentIndex = tabOrder.indexOf(activePage?.id);
    if (currentIndex === -1) return;

    // ì™¼ìª½ ìŠ¤ì™€ì´í”„ (ë‹¤ìŒ)
    if (touchstartX - touchendX > swipeThreshold) {
        let nextIndex = (currentIndex + 1) % tabOrder.length;
        executePageTransition(nextIndex);
    }
    // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ (ì´ì „)
    else if (touchendX - touchstartX > swipeThreshold) {
        let nextIndex = (currentIndex - 1 + tabOrder.length) % tabOrder.length;
        executePageTransition(nextIndex);
    }
}

// ë¶€ë“œëŸ¬ìš´ ì „í™˜ ì‹¤í–‰ í•¨ìˆ˜
function executePageTransition(index) {
    const nextPageId = tabOrder[index];
    
    // íƒ­ë°” ì•„ì´ì½˜ ë¶ˆ ì¼œê¸° ì—°ë™
    const tabs = document.querySelectorAll('.tab-item');
    if (tabs[index]) {
        // ë‚´ì—­ íƒ­ì€ ë°ì´í„° ë¡œë”©ì´ í•„ìš”í•˜ë¯€ë¡œ ê¸°ì¡´ í•¨ìˆ˜ í™œìš©
        if (nextPageId === 'page-history') loadActivityHistory();
        else showPage(nextPageId);
        
        // íƒ­ë°” ì•„ì´ì½˜ ë¶ˆ ì¼œê¸°
        updateTab(tabs[index]);
    }
}
function updateHarryCharacter(rank) {
    const badge = document.getElementById('harry-badge');
    const img = document.getElementById('harry-img');
    const walkingImg = document.getElementById('walking-harry'); 
    
    // [ì¶”ê°€] ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì¹´ë“œìš© ìš”ì†Œ
    const mainCardImg = document.getElementById('main-card-char-img');
    const mainCardBadge = document.getElementById('main-card-badge');
    
    if (!img) return;

    const rankData = {
        'GUEST': { img: '3dlog.png', color: 'linear-gradient(145deg, #ffffff, #e6e6e6)', text: 'ë¡œê·¸ì¸ í•„ìš”! ğŸ”’', badgeText: 'GUEST', top: '-20px', left: '5px', walkBottom: '10px', walkWidth: '70px' },
        'ë³´ë§': { img: 'r.png', color: 'linear-gradient(145deg, #ffdee9, #b5fffc)', text: 'ê¹€ë…• ë³´ë§ ğŸš', badgeText: 'ê¹€ë…•ë³´ë§ğŸš', top: '-10px', left: '10px', walkBottom: '-12px', walkWidth: '65px' },
        'ê°ì': { img: 'pote.png', color: 'linear-gradient(145deg, #e1b382, #c89666)', text: 'ê¹€ë…• ê°ì ğŸ¥”', badgeText: 'ê¹€ë…•ê°ìğŸ¥”', top: '-15px', left: '15px', walkBottom: '-9px', walkWidth: '75px' },
        'ë‹¹ê·¼': { img: 'ca.png', color: 'linear-gradient(145deg, #ff9a9e, #fecfef)', text: 'ê¹€ë…• ë‹¹ê·¼ ğŸ¥•', badgeText: 'ê¹€ë…•ë‹¹ê·¼ğŸ¥•', top: '-28px', left: '9px', walkBottom: '-1px', walkWidth: '75px' },
        'ëŒê³ ë˜': { img: 'dol.png', color: 'linear-gradient(145deg, #01b2ad, #00d2ff)', text: 'ê¹€ë…• ëŒê³ ë˜ ğŸ¬', badgeText: 'ê¹€ë…•ëŒê³ ë˜ğŸ¬', top: '-25px', left: '5px', walkBottom: '3px', walkWidth: '90px' },
        'í•´ë…€': { img: 'harry.png', color: 'linear-gradient(145deg, #667eea, #764ba2)', text: 'ì „ì„¤ì˜ í•´ë…€ ğŸ‘‘', badgeText: 'ì „ì„¤ì˜í•´ë…€ğŸ‘‘', top: '-25px', left: '5px', walkBottom: '-4px', walkWidth: '85px' }
    };

    const data = rankData[rank];
    if (data) {
        // 1. ê¸°ì¡´ ìš°ì¸¡ í•˜ë‹¨ ì •ì§€ ìºë¦­í„°
        img.src = `https://gnpay.my/${data.img}`;
        
        // 2. ì‚°ì±…ë¡œ ìºë¦­í„° ì—…ë°ì´íŠ¸
        if (walkingImg) {
            const gifName = data.img.replace('.png', '_walk.gif');
            walkingImg.src = `https://gnpay.my/${gifName}`;
            walkingImg.style.bottom = data.walkBottom;
            walkingImg.style.width = data.walkWidth;
            walkingImg.style.position = 'absolute';
            
            walkingImg.onerror = function() {
                this.src = `https://gnpay.my/${data.img}`;
                this.onerror = null; 
            };
        }

        // 3. ê¸°ì¡´ ë±ƒì§€ ì—…ë°ì´íŠ¸
        if (badge) {
            badge.style.background = data.color;
            badge.style.color = (rank === 'GUEST' || rank === 'ë³´ë§') ? '#333' : '#fff';
            badge.innerText = data.text;
            badge.style.top = data.top;
            badge.style.left = data.left;
        }

        // 4. [ì‹ ê·œ] ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ìºë¦­í„° & ë±ƒì§€ ì—…ë°ì´íŠ¸
        if (mainCardImg) {
            mainCardImg.src = `https://gnpay.my/${data.img}`;
        }
        if (mainCardBadge) {
            mainCardBadge.innerText = data.badgeText; // 'ê¹€ë…• ë³´ë§' ëŒ€ì‹  'ë³´ë§'ë§Œ ê¹”ë”í•˜ê²Œ
            mainCardBadge.style.background = data.color;
            mainCardBadge.style.color = (rank === 'GUEST' || rank === 'ë³´ë§') ? '#333' : '#fff';
        }
    }
}
function getRankByPoints(points) {
    // ë¡œê·¸ì¸ì´ ì•ˆ ë˜ì–´ ìˆê±°ë‚˜ í¬ì¸íŠ¸ê°€ ì—†ìœ¼ë©´ ê²ŒìŠ¤íŠ¸
    if (!userData.isLoggedIn || points === undefined || points === null) return 'GUEST'; 
    
    const p = Number(points);
    if (p >= 10000) return 'í•´ë…€';
    if (p >= 5000)  return 'ëŒê³ ë˜';
    if (p >= 3000)  return 'ë‹¹ê·¼';
    if (p >= 1000)  return 'ê°ì';
    return 'ë³´ë§'; // 0~999 í¬ì¸íŠ¸
}
function openRankInfo() {
    // 1. ë¡œê·¸ì¸ ì²´í¬: ì•Œë¦¼ì°½ ì—†ì´ ë°”ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ìŠ!
    if (!userData || !userData.isLoggedIn) {
        showPage('page-login');
        return; 
    }

    const layer = document.getElementById('rank-info-layer');
    if (!layer) return;

    // 2. ë°ì´í„° ì¤€ë¹„
    const points = Number(userData.points || 0);
    const currentRankKey = getRankByPoints(points); 
    const name = userData.name || "ì‚¬ìš©ì";
    
    const ranks = [
        { id: 'ë³´ë§', name: 'ê¹€ë…• ë³´ë§ ğŸš', pt: 0, img: 'r.png', desc: 'ì‘ê³  ì†Œì¤‘í•œ ê¹€ë…•ì˜ ì‹œì‘' },
        { id: 'ê°ì', name: 'ê¹€ë…• ê°ì ğŸ¥”', pt: 1000, img: 'pote.png', desc: 'í¬ìŠ¬í¬ìŠ¬ ì˜ ìµì€ ì‹¤ì²œì˜ ë§›' },
        { id: 'ë‹¹ê·¼', name: 'ê¹€ë…• ë‹¹ê·¼ ğŸ¥•', pt: 3000, img: 'ca.png', desc: 'ë•… ì† ê¹Šì´ ë¿Œë¦¬ë‚´ë¦° ì§„ì‹¬' },
        { id: 'ëŒê³ ë˜', name: 'ê¹€ë…• ëŒê³ ë˜ ğŸ¬', pt: 5000, img: 'dol.png', desc: 'ë°”ë‹¤ë¥¼ ììœ ë¡­ê²Œ ëˆ„ë¹„ëŠ” ìˆ˜í˜¸ì' },
        { id: 'í•´ë…€', name: 'ì „ì„¤ì˜ í•´ë…€ ğŸ‘‘', pt: 10000, img: 'harry.png', desc: 'ë°”ë‹¤ì™€ í•˜ë‚˜ê°€ ëœ ì‚´ì•„ìˆëŠ” ì „ì„¤' }
    ];

    // 3. ì‚¬ìš©ì ì •ë³´ ë° ìºë¦­í„° ì„¸íŒ… (ìŠ¤íƒ€ì¼ í¬í•¨)
    const nameEl = document.querySelector('#rank-info-layer #pop-user-name');
    if (nameEl) nameEl.innerText = name;
    
    const rankImgDisplay = document.querySelector('#rank-info-layer #pop-rank-img');
    if (rankImgDisplay) {
        rankImgDisplay.src = document.getElementById('harry-img').src;
        rankImgDisplay.style.width = '100px'; 
        rankImgDisplay.style.height = '100px';
        rankImgDisplay.style.objectFit = 'contain';
        rankImgDisplay.style.filter = 'drop-shadow(0 10px 15px rgba(0,0,0,0.15))';
        
        const parentBox = rankImgDisplay.parentElement;
        if (parentBox) {
            parentBox.style.background = 'none';
            parentBox.style.boxShadow = 'none';
            parentBox.style.padding = '0';
        }
    }

    // 4. ë±ƒì§€ ìƒ‰ìƒ ë§¤í•‘
    const rankDataMap = {
        'GUEST':  { text: 'GIMNYEONG PAY', color: 'linear-gradient(145deg, #ffffff, #e6e6e6)', textColor: '#333' },
        'ë³´ë§':   { text: 'ê¹€ë…• ë³´ë§ ğŸš', color: 'linear-gradient(145deg, #ffdee9, #b5fffc)', textColor: '#333' },
        'ê°ì':   { text: 'ê¹€ë…• ê°ì ğŸ¥”', color: 'linear-gradient(145deg, #e1b382, #c89666)', textColor: '#fff' },
        'ë‹¹ê·¼':   { text: 'ê¹€ë…• ë‹¹ê·¼ ğŸ¥•', color: 'linear-gradient(145deg, #ff9a9e, #fecfef)', textColor: '#fff' },
        'ëŒê³ ë˜': { text: 'ê¹€ë…• ëŒê³ ë˜ ğŸ¬', color: 'linear-gradient(145deg, #01b2ad, #00d2ff)', textColor: '#fff' },
        'í•´ë…€':   { text: 'ì „ì„¤ì˜ í•´ë…€ ğŸ‘‘', color: 'linear-gradient(145deg, #667eea, #764ba2)', textColor: '#fff' }
    };

    const badge = document.querySelector('#rank-info-layer #pop-rank-badge');
    if (badge) {
        const data = rankDataMap[currentRankKey] || rankDataMap['GUEST'];
        badge.innerText = data.text;
        badge.style.background = data.color;
        badge.style.color = data.textColor;
        badge.style.display = 'inline-block';
        badge.style.padding = '4px 14px';
        badge.style.borderRadius = '15px';
        badge.style.fontSize = '0.75rem';
        badge.style.fontWeight = '900';
    }

    // 5. ê²Œì´ì§€ ë°” ë° ë‹¤ìŒ ë“±ê¸‰ í…ìŠ¤íŠ¸ ë Œë”ë§
    const gaugeBar = document.querySelector('#rank-info-layer #pop-gauge-bar');
    const gaugePercent = document.querySelector('#rank-info-layer #pop-gauge-percent');
    const nextInfoArea = document.querySelector('#rank-info-layer #pop-next-info');

    const nextRank = ranks.find(r => r.pt > points);
    const currentRankData = [...ranks].reverse().find(r => r.pt <= points);

    if (nextRank) {
        const range = nextRank.pt - currentRankData.pt;
        const progress = points - currentRankData.pt;
        const percent = Math.min(Math.floor((progress / range) * 100), 100);
        
        if (gaugeBar) {
            gaugeBar.style.width = '0%';
            setTimeout(() => { gaugeBar.style.width = percent + "%"; }, 50);
        }
        if (gaugePercent) gaugePercent.innerText = percent + "%";

        const nextData = rankDataMap[nextRank.id] || rankDataMap['GUEST'];

        if (nextInfoArea) {
            nextInfoArea.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 15px;">
                    <div style="text-align: left;">
                        <div style="color: #aaa; font-size: 0.65rem; font-weight: 800; letter-spacing: 0.5px; margin-bottom: 5px;">ë‹¤ìŒ ë“±ê¸‰</div>
                        <div style="display: inline-block; background: ${nextData.color}; color: ${nextData.textColor}; padding: 4px 14px; border-radius: 12px; font-size: 0.85rem; font-weight: 900; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                            ${nextRank.name}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #aaa; font-size: 0.65rem; font-weight: 800; letter-spacing: 0.5px; margin-bottom: 5px;">ë‚¨ì€ í¬ì¸íŠ¸</div>
                        <div style="color: var(--primary); font-size: 1.2rem; font-weight: 900; line-height: 1;">
                            ${(nextRank.pt - points).toLocaleString()}<span style="font-size: 0.8rem; margin-left: 2px;">P</span>
                        </div>
                    </div>
                </div>
            `;
        }
    } else {
        if (gaugeBar) gaugeBar.style.width = "100%";
        if (gaugePercent) gaugePercent.innerText = "100%";
        if (nextInfoArea) {
            nextInfoArea.innerHTML = `<div style="margin-top: 15px; background: #1a1a1a; padding: 12px; border-radius: 18px; text-align: center; animation: pulse 1.5s infinite;"><span style="color: #FFD700; font-size: 1.1rem; font-weight: 900;">ğŸ†í˜„ì¬ ìµœê³  ë“±ê¸‰ ë‹¬ì„±</span></div>`;
        }
    }

    // 6. ë„ê° ë¦¬ìŠ¤íŠ¸ ìƒì„±
    let tableHtml = "";
    ranks.forEach(r => {
        const isCurrent = currentRankKey.includes(r.id);
        const isLocked = points < r.pt;
        tableHtml += `
            <div class="d-flex align-items-center gap-3 p-3 mb-2" style="border-radius:20px; background: ${isCurrent ? '#e6f7f6' : '#f8f9fa'}; border: 2px solid ${isCurrent ? 'var(--primary)' : 'transparent'}; opacity: ${isLocked ? '0.6' : '1'}">
                <img src="https://gnpay.my/${r.img}" style="width: 40px; height: 40px; object-fit: contain; filter: ${isLocked ? 'grayscale(100%)' : 'none'}">
                <div style="flex:1;">
                    <div class="fw-900" style="font-size:0.85rem; color:${isCurrent ? 'var(--primary)' : '#333'}">${r.name}</div>
                    <div class="text-muted" style="font-size:0.65rem;">${r.desc}</div>
                </div>
                <div class="text-end fw-bold" style="font-size:0.7rem; color:#888;">
                    ${r.pt === 0 ? 'ê¸°ë³¸' : r.pt.toLocaleString() + 'P'}
                </div>
            </div>`;
    });
    
    const listEl = document.getElementById('rank-table-list');
    if (listEl) listEl.innerHTML = tableHtml;

    // 7. ë ˆì´ì–´ í‘œì‹œ
    layer.style.display = 'flex';
}
document.addEventListener('touchstart', e => {
    touchstartX = e.changedTouches[0].screenX;
}, {passive: true});

document.addEventListener('touchend', e => {
    touchendX = e.changedTouches[0].screenX;
    handleGesture();
}, {passive: true});
// 1. íƒ­ ì „í™˜ (í™œë™ ê¸°ë¡ ë°©ì‹ ê³„ìŠ¹)
function switchRankTab(type) {
    // ğŸŒŸ [í•µì‹¬ ë³´ì™„] í˜„ì¬ ëª¨ë“œë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
    // ì´ í•œ ì¤„ì´ ìˆì–´ì•¼ 5ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ ë  ë•Œë„ ì´ ëª¨ë“œë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
    currentRankMode = type; 

    const todayTab = document.getElementById('tab-rank-today');
    const totalTab = document.getElementById('tab-rank-total');

    if (type === 'today') {
        todayTab.className = 'flex-fill text-center py-2 active-tab';
        totalTab.className = 'flex-fill text-center py-2 inactive-tab';
        loadRankingData('today');
    } else {
        todayTab.className = 'flex-fill text-center py-2 inactive-tab';
        totalTab.className = 'flex-fill text-center py-2 active-tab';
        loadRankingData('total');
    }
}

// 2. ë­í‚¹ ë°ì´í„° ë¡œë“œ (ì„œë²„ ì—°ë™ìš© í”„ë ˆì„)
async function loadRankingData(mode) {
    const listContainer = document.getElementById('ranking-list');
    const rankingPage = document.getElementById('page-ranking');

    try {
        const res = await fetch(GAS_URL, {
            method: 'POST',
            body: JSON.stringify({ type: 'getRanking', mode: mode })
        }).then(r => r.json());

        if (res.result === 'success' && res.data) {
            // 1. í˜„ì¬ í™”ë©´ ë Œë”ë§ìš© ë°ì´í„° ì €ì¥
            window.lastRankingData = res.data; 

            // ğŸŒŸ [ì¶”ê°€] ë©”ì¸ ì¹´ë“œë¥¼ ìœ„í•œ ì „ìš© ì°½ê³ ì— 'ì „ì²´ ë°ì´í„°' ë”°ë¡œ ì €ì¥
            // ì´ ì¤„ì´ ìˆì–´ì•¼ ë­í‚¹ íƒ­ì—ì„œ 'ì˜¤ëŠ˜'ì„ ë´ë„ ë©”ì¸ ìˆœìœ„ê°€ ì•ˆ ê¹¨ì§‘ë‹ˆë‹¤.
            if (mode === 'total') {
                totalRankingData = res.data;
            }

            // 2. ë­í‚¹ í˜ì´ì§€ê°€ í™œì„± ìƒíƒœì¼ ë•Œë§Œ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¼ (ê¹œë¹¡ì„ ë°©ì§€)
            if (rankingPage && rankingPage.classList.contains('active')) {
                renderRanking(res.data);
            }
            
            // 3. ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë° ì „ì²´ UI ê°±ì‹ 
            updateUI(); 
        }
    } catch (e) { 
        console.log("Ranking ë¡œë”© ìŠ¤í‚µ"); 
    }
}
// 3. ë­í‚¹ ë Œë”ë§ (ë””ìì¸ í•µì‹¬)
function renderRanking(data) {
    const listContainer = document.getElementById('ranking-list');
    const barContainer = document.getElementById('my-rank-bar-container');
    const rankDataMap = { 'ë³´ë§': 'ğŸš', 'ê°ì': 'ğŸ¥”', 'ë‹¹ê·¼': 'ğŸ¥•', 'ëŒê³ ë˜': 'ğŸ¬', 'í•´ë…€': 'ğŸ‘‘' };

    if (!listContainer) return;

    // 1. ì „ì²´ ë¦¬ìŠ¤íŠ¸ HTML ë¹Œë“œ
    let html = '';
    data.forEach((user, idx) => {
        const isTop3 = idx < 3;
        const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : (idx + 1);
        const isMe = userData && userData.isLoggedIn && user.name === userData.name;

        html += `
            <div class="dashboard-card mb-3" style="padding:15px 20px; border-left: 5px solid ${isTop3 ? 'var(--primary)' : '#eee'}; background: ${isMe ? '#f0fbfb' : 'white'};">
                <div class="d-flex align-items-center gap-3 w-100">
                    <div class="fw-900" style="font-size: 1.1rem; min-width: 30px; color: ${isTop3 ? 'var(--primary)' : '#888'};">${medal}</div>
                    <div style="flex:1;">
                        <div class="fw-bold" style="font-size:1rem; color:#333;">${user.name} ${isMe ? '<span class="text-primary" style="font-size:0.7rem;">(ë‚˜)</span>' : ''}</div>
                        <div class="small text-muted" style="font-size:0.7rem;">${rankDataMap[user.rank] || 'ğŸš'} ${user.rank} ë“±ê¸‰</div>
                    </div>
                    <div class="text-end">
                        <div class="fw-900" style="color:var(--primary); font-size:1.1rem;">
                            ${user.points.toLocaleString()}<span style="font-size:0.75rem; margin-left:2px;">P</span>
                        </div>
                    </div>
                </div>
            </div>`;
    });
    listContainer.innerHTML = html;

    // 2. ë‚´ ìˆœìœ„ ë°” ë¹Œë“œ (ë¦¬ìŠ¤íŠ¸ì™€ ë³„ê°œë¡œ ì²˜ë¦¬)
    if (userData && userData.isLoggedIn && barContainer) {
        const myIdx = data.findIndex(u => u.name === userData.name);
        const myInfo = myIdx !== -1 ? data[myIdx] : { name: userData.name, points: userData.points, rank: getRankByPoints(userData.points) };
        const myRankNum = myIdx !== -1 ? (myIdx + 1) + "ìœ„" : "ìˆœìœ„ ì™¸";

        barContainer.innerHTML = `
            <div class="my-rank-fixed-bar">
                <div class="d-flex align-items-center gap-3">
                    <div style="font-size: 1.3rem; font-weight: 900;">${myRankNum}</div>
                    <div>
                        <div class="fw-bold" style="font-size:0.95rem;">${myInfo.name}</div>
                        <div style="font-size:0.7rem; background:rgba(255,255,255,0.2); padding:2px 6px; border-radius:6px; display:inline-block;">
                            ${rankDataMap[myInfo.rank] || 'ğŸš'} ${myInfo.rank}
                        </div>
                    </div>
                </div>
                <div class="text-end">
                    <div class="fw-900" style="font-size:1.3rem;">${Number(myInfo.points).toLocaleString()}P</div>
                    <div style="font-size:0.6rem; opacity:0.8; font-weight:800;">MY RANKING</div>
                </div>
            </div>`;
            
        // [ğŸ”¥ ì¶”ê°€] ë©”ì¸ ëŒ€ì‹œë³´ë“œ ì¹´ë“œì— ìˆœìœ„ ì—°ë™ì„ ìœ„í•´ ë°ì´í„°ë¥¼ ì „ì—­ ì €ì¥í•˜ê³  UIë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
        window.lastRankingData = data; 
        updateUI(); 
    }
}
// ì•±ì´ ì¼œì§ˆ ë•Œ ëª¨ë“  ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë•¡ê²¨ì˜¤ëŠ” 'í”„ë¦¬ë¡œë”©' ì—”ì§„
// [í˜•ë‹˜ ì „ìš©] ì•± ì‹œì‘ ì‹œ ëª¨ë“  ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë”©í•˜ê³  ë©”ì¸ìœ¼ë¡œ ê°•ì œ ê³ ì •í•˜ëŠ” ì—”ì§„
// [í˜•ë‹˜ ì „ìš©] ì•± ì‹œì‘ ì‹œ ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¡œë”©í•˜ê³  ë©”ì¸ìœ¼ë¡œ ê°•ì œ ê³ ì •í•˜ëŠ” ìµœì¢… ì—”ì§„
window.addEventListener('load', async function() {
    const userAgent = navigator.userAgent.toLowerCase();
    const isStandalone = window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;

    // 1. [ì² ë²½ ë°©ì–´] ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì €ë©´ ì…ì¥ ë¶ˆê°€
    if (userAgent.includes('kakaotalk')) {
        const isIOS = /iphone|ipad|ipod/.test(userAgent);
        const btnLocation = isIOS ? "ìš°ì¸¡ í•˜ë‹¨" : "ìš°ì¸¡ ìƒë‹¨";
        const btnIcon = isIOS ? '<b>â‹</b> ë˜ëŠ” <b>Â·Â·Â·</b>' : '<b>â‹®</b>';

        const kakaoBlocker = document.createElement('div');
        kakaoBlocker.id = 'kakao-strict-blocker';
        kakaoBlocker.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:#e6f7f6; z-index:2147483647; display:flex; align-items:center; justify-content:center; padding:30px; text-align:center;';
        kakaoBlocker.innerHTML = `
            <div style="animation: luxurySlideUp 0.5s ease-out;">
                <img src="https://gnpay.my/log2.png" style="width: 100px; margin-bottom: 30px;">
                <h2 style="font-weight:900; color:#1a1a1a; font-size:1.4rem; margin-bottom:20px;">ì™¸ë¶€ ë¸Œë¼ìš°ì €ë¡œ ì—°ê²°í•©ë‹ˆë‹¤</h2>
                <div style="background:white; padding:25px; border-radius:25px; border:1px solid #eee; margin-bottom:30px;">
                    <p style="font-size:1rem; line-height:1.7; color:#444;">
                        ${btnLocation} ${btnIcon} ë²„íŠ¼ì„ ëˆ„ë¥´ê³ <br>
                        <span style="background:#ffcc00; color:#000; padding:2px 10px; border-radius:8px; font-weight:800;">ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°</span><br>
                        ë¥¼ ì„ íƒí•˜ì—¬ ë‹¤ì‹œ ì ‘ì†í•´ì£¼ì„¸ìš”!
                    </p>
                </div>
            </div>`;
        document.body.appendChild(kakaoBlocker);
        document.body.style.overflow = 'hidden';
        return; // ì¹´í†¡ì´ë©´ ì—¬ê¸°ì„œ ë! ì•„ë˜ ë¡œë”©ì€ í•˜ì§€ë„ ì•ŠìŒ
    }

    // 2. [ê°€ë‘ë¦¬ ì–‘ì‹] ì›¹ ë¸Œë¼ìš°ì € ìƒíƒœ(ì‚¬íŒŒë¦¬/í¬ë¡¬)ë©´ ë©”ì¸í™”ë©´ ê°€ë ¤ë²„ë¦¼
    // ğŸŒŸ ì‚¬ì¥ë‹˜, ë§Œì•½ ìœ ì €ê°€ ì•± ì„¤ì¹˜í•˜ê¸° ì‹«ì–´í• ê¹Œ ë´ ê±±ì •ë˜ë©´ 
    // ì•„ë˜ if(!isStandalone) ë¸”ë¡ì„ ì£¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ ë‚˜ì¤‘ì— ì¡°ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
    if (!isStandalone && window.innerWidth <= 768) {
        showStrictInstallBlocker(); 
        // ì•±ì´ ì•„ë‹ ë•ŒëŠ” ë¡œë”©ë°”(ìŠ¤í”Œë˜ì‹œ) ë’¤ì—ì„œë§Œ ëŒê²Œ í•˜ê³  ê°€ë¦¼ë§‰ ìœ ì§€
    }

    // 3. ìŠ¤í”Œë˜ì‹œ ì¢…ë£Œ ë° ë°ì´í„° ë¡œë”© ì—”ì§„
    const finishSplash = () => {
        const splashEl = document.getElementById('splash-screen');
        if (!splashEl) return;

        document.querySelectorAll('.page').forEach(p => {
            p.classList.remove('active');
            p.style.display = 'none';
            p.style.opacity = '0';
        });

        const mainPage = document.getElementById('page-main');
        if (mainPage) {
            mainPage.style.display = 'block';
            mainPage.style.opacity = '1';
            mainPage.classList.add('active');
        }

        if (typeof syncTabBar === 'function') syncTabBar('page-main');
        
        splashEl.classList.add('splash-fade-out');
        setTimeout(() => {
            if (splashEl.parentNode) splashEl.remove();
            if (typeof updateUI === 'function') updateUI();
        }, 400);
    };

    const minSplashTime = new Promise(resolve => setTimeout(resolve, 800));
    const forceExitTimeout = setTimeout(finishSplash, 4000);

    const metaTheme = document.querySelector('meta[name="theme-color"]');
    if (metaTheme) metaTheme.setAttribute('content', '#e6f7f6');

    try {
        const safeLoad = async (fn, ...args) => {
            if (typeof fn === 'function') {
                try { await fn(...args); } catch(e) { console.log("ë¡œë”© íŒ¨ìŠ¤"); }
            }
        };

        const tasks = [ safeLoad(loadRankingData, 'total') ];
        if (userData && userData.isLoggedIn) {
            tasks.push(safeLoad(loadActivityHistory));
            tasks.push(safeLoad(syncPointsRealtime));
        }

        await Promise.all(tasks);
    } catch (e) {
        console.log("ì´ˆê¸° ë¡œë”© ì—ëŸ¬:", e);
    } finally {
        await minSplashTime;
        clearTimeout(forceExitTimeout);
        finishSplash(); // ğŸŒŸ ëª¨ë“  ë°ì´í„° ë¡œë”© ë!
    }
});

// [ë³„ë„ ì •ì˜] ë‹«ê¸° ë²„íŠ¼ ì—†ëŠ” ì›¹ë¸Œë¼ìš°ì € ê°€ë‘ë¦¬ ì°¨ë‹¨ë§‰
function showStrictInstallBlocker() {
    const isIOS = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    const blocker = document.createElement('div');
    blocker.id = 'web-strict-blocker';
    blocker.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:#ffffff; z-index:9999999; display:flex; align-items:center; justify-content:center; padding:30px; text-align:center;';

    if (isIOS) {
        // ğŸ [ì•„ì´í° ì „ìš© ë””ìì¸]
        blocker.innerHTML = `
            <div style="width:100%; max-width:320px;">
                <img src="https://gnpay.my/log2.png" style="width:80px; margin-bottom:30px;">
                <h2 style="font-weight:900; color:#01b2ad;">iOS ì „ìš© ì•± ì•ˆë‚´</h2>
                <p style="font-size:0.95rem; color:#666;">ì•„ì´í°ì€ ë¸Œë¼ìš°ì € ë©”ë‰´ë¥¼ í†µí•´<br>ì§ì ‘ í™ˆ í™”ë©´ì— ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.</p>
                
                <div style="background:#f0fbfb; padding:25px 20px; border-radius:25px; border:1px solid #01b2ad; margin-bottom:30px; text-align:left;">
    <div style="display:flex; align-items:flex-start; margin-bottom:12px;">
        <span style="background:#01b2ad; color:#fff; width:22px; height:22px; border-radius:5px; text-align:center; line-height:22px; font-size:0.8rem; font-weight:800; margin-right:10px; flex-shrink:0;">1</span>
        <p style="margin:0; font-size:1.05rem; font-weight:700; color:#333; line-height:1.4;">
            <span style="color:#01b2ad;">ì£¼ì†Œì°½ ìš°ì¸¡</span> <span style="background:#fff; border:1px solid #ddd; padding:1px 6px; border-radius:6px; font-weight:normal; margin:0 3px;">Â·Â·Â·</span> ë²„íŠ¼ í´ë¦­!
        </p>
    </div>

    <div style="display:flex; align-items:flex-start; margin-bottom:12px;">
        <span style="background:#01b2ad; color:#fff; width:22px; height:22px; border-radius:5px; text-align:center; line-height:22px; font-size:0.8rem; font-weight:800; margin-right:10px; flex-shrink:0;">2</span>
        <p style="margin:0; font-size:1.05rem; font-weight:700; color:#333; line-height:1.4;">
            ìƒë‹¨ ë©”ë‰´ì—ì„œ <span style="color:#01b2ad;">ê³µìœ  ë²„íŠ¼</span> í´ë¦­
        </p>
    </div>

    <div style="display:flex; align-items:flex-start; margin-bottom:12px;">
        <span style="background:#01b2ad; color:#fff; width:22px; height:22px; border-radius:5px; text-align:center; line-height:22px; font-size:0.8rem; font-weight:800; margin-right:10px; flex-shrink:0;">3</span>
        <p style="margin:0; font-size:1.05rem; font-weight:700; color:#333; line-height:1.4;">
            ìš°ì¸¡ í•˜ë‹¨ <span style="background:#fff; border:1px solid #ddd; padding:1px 6px; border-radius:6px; font-weight:normal; margin:0 3px;">Â·Â·Â·</span> <span style="color:#555;">ë”ë³´ê¸° í´ë¦­</span>
        </p>
    </div>

    <div style="display:flex; align-items:flex-start;">
        <span style="background:#01b2ad; color:#fff; width:22px; height:22px; border-radius:5px; text-align:center; line-height:22px; font-size:0.8rem; font-weight:800; margin-right:10px; flex-shrink:0;">4</span>
        <p style="margin:0; font-size:1.05rem; font-weight:700; color:#333; line-height:1.4;">
            <span style="background:#01b2ad; color:#fff; padding:3px 10px; border-radius:8px; display:inline-flex; align-items:center;">
                <span style="font-size:0.9rem; margin-right:4px;">â•</span>í™ˆ í™”ë©´ì— ì¶”ê°€
            </span> í´ë¦­!
        </p>
    </div>
</div>
                <p style="font-size:0.8rem; color:#999;">* ì‚¬íŒŒë¦¬(Safari) ë¸Œë¼ìš°ì € ì´ìš© ê¶Œì¥</p>
            </div>`;
    } else {
        // ğŸ¤– [ì•ˆë“œë¡œì´ë“œ ì „ìš© ë””ìì¸]
        blocker.innerHTML = `
            <div style="width:100%; max-width:320px;">
                <img src="https://gnpay.my/log2.png" style="width:80px; margin-bottom:30px;">
                <h2 style="font-weight:900;">ê¹€ë…•í˜ì´ ì•± ì„¤ì¹˜</h2>
                <p style="color:#666;">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ì„ ì„¤ì¹˜í•˜ì„¸ìš”.</p>
                
                <button onclick="installApp()" style="width:100%; background:#01b2ad; color:white; border:none; padding:18px; border-radius:50px; font-weight:800; font-size:1.1rem; margin: 20px 0; box-shadow:0 10px 20px rgba(1, 178, 173, 0.2);">
                    ì•± ì„¤ì¹˜í•˜ê¸° ğŸ“²
                </button>

                <div style="background:#f8f9fa; padding:15px; border-radius:20px; font-size:0.85rem; color:#888;">
                    ë²„íŠ¼ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´?<br>
                    ìš°ì¸¡ ìƒë‹¨ <b>â‹®</b> ë˜ëŠ” <b>Â·Â·Â·</b> í´ë¦­ í›„<br><b>'ì•± ì„¤ì¹˜'</b> ë˜ëŠ” <b>'í™ˆ í™”ë©´ì— ì¶”ê°€'</b>
                </div>
            </div>`;
    }

    document.body.appendChild(blocker);
    document.body.style.overflow = 'hidden';
}

/* --- [ìˆ˜ë¦¬] ì ‘ì†í•˜ìë§ˆì ëœ¨ëŠ” ìë™ íŒì—… ì—”ì§„ --- */
function showAutoInstallPopup() {
    // 1. PC ì ‘ì†ì´ë©´ ì¼ë‹¨ í—ˆìš© (ëª¨ë°”ì¼ ê°€ë‘ë¦¬ê°€ ëª©ì ì´ë¯€ë¡œ)
    if (window.innerWidth > 768) return; 

    // 2. í™ˆ í™”ë©´ì— ì¶”ê°€ëœ 'ì•±' ìƒíƒœì¸ì§€ í™•ì¸
    const isStandalone = window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
    
    // ğŸŒŸ ì•±ìœ¼ë¡œ ë“¤ì–´ì™”ë‹¤ë©´ ì°¨ë‹¨ë§‰ ì—†ì´ í†µê³¼!
    if (isStandalone) return;

    // 3. ì¼ë°˜ ë¸Œë¼ìš°ì €(Safari, Chrome ë“±) ì ‘ì† ì‹œ ì°¨ë‹¨ë§‰ ìƒì„±
    const userAgent = navigator.userAgent.toLowerCase();
    const isIOS = /iphone|ipad|ipod/.test(userAgent);
    
    // ì•„ì´í° ì‚¬íŒŒë¦¬ëŠ” 'ê³µìœ ' ì•„ì´ì½˜, ì•ˆë“œë¡œì´ë“œëŠ” 'ì  ì„¸ê°œ' ì•„ì´ì½˜
    const icon = isIOS ? 'ğŸ“¤' : 'â‹®';
    const location = isIOS ? 'í•˜ë‹¨ ì¤‘ì•™' : 'ìš°ì¸¡ ìƒë‹¨';
    
    const blocker = document.createElement('div');
    blocker.id = 'app-only-blocker';
    // ğŸŒŸ z-indexë¥¼ ìµœëŒ€ë¡œ ë†’ì´ê³  'ë‹«ê¸°' ë²„íŠ¼ì„ ì•„ì˜ˆ ë§Œë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤.
    blocker.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:#ffffff; z-index:2147483647; display:flex; align-items:center; justify-content:center; padding:30px; text-align:center;';
    
    blocker.innerHTML = `
        <div style="animation: luxurySlideUp 0.5s ease-out; width:100%; max-width:320px;">
            <img src="https://gnpay.my/log2.png" style="width:80px; margin-bottom:30px;">
            <h2 style="font-weight:900; color:#1a1a1a; letter-spacing:-1.2px; margin-bottom:20px; line-height:1.4; font-size:1.4rem;">
                ê¹€ë…•í˜ì´ ì•± ì„¤ì¹˜ê°€<br>í•„ìš”í•©ë‹ˆë‹¤
            </h2>
            <p style="font-size:0.95rem; color:#666; line-height:1.7; margin-bottom:30px; word-break:keep-all;">
                í¬ì¸íŠ¸ ë³´ì•ˆê³¼ ì¾Œì í•œ ì´ìš©ì„ ìœ„í•´<br><b>ì „ìš© ì•± í™˜ê²½</b>ì—ì„œë§Œ ì„œë¹„ìŠ¤ê°€ ì œê³µë©ë‹ˆë‹¤.
            </p>
            
            <div style="background:#f8f9fa; padding:25px 20px; border-radius:24px; border:1px solid #eee; margin-bottom:30px;">
                <p style="margin:0; font-size:1rem; font-weight:700; color:#444; line-height:1.8;">
                    ${location} <span style="background:#fff; padding:2px 8px; border-radius:8px; border:1px solid #ddd;">${icon}</span> ë²„íŠ¼ í´ë¦­!<br>
                    <span style="color:#01b2ad; font-size:1.1rem; font-weight:900;">'í™ˆ í™”ë©´ì— ì¶”ê°€' â•</span>
                </p>
            </div>
            
            <p style="color:#adb5bd; font-size:0.8rem; font-weight:600;">
                í•œ ë²ˆë§Œ ì¶”ê°€í•˜ë©´ ë‹¤ìŒë¶€í„°ëŠ”<br>ì•±ì²˜ëŸ¼ ë°”ë¡œ ì ‘ì†ë©ë‹ˆë‹¤.
            </p>
        </div>
    `;
    
    document.body.appendChild(blocker);
    document.body.style.overflow = 'hidden'; // ğŸŒŸ ë’·í™”ë©´ ìŠ¤í¬ë¡¤ ì™„ì „ ë°©ì§€
}

// íŒì—… ë‹«ê¸° ë° 'ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸°' ì €ì¥
function closeInstallPopup(hideToday = false) {
    if (hideToday) {
        localStorage.setItem('gnpay_install_popup_hide', new Date().toDateString());
    }
    const popup = document.getElementById('auto-install-popup');
    if (popup) popup.remove();
}

/* --- [PWA ì•± ì„¤ì¹˜ ì œì–´ ì—”ì§„] --- */
/* --- [ìˆ˜ì • ì™„ë£Œ] ì•ˆë“œë¡œì´ë“œ ì§„ì§œ ì„¤ì¹˜ + ì•„ì´í° ì•ˆë‚´ í†µí•© ì—”ì§„ --- */
let deferredPrompt; // ğŸŒŸ ë°˜ë“œì‹œ ìŠ¤í¬ë¦½íŠ¸ ìµœìƒë‹¨ì— ì„ ì–¸!

// 1. ì•ˆë“œë¡œì´ë“œ ì„¤ì¹˜ ì‹ í˜¸ ëŒ€ê¸° (ë¸Œë¼ìš°ì €ê°€ ì„¤ì¹˜ ê°€ëŠ¥í•˜ë‹¤ê³  íŒë‹¨í•˜ë©´ ë°œìƒ)
window.addEventListener('beforeinstallprompt', (e) => {
    // ë¸Œë¼ìš°ì €ê°€ ë©‹ëŒ€ë¡œ í•˜ë‹¨ íŒì—… ë„ìš°ëŠ” ê±¸ ë§‰ê³  ì‚¬ì¥ë‹˜ ë²„íŠ¼ìœ¼ë¡œ ì œì–´í•©ë‹ˆë‹¤.
    e.preventDefault(); 
    deferredPrompt = e; 
    console.log("ì•ˆë“œë¡œì´ë“œ ì„¤ì¹˜ ì‹ í˜¸ê°€ ì£¼ë¨¸ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤.");
    
    // [ì„ íƒ] ì‹ í˜¸ê°€ ì˜¤ë©´ ë©”ì¸í™”ë©´ì˜ 'ì„¤ì¹˜ ë²„íŠ¼'ì„ ìŠ¬ì© ë³´ì—¬ì¤ë‹ˆë‹¤.
    const installBtn = document.getElementById('main-install-btn');
    if (installBtn) installBtn.style.display = 'block';
});

// 2. í†µí•© ì„¤ì¹˜ ì‹¤í–‰ í•¨ìˆ˜
async function installApp() {
    console.log("ì„¤ì¹˜ ë²„íŠ¼ í´ë¦­ë¨");

    // [ì¤‘ìš”] ê¸°ì¡´ ê°€ë‘ë¦¬/íŒì—… UI ì œê±°
    const autoPopup = document.getElementById('auto-install-popup');
    const strictBlocker = document.getElementById('web-strict-blocker');
    if (autoPopup) autoPopup.remove();

    if (deferredPrompt) {
        // [ì•ˆë“œë¡œì´ë“œ] ë³´ê´€í•´ë‘” ì‹œìŠ¤í…œ íŒì—…ì„ ê°•ì œë¡œ í˜¸ì¶œ!
        deferredPrompt.prompt(); 
        
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`ì‚¬ìš©ì ì„¤ì¹˜ ì„ íƒ: ${outcome}`);

        if (outcome === 'accepted') {
            // ì„¤ì¹˜ ìˆ˜ë½ ì‹œ ê°€ë¦¼ë§‰ ì™„ì „íˆ ì œê±°
            if (strictBlocker) {
                strictBlocker.remove();
                document.body.style.overflow = 'auto';
            }
        }
        
        // ì‚¬ìš©í•œ ì‹ í˜¸ëŠ” ë¹„ì›Œì¤ë‹ˆë‹¤. (ì¤‘ìš”: í•œ ë²ˆë§Œ ì‚¬ìš© ê°€ëŠ¥)
        deferredPrompt = null; 
    } else {
        // [ì•„ì´í°] ë˜ëŠ” ì‹ í˜¸ê°€ ì•„ì§ ì•ˆ ì™”ì„ ë•Œ
        const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
        if (isIOS) {
            showIOSInstallGuide(); // ì‚¬ì¥ë‹˜ì´ ë§Œë“  4ë‹¨ê³„ ê°€ì´ë“œ í˜¸ì¶œ
        } else {
            // ì•ˆë“œë¡œì´ë“œì¸ë° ì‹ í˜¸ê°€ ì—†ëŠ” ê²½ìš° (ë¸”ë£¨ìŠ¤íƒ ë“± ê°€ìƒí™˜ê²½ ì´ìŠˆ)
            alert("ë°”íƒ•í™”ë©´ ë©”ë‰´ì˜ [í™ˆ í™”ë©´ì— ì¶”ê°€]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”! ğŸ˜Š");
        }
    }
}
// 3. [ì•„ì´í° ì „ìš©] í™ˆ í™”ë©´ ì¶”ê°€ ìƒì„¸ ê°€ì´ë“œ (ì‚¬ì¥ë‹˜ ìš”ì²­ ì•„ì´ì½˜ ë°˜ì˜)
function showIOSInstallGuide() {
    const guideId = 'ios-install-guide';
    if (document.getElementById(guideId)) return;

    const guide = document.createElement('div');
    guide.id = guideId;
    // ì‚¬ì¥ë‹˜ì´ ë§ì”€í•˜ì‹  "ë„¤ëª¨ ì•ˆì— í”ŒëŸ¬ìŠ¤" ëª¨ì–‘ì„ ê°€ì¥ ë¹„ìŠ·í•˜ê²Œ ì¬í˜„
    guide.innerHTML = `
        <div style="position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 350px; background: white; color: #333; padding: 25px; border-radius: 25px; z-index: 100000; box-shadow: 0 15px 40px rgba(0,0,0,0.3); border: 2px solid #01b2ad; animation: luxurySlideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
            <div style="font-weight: 900; margin-bottom: 15px; text-align: center; color:#01b2ad; font-size:1.1rem;">ğŸ ì•„ì´í° ì•± ì¶”ê°€ ë°©ë²•</div>
            <div style="font-size: 0.95rem; line-height: 1.8; word-break: keep-all; font-weight:600;">
                1. í•˜ë‹¨ ì¤‘ì•™ì˜ <b style="font-size:1.3rem; background:#f0f0f0; padding:2px 6px; border-radius:6px; color:#333;">ğŸ“¤</b> (ê³µìœ ) ë²„íŠ¼ í´ë¦­!<br>
                2. ë¦¬ìŠ¤íŠ¸ë¥¼ ì˜¬ë ¤ <b style="font-size:1.3rem; background:#f0f0f0; padding:2px 6px; border-radius:6px; color:#333;">âŠ</b> (í™ˆ í™”ë©´ì— ì¶”ê°€) ì„ íƒ!<br>
                <span style="color:#888; font-size:0.85rem;">* âŠ ë˜ëŠ” [+] ëª¨ì–‘ì˜ ë²„íŠ¼ì„ ì°¾ì•„ë³´ì„¸ìš”.</span>
            </div>
            <button onclick="this.parentElement.remove()" style="width: 100%; margin-top: 20px; background: #01b2ad; color: white; border: none; padding: 15px; border-radius: 15px; font-weight: 800;">í™•ì¸í–ˆìŠµë‹ˆë‹¤</button>
            <div style="position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 20px; height: 20px; background: white; border-right: 2px solid #01b2ad; border-bottom: 2px solid #01b2ad; transform: translateX(-50%) rotate(45deg);"></div>
        </div>
    `;
    document.body.appendChild(guide);
}

// 4. [ìˆ˜ì •] ìë™ íŒì—… - ë¬¸êµ¬ë¥¼ ë” ê¹”ë”í•˜ê³  ì§ê´€ì ìœ¼ë¡œ ìˆ˜ë¦¬
function showAutoInstallPopup() {
    if (window.innerWidth > 768) return; 
    const isStandalone = window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
    const isHiddenToday = localStorage.getItem('gnpay_install_popup_hide');
    const today = new Date().toDateString();

    if (isStandalone || isHiddenToday === today) return;

    const isIOS = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    const icon = isIOS ? 'ğŸ“¤' : 'â‹®'; 
    const location = isIOS ? 'í•˜ë‹¨ ì¤‘ì•™' : 'ìš°ì¸¡ ìƒë‹¨';
    
    const popup = document.createElement('div');
    popup.id = 'auto-install-popup';
    popup.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:999999; display:flex; align-items:center; justify-content:center; padding:20px; backdrop-filter:blur(5px);';
    
    popup.innerHTML = `
        <div style="background:white; width:100%; max-width:320px; border-radius:30px; padding:35px 25px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,0.4);">
            <img src="https://gnpay.my/log2.png" style="width:70px; margin-bottom:20px;">
            <h4 style="font-weight:900; color:#1a1a1a; letter-spacing:-1px;">ì•± ì„¤ì¹˜í•˜ê³  ë” í¸í•˜ê²Œ!</h4>
            <p style="font-size:0.9rem; color:#666; line-height:1.6; margin-bottom:25px;">ë°”íƒ•í™”ë©´ì— ì¶”ê°€í•˜ë©´ ë§¤ë²ˆ ì£¼ì†Œë¥¼<br>ì¹  í•„ìš” ì—†ì´ ì•±ì²˜ëŸ¼ ë°”ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>
            <div style="background:#f0fbfb; padding:18px; border-radius:20px; font-size:0.95rem; color:#01b2ad; font-weight:800; margin-bottom:25px;">
                ${location} <span style="font-size:1.4rem; vertical-align:middle; background:#fff; padding:2px 6px; border-radius:8px; border:1px solid #ddd; color:#333;">${icon}</span> ë²„íŠ¼ í´ë¦­!<br>
                <span style="color:#333; font-size:1rem;">'í™ˆ í™”ë©´ì— ì¶”ê°€' â•</span>
            </div>
            <button onclick="installApp()" style="width:100%; background:#01b2ad; color:white; border:none; padding:16px; border-radius:50px; font-weight:800; font-size:1.1rem; box-shadow:0 10px 20px rgba(1, 178, 173, 0.2);">ì•Œê² ìŠµë‹ˆë‹¤! ğŸ‘</button>
            <div onclick="closeInstallPopup(true)" style="margin-top:15px; font-size:0.8rem; color:#bbb; text-decoration:underline; cursor:pointer;">ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸°</div>
        </div>
    `;
    document.body.appendChild(popup);
}

function closeInstallPopup(hideToday = false) {
    if (hideToday) localStorage.setItem('gnpay_install_popup_hide', new Date().toDateString());
    const popup = document.getElementById('auto-install-popup');
    if (popup) popup.remove();
}
function handleQRClick() {
    if (!userData.isLoggedIn) {
        showPage('page-login'); // ì‚¬ì¥ë‹˜ í”„ë¡œì íŠ¸ì˜ ë¡œê·¸ì¸ í˜ì´ì§€ ID
    } else {
        // ë¡œê·¸ì¸ ë˜ì–´ ìˆìœ¼ë©´ QR í¬ê²Œ ë³´ê¸° íŒì—… ë“± ê¸°ì¡´ ë¡œì§ ì‹¤í–‰
    }
}
</script>

</body>
</html>



