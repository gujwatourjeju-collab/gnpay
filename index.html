<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="ê¹€ë…•í˜ì´ (GIMNYEONG PAY)">
    <meta property="og:description" content="íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ ë° í”Œë¡œê¹… í™œë™ìœ¼ë¡œ ë‚˜ë§Œì˜ ì—ì½” í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”. ğŸŒ±">
    <meta property="og:image" content="/og-image.png">
    
    <title>ê¹€ë…•í˜ì´</title>
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#f7fbfc; }
        iframe { border:none; width:100%; height:100%; display: block; }
    </style>
    
    <script>
        /** [í•µì‹¬ ê·œì¹™] ì£¼ì†Œì°½ ë°©ì–´ ë° ì´ˆê¸°í™” **/
        if (window.location.hostname.includes('googleusercontent.com')) {
            window.location.replace('https://gnpay.my');
        }

        window.onpagehide = function () {
            window.history.replaceState(null, null, 'https://gnpay.my');
        };

        // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
        
        // [ê°•ë ¥ ì„¸ì…˜ ë³µêµ¬] iframeì´ ìƒì„±ë˜ê¸° ì „ì— srcë¥¼ ë¯¸ë¦¬ ê²°ì •í•©ë‹ˆë‹¤.
        let initialSrc = baseUrl;
        try {
            const savedUser = localStorage.getItem('k_user');
            if (savedUser) {
                const data = JSON.parse(savedUser);
                if (data && data.email) {
                    initialSrc = baseUrl + "?u=" + encodeURIComponent(data.email);
                    console.log("ì„¸ì…˜ ë°œê²¬: " + data.email);
                }
            }
        } catch(e) {
            console.error("Storage error:", e);
        }
    </script>
</head>
<body>

<script>
    document.write(`
        <iframe id="appFrame" 
            src="${initialSrc}" 
            allow="camera; microphone;" 
            sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation"
            allowfullscreen>
        </iframe>
    `);
</script>

<script>
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    
    // 1. ë¶€ëª¨ ìŠ¤í† ë¦¬ì§€ í™•ì¸
    const saved = localStorage.getItem('k_user');
    let userEmail = "";
    if (saved) {
        try { userEmail = JSON.parse(saved).email; } catch(e) {}
    }

    // 2. ì´ë©”ì¼ì´ ìˆë‹¤ë©´ ì£¼ì†Œì— u=... ë¥¼ ë¶™ì—¬ì„œ iframe ìƒì„±
    let finalUrl = baseUrl;
    if (userEmail) {
        finalUrl += "?u=" + encodeURIComponent(userEmail) + "&v=" + Date.now();
    }

    // 3. iframe ìƒì„±
    document.write(`<iframe id="appFrame" src="${finalUrl}" allow="camera; microphone;" sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" style="width:100%; height:100vh; border:none; display:block;"></iframe>`);

    // 4. ìì‹ìœ¼ë¡œë¶€í„° ì˜¤ëŠ” ëª¨ë“  ë©”ì‹œì§€ ê°ì‹œ ë° ìŠ¤í† ë¦¬ì§€ ì¦‰ê° ë°˜ì˜
    window.addEventListener('message', function(e) {
        if (e.data.type === 'SAVE_USER') {
            localStorage.setItem('k_user', JSON.stringify(e.data.data));
            // ì €ì¥ì´ ì™„ë£Œë˜ë©´ URLì„ ê°±ì‹ í•´ì„œ ë¡œê·¸ì¸ì´ ìœ ì§€ë˜ë„ë¡ í•¨
            console.log("ë¶€ëª¨ì°½ ì„¸ì…˜ ë™ê¸°í™” ì™„ë£Œ");
        }
        if (e.data.type === 'LOGOUT') {
            localStorage.removeItem('k_user');
            window.location.reload();
        }
    });
</script>
</body>
</html>



