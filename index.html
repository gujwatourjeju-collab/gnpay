<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<meta property="og:type" content="website">
<meta property="og:title" content="ê¹€ë…•í˜ì´ (GIMNYEONG PAY)">
<meta property="og:description" content="íƒ„ì†Œì¤‘ë¦½ ì‹¤ì²œ ë° í”Œë¡œê¹… í™œë™ìœ¼ë¡œ ë‚˜ë§Œì˜ ì—ì½” í¬ì¸íŠ¸ë¥¼ ìŒ“ì•„ë³´ì„¸ìš”. ğŸŒ±">
<meta property="og:image" content="/og-image.png">

<title>ê¹€ë…•í˜ì´</title>
<style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #f7fbfc; }
    iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; display: block; }
</style>
<script>
    // [1] ì£¼ì†Œì°½ ë°©ì–´
    if (window.location.hostname.includes('googleusercontent.com')) {
        window.location.replace('https://gnpay.my');
    }
    
    // [2] GAS ë°°í¬ URL
    const baseUrl = "https://script.google.com/macros/s/AKfycbytgcHHzaZTkp6e1XWBXBVNVFRE8bzgE2i6EI9N3k3Vv0FAyCmv9sfDa1_o212bd94U/exec";
    
    // [3] ë©”ì‹œì§€ ìˆ˜ì‹ 
    window.addEventListener('message', function(e) {
        if (!e.data || !e.data.type) return;

        if (e.data.type === 'GET_SESSION') {
            const saved = localStorage.getItem('k_user');
            if (saved) {
                try {
                    const iframe = document.getElementById('appFrame');
                    if (iframe && iframe.contentWindow) {
                        iframe.contentWindow.postMessage({ type: 'SEND_SESSION', data: JSON.parse(saved) }, '*');
                    }
                } catch(err) {}
            }
        } 
        else if (e.data.type === 'SAVE_USER' && e.data.data) {
            // â˜… ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë¬´ì¡°ê±´ ì €ì¥
            localStorage.setItem('k_user', JSON.stringify(e.data.data));
        } 
        else if (e.data.type === 'LOGOUT' || e.data.type === 'LOGOUT_FORCE') {
            localStorage.removeItem('k_user');
            window.location.href = 'https://gnpay.my';
        }
    });

    // [4] Iframe ìƒì„± (ë‹¨ìˆœí™” ë²„ì „)
    function createIframe() {
        let src = baseUrl;
        const saved = localStorage.getItem('k_user');
        
        // â˜… [ì—¬ê¸°ê°€ ìˆ˜ì •ë¨] ì•”í˜¸í™”ê³  ë­ê³  ë‹¤ ë¹¼ê³ , ì´ë©”ì¼ ìˆìœ¼ë©´ ê·¸ëƒ¥ ë°”ë¡œ ë¶™ì…ë‹ˆë‹¤.
        if (saved) {
            try {
                const data = JSON.parse(saved);
                if (data.email) {
                    // ë³µì¡í•œ btoa ì œê±° -> ê·¸ëƒ¥ ì¸ì½”ë”©í•´ì„œ ì „ì†¡ (ê°€ì¥ í™•ì‹¤í•¨)
                    src += "?u=" + encodeURIComponent(data.email) + "&v=" + Date.now();
                }
            } catch(e){}
        }
        
        const iframe = document.createElement('iframe');
        iframe.id = "appFrame";
        iframe.src = src;
        
        iframe.allow = "camera; microphone; storage-access; clipboard-write";
        iframe.setAttribute("sandbox", "allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation allow-modals allow-top-navigation");
        iframe.setAttribute("allowfullscreen", "");
        
        document.body.appendChild(iframe);
    }

    window.addEventListener('load', createIframe);
</script>
</head>
<body>
</body>
</html>
